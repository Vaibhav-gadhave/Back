Script started on Fri 02 May 2014 11:43:54 AM IST
]0;root@localhost:~[root@localhost ~]# [H[2J[root@localhost ~]# 
]0;root@localhost:~[root@localhost ~]# 
]0;root@localhost:~[root@localhost ~]# yu[K[Krpm -qa | grep -i endm[K[K[K[Ksendm
sendmail-8.13.8-8.el5
]0;root@localhost:~[root@localhost ~]# yum int[Kstall sendmail
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
Setting up Install Process
Package sendmail-8.13.8-8.el5.i386 already installed and latest version
Nothing to do
]0;root@localhost:~[root@localhost ~]# yum install sendmail-*
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
Setting up Install Process
Package sendmail-8.13.8-8.el5.i386 already installed and latest version
Resolving Dependencies
--> Running transaction check
---> Package sendmail-cf.i386 0:8.13.8-8.el5 set to be updated
---> Package sendmail-devel.i386 0:8.13.8-8.el5 set to be updated
---> Package sendmail-doc.i386 0:8.13.8-8.el5 set to be updated
--> Finished Dependency Resolution

Dependencies Resolved

================================================================
 Package            Arch     Version           Repository  Size
================================================================
Installing:
 sendmail-cf        i386     8.13.8-8.el5      cddump     306 k
 sendmail-devel     i386     8.13.8-8.el5      cddump     128 k
 sendmail-doc       i386     8.13.8-8.el5      cddump     665 k

Transaction Summary
================================================================
Install       3 Package(s)
Upgrade       0 Package(s)

Total download size: 1.1 M
Is this ok [y/N]: y
Downloading Packages:
----------------------------------------------------------------
Total                            17 MB/s | 1.1 MB     00:00     
Running rpm_check_debug
Running Transaction Test
Finished Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing     : sendmail-cf [                          ] 1/3  Installing     : sendmail-cf [#                         ] 1/3  Installing     : sendmail-cf [###                       ] 1/3  Installing     : sendmail-cf [####                      ] 1/3  Installing     : sendmail-cf [#####                     ] 1/3  Installing     : sendmail-cf [######                    ] 1/3  Installing     : sendmail-cf [#######                   ] 1/3  Installing     : sendmail-cf [########                  ] 1/3  Installing     : sendmail-cf [#########                 ] 1/3  Installing     : sendmail-cf [##########                ] 1/3  Installing     : sendmail-cf [###########               ] 1/3  Installing     : sendmail-cf [#############             ] 1/3  Installing     : sendmail-cf [##############            ] 1/3  Installing     : sendmail-cf [###############           ] 1/3  Installing     : sendmail-cf [################          ] 1/3  Installing     : sendmail-cf [##################        ] 1/3  Installing     : sendmail-cf [###################       ] 1/3  Installing     : sendmail-cf [####################      ] 1/3  Installing     : sendmail-cf [######################    ] 1/3  Installing     : sendmail-cf [#######################   ] 1/3  Installing     : sendmail-cf [########################  ] 1/3  Installing     : sendmail-cf [######################### ] 1/3  Installing     : sendmail-cf                              1/3 
  Installing     : sendmail-devel [                       ] 2/3  Installing     : sendmail-devel [#                      ] 2/3  Installing     : sendmail-devel [#####                  ] 2/3  Installing     : sendmail-devel [##########             ] 2/3  Installing     : sendmail-devel [##############         ] 2/3  Installing     : sendmail-devel [###################    ] 2/3  Installing     : sendmail-devel [#####################  ] 2/3  Installing     : sendmail-devel [###################### ] 2/3  Installing     : sendmail-devel                           2/3 
  Installing     : sendmail-doc [                         ] 3/3  Installing     : sendmail-doc [#                        ] 3/3  Installing     : sendmail-doc [##                       ] 3/3  Installing     : sendmail-doc [###                      ] 3/3  Installing     : sendmail-doc [####                     ] 3/3  Installing     : sendmail-doc [#####                    ] 3/3  Installing     : sendmail-doc [######                   ] 3/3  Installing     : sendmail-doc [#######                  ] 3/3  Installing     : sendmail-doc [########                 ] 3/3  Installing     : sendmail-doc [#########                ] 3/3  Installing     : sendmail-doc [##########               ] 3/3  Installing     : sendmail-doc [###########              ] 3/3  Installing     : sendmail-doc [############             ] 3/3  Installing     : sendmail-doc [#############            ] 3/3  Installing     : sendmail-doc [##############           ] 3/3  Installing     : sendmail-doc [###############          ] 3/3  Installing     : sendmail-doc [################         ] 3/3  Installing     : sendmail-doc [#################        ] 3/3  Installing     : sendmail-doc [##################       ] 3/3  Installing     : sendmail-doc [###################      ] 3/3  Installing     : sendmail-doc [####################     ] 3/3  Installing     : sendmail-doc [#####################    ] 3/3  Installing     : sendmail-doc [######################   ] 3/3  Installing     : sendmail-doc [#######################  ] 3/3  Installing     : sendmail-doc [######################## ] 3/3  Installing     : sendmail-doc                             3/3 

Installed:
  sendmail-cf.i386 0:8.13.8-8.el5                               
  sendmail-devel.i386 0:8.13.8-8.el5                            
  sendmail-doc.i386 0:8.13.8-8.el5                              

Complete!
]0;root@localhost:~[root@localhost ~]# m4 [K[K[K/etc/init.d/sendmail start
Starting sendmail: 
]0;root@localhost:~[root@localhost ~]# chkconfig sed[Kndmail on
]0;root@localhost:~[root@localhost ~]# chkconfig named on
]0;root@localhost:~[root@localhost ~]# 
]0;root@localhost:~[root@localhost ~]# vi /etc/mailsendm[K[K[K[K[K/sed[Kndmail.mc 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/sendmail.mc" "/etc/mail/sendmail.mc" 176L, 7205C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:~[root@localhost ~]# vi /etc/mail/sendmail.mc 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/sendmail.mc" "/etc/mail/sendmail.mc" 176L, 7205C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H/[?12l[?25h127[?25l/127[27m[m[H[2J[1;1Hdnl # cyrusv2 mailer.
dnl #
dnl define(`confLOCAL_MAILER', `cyrusv2')dnl
dnl define(`CYRUSV2_MAILER_ARGS', `FILE /var/lib/imap/socket/lmtt[5;1Hp')dnl
dnl #
dnl # The following causes sendmail to only listen on the IPv4 ll[8;1Hoopback address
dnl # 127.0.0.1 and not on any other network devices. Remove thee[10;1H loopback
dnl # address restriction to accept email from the internet or ii[12;1Hntranet.
dnl #
DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnl
dnl #
dnl # The following causes sendmail to additionally listen to poo[17;1Hrt 587 for
dnl # mail from MUAs that authenticate. Roaming users who can't  [19;1Hreach their
dnl # preferred sendmail daemon due to port 25 being blocked or[1m[34m@                                                               [9;7H[?12l[?25h[11;7H[9;7H[11;7H[13;5H[14;7H[?25l[m[21;1H[1m-- INSERT --[14;1H[?12l[?25h[?25l[mdDAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnld[?12l[?25h[?25lnDAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnldn[?12l[?25h[?25llDAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnldnl[?12l[?25h[?25l DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnldnl [?12l[?25h[?25l#DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnldnl #[?12l[?25h[21;1H[K[14;5H[?25l[?12l[?25h#[?25l[21;1H[1m-- INSERT --[14;6H[?12l[?25h[?25l[m DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnl[14;7H[?12l[?25h[21;1H[K[14;6H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"/etc/mail/sendmail.mc" "/etc/mail/sendmail.mc" 176L, 7211C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:~[root@localhost ~]# [H[2J[root@localhost ~]# 
]0;root@localhost:~[root@localhost ~]# vi /etc/mail/sendmail.mc [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[7Pchkconfig named on[3@sendmail[C[C[C/etc/init.d/sendmail start[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[4Pyum install sendmail-*[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/etc/init.d/sendmail start
Starting sendmail: 
]0;root@localhost:~[root@localhost ~]# ip r l
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.100 
169.254.0.0/16 dev eth0  scope link 
default via 192.168.1.1 dev eth0 
]0;root@localhost:~[root@localhost ~]# n[Knetstat -tulnp | grep -i sendm
tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      2579/sendmail: acce 
]0;root@localhost:~[root@localhost ~]# netstat -tulnp | grep -i sendm[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cip r l[K/etc/init.d/sendmail start[K[K[K[K[Krestart
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:~[root@localhost ~]# [H[2J[root@localhost ~]# /etc/init.d/sendmail restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cnetstat -tulnp | grep -i sendm
tcp        0      0 0.0.0.0:25                  0.0.0.0:*                   LISTEN      3320/sendmail: acce 
]0;root@localhost:~[root@localhost ~]# 
]0;root@localhost:~[root@localhost ~]# mai[K[K[Khostname [K[K[K[K[K[K[K[K[Kmail[K[K[K[Kmail champu@altnix.com
Subject: test
testtttttttttttttttt
.
Cc: 
]0;root@localhost:~[root@localhost ~]# cd /var/spool/mail/
]0;root@localhost:/var/spool/mail[root@localhost mail]# ls
[00m[00mchampu[00m  [00mdhoni[00m  [00mramu[00m  [00mroot[00m  [00mrpc[00m  [00msachin[00m
[m]0;root@localhost:/var/spool/mail[root@localhost mail]# cat champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# cat champu ls[Kcd /var/spool/mail/mail champu@altnix.com
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /var/named/chroot/etc/named.conf 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/var/named/chroot/etc/named.conf" "/var/named/chroot/etc/named.conf" 4L, 66C[1;1Hzone  "altnix.com" {
type  master;
file "var/named/altnix.db";
};
[1m[34m~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# hostname 
localhost.localdomain
]0;root@localhost:/var/spool/mail[root@localhost mail]# hostan[K[Kname altnix.com
]0;root@localhost:/var/spool/mail[root@localhost mail]# ping altnix.com
PING altnix.com (103.21.58.156) 56(84) bytes of data.
64 bytes from cp-in-2.webhostbox.net (103.21.58.156): icmp_seq=1 ttl=58 time=27.8 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 27.880/27.880/27.880/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# ping altnix.com[4@hostname[C[C[C[C[C[C[C[C[C[C[C[K[27@vi /var/named/chroot/etc/named.conf[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Ccat champu [Kls[Kcd /var/spool/mail/
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# mail champu@altnix.com
Subject: dddddd
dksamlma
dma;dm
.
Cc: 
]0;root@localhost:/var/spool/mail[root@localhost mail]# pwd
/var/spool/mail
]0;root@localhost:/var/spool/mail[root@localhost mail]# cat 
champu  dhoni   ramu    root    rpc     sachin  
[root@localhost mail]# cat champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# ls
[00m[00mchampu[00m  [00mdhoni[00m  [00mramu[00m  [00mroot[00m  [00mrpc[00m  [00msachin[00m
[m]0;root@localhost:/var/spool/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# lscat champu pwd[Kmail champu@altnix.com[7Pping altnix.com[4@hostname[C[C[C[C[C[C[C[C[C[C[C[4Pping[C[C[C[C[C[C[C[C[C[C[C
PING altnix.com (103.21.58.156) 56(84) bytes of data.
64 bytes from cp-in-2.webhostbox.net (103.21.58.156): icmp_seq=1 ttl=58 time=58.0 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 58.011/58.011/58.011/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/hosts
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/resolv.conf 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/resolv.conf" "/etc/resolv.conf" 3L, 63C[1;1H#nameserver 198.168.1.1
nameserver 8.8.8.8
#search localdomain
[1m[34m~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h
[?25l[m[21;1H[1m-- INSERT --[m[21;13H[K[2;1H[?12l[?25h[?25l[3;20r[3;1H[L[1;21r[2;1H[K[3;1Hnameserver 8.8.8.8[21;1H[1m-- INSERT --[3;1H[?12l[?25h[2;1H[?25l[mn[?12l[?25h[?25la[?12l[?25h[?25lm[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25le[?12l[?25h[?25lr[?12l[?25h[?25lv[?12l[?25h[?25le[?12l[?25h[?25lr[?12l[?25h[?25l [?12l[?25h[?25l[?12l[?25h[3;19H[?25l#search localdomain
[1m[34m~                                                               [3;19H[?12l[?25h[19C[?25l[mu[?12l[?25h[?25lu[?12l[?25h[21;1H[K[3;39H[?25l[?12l[?25h[?25l[21;1H1 change; before #4  1 seconds ago[3;38H[K[3;37H[?12l[?25h[?25l[21;1H1 more line; before #3  3 seconds ago[3;19H[K[4;1H#search localdomain[4;20H[K[3;18H[?12l[?25h[2;11H[?25l[21;1H[1m-- INSERT --[m[21;14H[K[2;11H[?12l[?25h[?25l [?12l[?25h [?25l[?12l[?25h[3;19H[?25l#search localdomain
[1m[34m~                                                               [3;19H[?12l[?25h[m[21;1H[K[3;18H[?25l[?12l[?25h[?25l[21;1H1 more line; before #6  1 seconds ago[3;19H[K[4;1H#search localdomain[4;20H[K[3;18H[?12l[?25h[2;12H[?25l[21;1H[1m-- INSERT --[m[21;14H[K[2;12H[?12l[?25h [?25l[?12l[?25h[?25l1[?12l[?25h[?25l9[?12l[?25h[?25l2[?12l[?25h[?25l.[?12l[?25h[?25l1[?12l[?25h[?25l6[?12l[?25h[?25l8[?12l[?25h[?25l.[?12l[?25h[?25l1[?12l[?25h[?25l.[?12l[?25h[?25l1[?12l[?25h[?25l0[?12l[?25h[?25l0[?12l[?25h[21;1H[K[2;25H[?25l[?12l[?25h[1;23H[?25l[1;20r[20;1H
[1;21r[20;1H[1m[34m~                                                               [1;1H[?12l[?25h[?25l[21;1H[m:[?12l[?25hwq![?25l"/etc/resolv.conf" "/etc/resolv.conf" 3L, 65C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/resolv.conf [5Pping altnix.com
PING altnix.com (103.21.58.156) 56(84) bytes of data.
64 bytes from cp-in-2.webhostbox.net (103.21.58.156): icmp_seq=1 ttl=58 time=18.8 ms

--- altnix.com ping statistics ---
2 packets transmitted, 1 received, 50% packet loss, time 1000ms
rtt min/avg/max/mdev = 18.840/18.840/18.840/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# ping altnix.com

]0;root@localhost:/var/spool/mail[root@localhost mail]# ping altnix.com
PING altnix.com (103.21.58.156) 56(84) bytes of data.
64 bytes from cp-in-2.webhostbox.net (103.21.58.156): icmp_seq=1 ttl=58 time=19.2 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 19.221/19.221/19.221/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# ping altnix.comvi /etc/resolv.conf 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/resolv.conf" "/etc/resolv.conf" 3L, 65C[1;1Hnameserver  192.168.1.100
nameserver 8.8.8.8
#search localdomain
[1m[34m~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h

[2;1H[?25l[2;20r[m[20;1H
[1;21r[20;1H[1m[34m~                                                               [m[21;1H[K[2;1H[?12l[?25h[?25l[1m[34m~                                                               [1;1H[?12l[?25h[?25l[21;1H[m:[?12l[?25hwq![?25l"/etc/resolv.conf" "/etc/resolv.conf" 1L, 26C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/resolv.conf [5Pping altnix.com
ping: unknown host altnix.com
]0;root@localhost:/var/spool/mail[root@localhost mail]# service named restart
Stopping named: [60G[[0;32m  OK  [0;39m]
Starting named: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/var/spool/mail[root@localhost mail]# service named restart[6Pping altnix.com[H[2J[root@localhost mail]# ping altnix.com
PING altnix.com (192.168.1.100) 56(84) bytes of data.
64 bytes from 192.168.1.100: icmp_seq=1 ttl=64 time=0.039 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.039/0.039/0.039/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# ping altnix.com
PING altnix.com (192.168.1.100) 56(84) bytes of data.
64 bytes from 192.168.1.100: icmp_seq=1 ttl=64 time=0.040 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.040/0.040/0.040/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# ping altnix.comservice named restart[6Pping altnix.comvi /etc/resolv.conf [5Pping altnix.comvi /etc/resolv.conf [5Pping altnix.comls[Kcat champu pwd[Kmail champu@altnix.com
Subject: t	e==    sssssssssss
sssss
ssss
.
Cc: 
]0;root@localhost:/var/spool/mail[root@localhost mail]# ls
[00m[00mchampu[00m  [00mdhoni[00m  [00mramu[00m  [00mroot[00m  [00mrpc[00m  [00msachin[00m
[m]0;root@localhost:/var/spool/mail[root@localhost mail]# catc[K champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

]0;root@localhost:/var/spool/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# cat champu ls[Kmail champu@altnix.com
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# cat champu ls[Kmail champu@altnix.com[7Pping altnix.com
PING altnix.com (192.168.1.100) 56(84) bytes of data.
64 bytes from 192.168.1.100: icmp_seq=1 ttl=64 time=0.042 ms
64 bytes from 192.168.1.100: icmp_seq=2 ttl=64 time=0.078 ms

--- altnix.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 0.042/0.060/0.078/0.018 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# vi /etc/ma
mail/       mail.rc     man.config  
mailcap     makedev.d/  maven/      
[root@localhost mail]# vi /etc/mail[H[2J[root@localhost mail]# vi /etc/mail/
access            mailertable       submit.cf
access.db         mailertable.db    submit.mc
domaintable       Makefile          trusted-users
domaintable.db    sendmail.cf       virtusertable
helpfile          sendmail.cf.bak   virtusertable.db
local-host-names  sendmail.mc       
[root@localhost mail]# vi /etc/mail/domaintable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/domaintable" "/etc/mail/domaintable" 0L, 0C[2;1H[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/mail/domaintable[C[K[K[K[K[K[K[K[K[K[K[Kvirtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 0L, 0C[2;1H[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/mail/virtusertable
virtusertable     virtusertable.db  
[root@localhost mail]# vi /etc/mail/virtusertable.db 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable.db" "/etc/mail/virtusertable.db" [noeol][converted] 1L, 12298C[1;1H[34m^@^@^@^@^A^@^@^@^@^@^@^@[ma[34m^U^F^@^H^@^@^@^@^P^@^@^@^H^@^@^@^@^@^@^^[2;1HB^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@[me[34m^A^G^@[m  [34m^H^@^@[mÓ`¼[34m<90>^\^^[3;1HE^@^@^@^@^@^@^A^@^@^@^A^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@[mÑ[34m<8d>[mh^[34m^A^@@[4;1H^@^@^A^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[5;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[6;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[7;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[8;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[9;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[10;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[11;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[12;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[13;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[14;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[15;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[16;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[17;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[18;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[19;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@@[20;1H^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@[1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/mail/virtusertable.db [K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K[K
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# vi /etc/hosts
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/hosts" "/etc/hosts" 5L, 188C[1;1H# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1[15Clocalhost.localdomain localhost
::1[13Clocalhost6.localdomain6 localhost6

[1m[34m~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h



[?25l[m[21;1H[1m-- INSERT --[m[21;14H[K[5;1H[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25ln[?12l[?25h[?25li[?12l[?25h[?25lx[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25lm[?12l[?25h[?25l1altnix.com1[?12l[?25h[?25l9altnix.com19[?12l[?25h[?25l2altnix.com192[?12l[?25h[?25l.altnix.com192.[?12l[?25h[?25l1altnix.com192.1[?12l[?25h[?25l6altnix.com[5;7H[?12l[?25h[?25l8altnix.com[5;8H[?12l[?25h[?25l.altnix.com[5;9H[?12l[?25h[?25l1altnix.com[5;10H[?12l[?25h[?25l.altnix.com[5;11H[?12l[?25h[?25l1altnix.com[5;12H[?12l[?25h[?25l0altnix.com[5;13H[?12l[?25h[?25l0altnix.com[5;14H[?12l[?25h[?25l altnix.com[5;15H[?12l[?25h[?25l altnix.com[5;16H[?12l[?25h[?25l altnix.com[5;17H[?12l[?25h[?25l altnix.com[5;18H[?12l[?25h[?25l altnix.com[5;19H[?12l[?25h[?25l altnix.com[5;20H[?12l[?25h[21;1H[K[5;19H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"/etc/hosts" "/etc/hosts" 5L, 217C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# ip r l
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.100 
169.254.0.0/16 dev eth0  scope link 
default via 192.168.1.1 dev eth0 
]0;root@localhost:/var/spool/mail[root@localhost mail]# ip r lvi /etc/hostsmail/virtusertable.db [K[2Pdomaintable[9Pping altnix.com
PING altnix.com (192.168.1.100) 56(84) bytes of data.
64 bytes from altnix.com (192.168.1.100): icmp_seq=1 ttl=64 time=0.063 ms

--- altnix.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.063/0.063/0.063/0.000 ms
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# ping altnix.com[9Pip r l[H[2J[root@localhost mail]# ip r lvi /etc/hostsmail/virtusertable.db [K[2Pdomaintable[9Pping altnix.com[4Pcat champu ls[Kmail champu@altnix.com
Subject: sssssssss
sssssssssssss
..\  
Cc: 
]0;root@localhost:/var/spool/mail[root@localhost mail]# mail champu@altnix.com[7Pping altnix.com[9Pip r lvi /etc/hostsmail/virtusertable.db [K[2Pdomaintable[9Pping altnix.com[4Pcat champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

]0;root@localhost:/var/spool/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# cat champu 
]0;root@localhost:/var/spool/mail[root@localhost mail]# 
]0;root@localhost:/var/spool/mail[root@localhost mail]# vi /etc/mail/s
sendmail.cf      sendmail.mc      submit.mc
sendmail.cf.bak  submit.cf        
[root@localhost mail]# vi /etc/mail/s[Ksendmail.mc 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/sendmail.mc" "/etc/mail/sendmail.mc" 176L, 7211C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H/[?12l[?25hlocalhps[?25l/localhp[21;9H[K[21;9H[?12l[?25h[?25l/localh[21;8H[K[21;8H[?12l[?25host[?25l/localhost[27m[m[H[2J[1;1Hdnl # protect yourself from spam. However, the laptop and users  [2;1Hon computers
dnl # that do not have 24x7 DNS do need this.
dnl #
FEATURE(`accept_unresolvable_domains')dnl
dnl #
dnl FEATURE(`relay_based_on_MX')dnl
dnl #
dnl # Also accept email sent to "localhost.localdomain" as locall[10;1H email.
dnl #
LOCAL_DOMAIN(`localhost.localdomain')dnl
dnl #
dnl # The following example makes mail from this host and any add[15;1Hditional
dnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well[9;34H[?12l[?25h[11;6H[12;34H
dnl [12;34H[?25l[21;1H/localhost[1;20r[1;1H[10M[1;21r[11;1Hdnl #
dnl FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalii[15;1Has.com as well
dnl #
dnl FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl[21;1H[K[19;23H[?12l[?25h[?25l

/localhost[20;23H[?12l[?25h[?25l
/localhost[31msearch hit BOTTOM, continuing at TOP[1;20r[m[1;1H[2L[1;21r[1;1Hdnl # Also accept email sent to "localhost.localdomain" as locall[2;1H email.[21;1H[K[21;1H[31msearch hit BOTTOM, continuing at TOP[1;34H[?12l[?25h[?25l[m[21;1H/localhost[21;11H[K[21;1H[4;15H[?12l[?25h[?25l[21;1H/localhost[1;20r[1;1H[2M[1;21r[19;1Hdnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl[21;1H[K[19;23H[?12l[?25h[?25l

/localhost[20;23H[?12l[?25h[?25l
/localhost[31msearch hit BOTTOM, continuing at TOP[1;20r[m[1;1H[2L[1;21r[1;1Hdnl # Also accept email sent to "localhost.localdomain" as locall[2;1H email.[21;1H[K[21;1H[31msearch hit BOTTOM, continuing at TOP[1;34H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/var/spool/mail[root@localhost mail]# [H[2J[root@localhost mail]# pwd
/var/spool/mail
]0;root@localhost:/var/spool/mail[root@localhost mail]# ls
[00m[00mchampu[00m  [00mdhoni[00m  [00mramu[00m  [00mroot[00m  [00mrpc[00m  [00msachin[00m
[m]0;root@localhost:/var/spool/mail[root@localhost mail]# cd /etc/mail
]0;root@localhost:/etc/mail[root@localhost mail]# ls
[00m[00maccess[00m            [00mmailertable[00m      [00msubmit.cf[00m
[00maccess.db[00m         [00mmailertable.db[00m   [00msubmit.mc[00m
[00mdomaintable[00m       [00mMakefile[00m         [00mtrusted-users[00m
[00mdomaintable.db[00m    [00msendmail.cf[00m      [00mvirtusertable[00m
[00mhelpfile[00m          [00msendmail.cf.bak[00m  [00mvirtusertable.db[00m
[00mlocal-host-names[00m  [00msendmail.mc[00m
[m]0;root@localhost:/etc/mail[root@localhost mail]# cp sendmail.mc  sendmail.mc [K.org
]0;root@localhost:/etc/mail[root@localhost mail]# vi sedn[K[Kndmail.mc[H[2J[root@localhost mail]# vi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 176L, 7211C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H/[?12l[?25hlocalhosty[?25l/localhost[21;11H[K[21;11H[?12l[?25h[?25l/localhost[27m[m[H[2J[1;1Hdnl # protect yourself from spam. However, the laptop and users  [2;1Hon computers
dnl # that do not have 24x7 DNS do need this.
dnl #
FEATURE(`accept_unresolvable_domains')dnl
dnl #
dnl FEATURE(`relay_based_on_MX')dnl
dnl #
dnl # Also accept email sent to "localhost.localdomain" as locall[10;1H email.
dnl #
LOCAL_DOMAIN(`localhost.localdomain')dnl
dnl #
dnl # The following example makes mail from this host and any add[15;1Hditional
dnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well[9;34H[?12l[?25h[11;6H[12;34H`[?25localhost.localdomain')dnl[12;40H[K[12;15H[?12l[?25h[?25lcalhost.localdomain')dnl[12;39H[K[12;15H[?12l[?25h[?25lalhost.localdomain')dnl[12;38H[K[12;15H[?12l[?25h[?25llhost.localdomain')dnl[12;37H[K[12;15H[?12l[?25h[?25lhost.localdomain')dnl[12;36H[K[12;15H[?12l[?25h[?25lost.localdomain')dnl[12;35H[K[12;15H[?12l[?25h[?25lst.localdomain')dnl[12;34H[K[12;15H[?12l[?25h[?25lt.localdomain')dnl[12;33H[K[12;15H[?12l[?25h[?25l.localdomain')dnl[12;32H[K[12;15H[?12l[?25h[?25llocaldomain')dnl[12;31H[K[12;15H[?12l[?25h[?25localdomain')dnl[12;30H[K[12;15H[?12l[?25h[?25lcaldomain')dnl[12;29H[K[12;15H[?12l[?25h[?25laldomain')dnl[12;28H[K[12;15H[?12l[?25h[?25lldomain')dnl[12;27H[K[12;15H[?12l[?25h[?25ldomain')dnl[12;26H[K[12;15H[?12l[?25h[?25lomain')dnl[12;25H[K[12;15H[?12l[?25h[?25lmain')dnl[12;24H[K[12;15H[?12l[?25h[?25lain')dnl[12;23H[K[12;15H[?12l[?25h[?25lin')dnl[12;22H[K[12;15H[?12l[?25h[?25ln')dnl[12;21H[K[12;15H[?12l[?25h[?25l')dnl[12;20H[K[12;15H[?12l[?25h[?25l[21;1H[1m-- INSERT --[12;15H[?12l[?25h[?25l[ma')dnl[?12l[?25h[?25ll')dnl[?12l[?25h[?25lt')dnl[?12l[?25h[?25ln')dnl[?12l[?25h[?25li')dnl[?12l[?25h[?25lx')dnl[?12l[?25h[?25l.')dnl[?12l[?25h[?25lc')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25lm')dnl[?12l[?25h[21;1H[K[12;24H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"sendmail.mc" "sendmail.mc" 176L, 7200C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': vi sendmail.mc[1@e[C[C[C[C[C[Cr': vi /etc/mail/virtusertable.db [8Pv': service named restart[C[C[C[C[C[C[C[C[C[2@etwork
]0;root@localhost:/etc/mail[root@localhost mail]# service sendmail restartr=[K[K
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# service sendmail restart[10Pvi sendmail.mccp sendmail.mc  sendmail.mc.org[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kcd /etc/maills[Kpwdvi /etc/mail/sendmail.mc [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[14Pcat champu[Cmail champu@altnix.com[7Pping altnix.commail champu@altnix.com
Subject: ssssssssssssssss
ssssssssssssssssssssssssss
.. 
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@altnix.com[Kcat ch[K[K[K[K[K[Kls
[00m[00maccess[00m            [00mmailertable[00m      [00msendmail.mc.org[00m
[00maccess.db[00m         [00mmailertable.db[00m   [00msubmit.cf[00m
[00mdomaintable[00m       [00mMakefile[00m         [00msubmit.mc[00m
[00mdomaintable.db[00m    [00msendmail.cf[00m      [00mtrusted-users[00m
[00mhelpfile[00m          [00msendmail.cf.bak[00m  [00mvirtusertable[00m
[00mlocal-host-names[00m  [00msendmail.mc[00m      [00mvirtusertable.db[00m
[m]0;root@localhost:/etc/mail[root@localhost mail]# cat c[K[K[K[K[Kcat /var/spool/mail/champu [H[2J[root@localhost mail]# cat /var/spool/mail/champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Kcat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kmail champu@altnix.comservice sendmail restart[10Pvi sendmail.mccp sendmail.mc  sendmail.mc.org[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[17Pvi sendmail.mcservice sendmail restart[2Pmail champu@altnix.com[K[K[K[K[K[K[K[K[K[K[K
Subject: ddddddddd
dddddddddddd
.. 
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champucat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kcat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[16Pmail champucat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kcat /var/spool/mail/champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[16Pmail champucat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kmail champu@altnix.comservice sendmail restart[10Pvi sendmail.mccp sendmail.mc  sendmail.mc.org[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kcd /etc/maills[Kpwdvi /etc/mail/sendmail.mc [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[14Pcat champu[Cmail champu@altnix.com[7Pping altnix.com[9Pip r lvi /etc/hostsmail/virtusertable.db hosts[K
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/hosts" "/etc/hosts" 5L, 217C[1;1H# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1[15Clocalhost.localdomain localhost
::1[13Clocalhost6.localdomain6 localhost6
192.168.1.100      altnix.com
[1m[34m~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[5;1H[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# seri[Kvice named stop
Stopping named: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# service named stop[5Pvi /etc/hostscat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[16Pmail champucat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kmail champu@altnix.comservice sendmail restart[2Pmail champu@altnix.com
Subject: gggggggggggg
ggggggggggg
.
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@altnix.com[4Pservice named stop[5Pvi /etc/hostscat /var/spool/mail/champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

]0;root@localhost:/etc/mail[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.com[4Pservice named stop[5Pvi /etc/hostscat /var/spool/mail/champu 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.com[4Pservice named stop[5Pvi /etc/hostscat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[16Pmail champucat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cls[Kmail champu@altnix.comservice sendmail restart[10Pvi sendmail.mccp sendmail.mc  sendmail.mc.org[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[17Pvi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 176L, 7200C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h
















[?25l[m[21;1H[K[21;1H/[?12l[?25haltnix[?25l/altnix[27m[m[H[2J[1;1Hdnl # that do not have 24x7 DNS do need this.
dnl #
FEATURE(`accept_unresolvable_domains')dnl
dnl #
dnl FEATURE(`relay_based_on_MX')dnl
dnl #
dnl # Also accept email sent to "localhost.localdomain" as locall[8;1H email.
dnl #
LOCAL_DOMAIN(`altnix.com')dnl
dnl #
dnl # The following example makes mail from this host and any add[13;1Hditional
dnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl[10;15H[?12l[?25h[?25l[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 176L, 7200C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h
[?25l[m[21;1H[K[21;1H/[?12l[?25haltnix[?25l/altnix[27m[m[H[2J[1;1Hdnl # that do not have 24x7 DNS do need this.
dnl #
FEATURE(`accept_unresolvable_domains')dnl
dnl #
dnl FEATURE(`relay_based_on_MX')dnl
dnl #
dnl # Also accept email sent to "localhost.localdomain" as locall[8;1H email.
dnl #
LOCAL_DOMAIN(`altnix.com')dnl
dnl #
dnl # The following example makes mail from this host and any add[13;1Hditional
dnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl[10;15H[?12l[?25h[?25l[21;1H/[?12l[?25hdnl define[?25l/dnl define[31msearch hit BOTTOM, continuing at TOP[27m[m[H[2J[1;1Hdnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highee[13;1Hr to
dnl # debug the configuration
dnl #
dnl define(`confLOG_LEVEL', `9')dnl
dnl #
dnl # Uncomment and edit the following line if your outgoing maii[19;1Hl needs to
dnl # be sent out through an external mail server:
[31msearch hit BOTTOM, continuing at TOP[10;1H[?12l[?25h
[10;1H[?25l[m[21;1H[K[21;1H/[?12l[?25hconfDom[?25l/confDo[21;8H[K[21;8H[?12l[?25h[?25l/confD[21;7H[K[21;7H[?12l[?25hOM[?25l/confDOM[31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: confDOM[m[21;33H[K[10;1H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25hconf/[?25l/conf[21;6H[K[21;6H[?12l[?25hDOMAI[?25l/confDOMAI[31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: confDOMAI[m[21;35H[K[10;1H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25hdefine [?25l/define [31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: define [m[21;33H[K[10;1H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25hdefine[?25l/define[10;5H[?12l[?25h[?25l[21;1H/define[16;5H[?12l[?25h[?25l[21;1H/define[1;20r[1;1H[2M[1;21r[19;1Hdnl #
dnl define(`SMART_HOST', `smtp.your.provider')dnl[21;1H[K[20;5H[?12l[?25h[?25l
/define[1;20r[1;1H[2M[1;21r[19;1Hdnl #
define(`confDEF_USER_ID', ``8:12'')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdnl define(`confAUTO_REBUILD')dnl[21;1H[K[20;5H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`confTO_CONNECT', `1m')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`confTRY_NULL_MX_LIST', `True')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`confDONT_PROBE_INTERFACES', `True')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`PROCMAIL_MAILER_PATH', `/usr/bin/procmail')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`ALIAS_FILE', `/etc/aliases')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`STATUS_FILE', `/var/log/mail/statistics')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[1;1H[2M[1;21r[19;1Hdefine(`UUCP_MAILER_MAX', `2000000')dnl
define(`confUSERDB_SPEC', `/etc/mail/userdb.db')dnl[21;1H[K[19;1H[?12l[?25h[?25l

/define[20;1H[?12l[?25h[?25l
/define[1;20r[1;1H[2M[1;21r[19;1Hdefine(`confPRIVACY_FLAGS', `authwarnings,novrfy,noexpn,restrictt[20;1Hqrun')dnl[21;1H[K[19;1H[?12l[?25h[?25l

/define[1;20r[20;1H
[1;21r[20;1Hdefine(`confAUTH_OPTIONS', `A')dnl[21;1H[K[20;1H[?12l[?25h[?25l
/define[1;20r[1;1H[6M[1;21r[15;1Hdnl #
dnl # The following allows relaying if the user authenticates, aa[17;1Hnd disallows
dnl # plaintext authentication (PLAIN/LOGIN) on non-TLS links
dnl #
dnl define(`confAUTH_OPTIONS', `A p')dnl[21;1H[K[20;5H[?12l[?25h[?25l
/define[27m[m[H[2J[1;1Hdnl # use LOGIN. Other mechanisms should be used if the connectii[2;1Hon is not
dnl # guaranteed secure.
dnl # Please remember that saslauthd needs to be running for AUTT[5;1HH.
dnl #
dnl TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dd[8;1Hnl
dnl define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRR[10;1HAM-MD5 LOGIN PLAIN')dnl
dnl #
dnl # Rudimentary information on creating certificates for sendmm[13;1Hail TLS:
dnl #     cd /etc/pki/tls/certs; make sendmail.pem
dnl # Complete usage:
dnl #     make -C /etc/pki/tls/certs usage
dnl #
dnl define(`confCACERT_PATH', `/etc/pki/tls/certs')dnl
dnl define(`confCACERT', `/etc/pki/tls/certs/ca-bundle.crt')dnl
dnl define(`confSERVER_CERT', `/etc/pki/tls/certs/sendmail.pem')[20;1H[1m[34m@                                                               [9;5H[?12l[?25h[?25l[m[21;1H/define[18;5H[?12l[?25h[?25l


/define[19;5H[?12l[?25h[?25l

/define[1;20r[1;1H[2M[1;21r[18;1Hdnl define(`confSERVER_CERT', `/etc/pki/tls/certs/sendmail.pem'))[19;1Hdnl
dnl define(`confSERVER_KEY', `/etc/pki/tls/certs/sendmail.pem')d[20;1H[1m[34m@                                                               [m[21;1H[K[18;5H[?12l[?25h[?25l


/define[1;20r[20;1H
[1;21r[19;1Hdnl define(`confSERVER_KEY', `/etc/pki/tls/certs/sendmail.pem')dd[20;1Hnl[21;1H[K[19;5H[?12l[?25h[?25l

/define[1;20r[1;1H[7M[1;21r[14;1Hdnl #
dnl # This allows sendmail to use a keyfile that is shared with  [16;1HOpenLDAP's
dnl # slapd, which requires the file to be readble by group ldap[18;1Hdnl #
dnl define(`confDONT_BLAME_SENDMAIL', `groupreadablekeyfile')dnl[20;1Hdnl #[21;1H[K[19;5H[?12l[?25h[?25l

/define[1;20r[20;1H
[1;21r[20;1Hdnl define(`confTO_QUEUEWARN', `4h')dnl[21;1H[K[20;5H[?12l[?25h[?25l
/define[1;20r[1;1H[2M[1;21r[19;1Hdnl define(`confTO_QUEUERETURN', `5d')dnl
dnl define(`confQUEUE_LA', `12')dnl[21;1H[K[19;5H[?12l[?25h[?25l

/define[20;5H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdnl define(`confREFUSE_LA', `18')dnl[21;1H[K[20;5H[?12l[?25h[?25l
/define[1;20r[20;1H
[1;21r[20;1Hdefine(`confTO_IDENT', `0')dnl[21;1H[K[20;1H[?12l[?25h[?25l
:[?12l[?25hset ic[?25l[20;1H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25hcond[?25l/con[21;5H[K[21;5H[?12l[?25hfdomain[?25l/confdomain[31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: confdomain[m[21;36H[K[20;1H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25hconfcw[?25l/confcw[31msearch hit BOTTOM, continuing at TOP[m[1m[37m[41mE486: Pattern not found: confcw[m[21;32H[K[20;1H[?12l[?25h[?25l[1;20r[20;1H
[1;21r[20;1Hdnl FEATURE(delay_checks)dnl[21;1H[K[20;1H[?12l[?25h[?25l[1;20r[20;1H
[1;21r[20;1HFEATURE(`no_default_msa', `dnl')dnl[?12l[?25h[?25l[1;20r[20;1H
[1;21r[20;1HFEATURE(`smrsh', `/usr/sbin/smrsh')dnl[?12l[?25h[?25l[1;20r[20;1H
[1;21r[20;1HFEATURE(`mailertable', `hash -o /etc/mail/mailertable.db')dnl[?12l[?25h[?25l[1;20r[1;1H[2M[1;21r[19;1HFEATURE(`virtusertable', `hash -o /etc/mail/virtusertable.db')dnn[20;1Hl[19;1H[?12l[?25h[?25l[1;20r[1;1H[2M[1;21r[19;1HFEATURE(redirect)dnl
FEATURE(always_add_domain)dnl[19;1H[?12l[?25h
[?25l[1;20r[20;1H
[1;21r[20;1HFEATURE(use_cw_file)dnl[?12l[?25h[?25l[1;20r[1;1H[2M[1;21r[19;1HFEATURE(use_ct_file)dnl
dnl #[19;1H[?12l[?25h[18;1H[17;1H[16;1H[14;1H[13;1H[12;1H[11;1H[10;1H[9;1H[8;1H[7;1H[6;1H[5;1H[4;1H[3;1H[2;1H[1;1H






[?25l[27m[m[H[2J[1;1Hdnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalii[10;1Has.com as well
dnl #
dnl FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl
dnl MASQUERADE_DOMAIN(mydomainalias.com)dnl
dnl MASQUERADE_DOMAIN(mydomain.lan)dnl
MAILER(smtp)dnl
MAILER(procmail)dnl
dnl MAILER(cyrusv2)dnl[?12l[?25h[?25l
[1m-- INSERT --[1;20r[m[20;1H
[1;21r[21;1H[1m-- INSERT --[20;1H[?12l[?25h[?25l[1;20r[m[1;1H[2M[1;21r[18;1Hdefine(`confCW_FILE', `/etc/mail/local-host-names')dnl
define(`confDOMAIN_NAME', `mail.example.net')dnl

[1m-- INSERT --[20;1H[?12l[?25h[m[21;1H[K[20;1H[?25l[?12l[?25h[19;1H[18;1H[?25l


[1m-- INSERT --[18;1H[?12l[?25h[?25l[m[18;1H[K[19;13HCW_FILE', `/etc/mail/local-host-names')dnl
define(`confDOMAIN_NAME', `mail.example.net')dnl[19;1H[?12l[?25h
[?25l[1;20r[20;1H
[1;21r[21;1H[1m-- INSERT --[20;1H[?12l[?25h[19;1H[18;1H[mdefine(`[19;9HconfDOMAIN_NAME', `[?25lail.example.net')dnl[19;48H[K[19;28H[?12l[?25h[?25lil.example.net')dnl[19;47H[K[19;28H[?12l[?25h[?25ll.example.net')dnl[19;46H[K[19;28H[?12l[?25h[?25l.example.net')dnl[19;45H[K[19;28H[?12l[?25h[?25lexample.net')dnl[19;44H[K[19;28H[?12l[?25h[?25lxample.net')dnl[19;43H[K[19;28H[?12l[?25h[?25lample.net')dnl[19;42H[K[19;28H[?12l[?25h[?25lmple.net')dnl[19;41H[K[19;28H[?12l[?25h[?25lple.net')dnl[19;40H[K[19;28H[?12l[?25h[?25lle.net')dnl[19;39H[K[19;28H[?12l[?25h[?25le.net')dnl[19;38H[K[19;28H[?12l[?25h[?25l.net')dnl[19;37H[K[19;28H[?12l[?25h[?25lnet')dnl[19;36H[K[19;28H[?12l[?25h[?25let')dnl[19;35H[K[19;28H[?12l[?25h[?25lt')dnl[19;34H[K[19;28H[?12l[?25h[?25l')dnl[19;33H[K[19;28H[?12l[?25h[?25li')dnl[?12l[?25h[?25l')dnl[19;33H[K[19;28H[?12l[?25h[?25la')dnl[?12l[?25h[?25ll')dnl[?12l[?25h[?25lt')dnl[?12l[?25h[?25ln')dnl[?12l[?25h[?25li')dnl[?12l[?25h[?25lx')dnl[?12l[?25h[?25l.')dnl[?12l[?25h[?25lc')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25lm')dnl[?12l[?25h[21;1H[K[19;37H[?25l[?12l[?25h[18;37H[19;37H[?25l

:[?12l[?25hw[?25l"sendmail.mc" "sendmail.mc" 180L, 7300C written"sendmail.mc" 180L, 7300C written[19;37H[?12l[?25h[?25l[21;1H[K[21;1H/[?12l[?25haltnix.com[?25l/altnix.com[31msearch hit BOTTOM, continuing at TOP[1;20r[m[1;1H[8L[1;21r[1;1HLOCAL_DOMAIN(`altnix.com')dnl
dnl #
dnl # The following example makes mail from this host and any add[4;1Hditional
dnl # specified domains appear to be sent from mydomain.com
dnl #
dnl MASQUERADE_AS(`mydomain.com')dnl
dnl #[21;1H[K[21;1H[31msearch hit BOTTOM, continuing at TOP[1;15H[?12l[?25h[?25l[1;20r[m[1;1H[L[1;21r[1;1Hdnl #[21;1H[K[1;6H[?12l[?25h[?25l[1;20r[1;1H[2L[1;21r[1;1Hdnl # Also accept email sent to "localhost.localdomain" as locall[2;1H email.[1;15H[?12l[?25h[3;6H[4;15H[?25lltnix.com')dnl[4;29H[K[4;15H[?12l[?25h[?25ltnix.com')dnl[4;28H[K[4;15H[?12l[?25h[?25lnix.com')dnl[4;27H[K[4;15H[?12l[?25h[?25lix.com')dnl[4;26H[K[4;15H[?12l[?25h[?25lx.com')dnl[4;25H[K[4;15H[?12l[?25h[?25l.com')dnl[4;24H[K[4;15H[?12l[?25h[?25lcom')dnl[4;23H[K[4;15H[?12l[?25h[?25lom')dnl[4;22H[K[4;15H[?12l[?25h[?25lm')dnl[4;21H[K[4;15H[?12l[?25h[?25l')dnl[4;20H[K[4;15H[?12l[?25h[?25l[21;1H[1m-- INSERT --[4;15H[?12l[?25h[?25l[ml')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25lc')dnl[?12l[?25h[?25la')dnl[?12l[?25h[?25ll')dnl[?12l[?25h[?25lh')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25ls')dnl[?12l[?25h[?25lt')dnl[?12l[?25h[?25l.')dnl[?12l[?25h[?25ll')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25lc')dnl[?12l[?25h[?25la')dnl[?12l[?25h[?25ll')dnl[?12l[?25h[?25ld')dnl[?12l[?25h[?25lo')dnl[?12l[?25h[?25lm')dnl[?12l[?25h[?25la')dnl[?12l[?25h[?25li')dnl[?12l[?25h[?25ln')dnl[?12l[?25h[21;1H[K[4;35H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"sendmail.mc" "sendmail.mc" 180L, 7311C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# m4 sendmail.mc  sendmail.cf
#
# Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
#	All rights reserved.
# Copyright (c) 1983, 1995 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.
#
#

######################################################################
######################################################################
#####
#####		SENDMAIL CONFIGURATION FILE
#####
##### built by root@altnix.com on Fri May 2 12:26:08 IST 2014
##### in /etc/mail
##### using /usr/share/sendmail-cf/ as configuration include directory
#####
######################################################################
#####
#####	DO NOT EDIT THIS FILE!  Only edit the source .mc file.
#####
######################################################################
######################################################################

#####  $Id: cfhead.m4,v 8.116 2004/01/28 22:02:22 ca Exp $  #####
#####  $Id: cf.m4,v 8.32 1999/02/07 07:26:14 gshapiro Exp $  #####
#####  setup for linux  #####
#####  $Id: linux.m4,v 8.13 2000/09/17 17:30:00 gshapiro Exp $  #####



#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####


#####  $Id: no_default_msa.m4,v 8.2 2001/02/14 05:03:22 gshapiro Exp $  #####

#####  $Id: smrsh.m4,v 8.14 1999/11/18 05:06:23 ca Exp $  #####

#####  $Id: mailertable.m4,v 8.25 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: virtusertable.m4,v 8.23 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: redirect.m4,v 8.15 1999/08/06 01:47:36 gshapiro Exp $  #####

#####  $Id: always_add_domain.m4,v 8.11 2000/09/12 22:00:53 ca Exp $  #####

#####  $Id: use_cw_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: use_ct_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####

#####  $Id: access_db.m4,v 8.26 2004/06/24 18:10:02 ca Exp $  #####

#####  $Id: blacklist_recipients.m4,v 8.13 1999/04/02 02:25:13 gshapiro Exp $  #####

#####  $Id: accept_unresolvable_domains.m4,v 8.10 1999/02/07 07:26:07 gshapiro Exp $  #####


#
# Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
#	All rights reserved.
# Copyright (c) 1983, 1995 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.
#
#

######################################################################
######################################################################
#####
#####		SENDMAIL CONFIGURATION FILE
#####
##### built by root@altnix.com on Fri May 2 12:03:46 IST 2014
##### in /etc/mail
##### using /usr/share/sendmail-cf/ as configuration include directory
#####
######################################################################
#####
#####	DO NOT EDIT THIS FILE!  Only edit the source .mc file.
#####
######################################################################
######################################################################

#####  $Id: cfhead.m4,v 8.116 2004/01/28 22:02:22 ca Exp $  #####
#####  $Id: cf.m4,v 8.32 1999/02/07 07:26:14 gshapiro Exp $  #####
#####  setup for linux  #####
#####  $Id: linux.m4,v 8.13 2000/09/17 17:30:00 gshapiro Exp $  #####



#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####


#####  $Id: no_default_msa.m4,v 8.2 2001/02/14 05:03:22 gshapiro Exp $  #####

#####  $Id: smrsh.m4,v 8.14 1999/11/18 05:06:23 ca Exp $  #####

#####  $Id: mailertable.m4,v 8.25 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: virtusertable.m4,v 8.23 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: redirect.m4,v 8.15 1999/08/06 01:47:36 gshapiro Exp $  #####

#####  $Id: always_add_domain.m4,v 8.11 2000/09/12 22:00:53 ca Exp $  #####

#####  $Id: use_cw_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: use_ct_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####

#####  $Id: access_db.m4,v 8.26 2004/06/24 18:10:02 ca Exp $  #####

#####  $Id: blacklist_recipients.m4,v 8.13 1999/04/02 02:25:13 gshapiro Exp $  #####

#####  $Id: accept_unresolvable_domains.m4,v 8.10 1999/02/07 07:26:07 gshapiro Exp $  #####


#####  $Id: proto.m4,v 8.719 2006/03/30 20:50:13 ca Exp $  #####

# level 10 config file format
V10/Berkeley

# override file safeties - setting this option compromises system security,
# addressing the actual file configuration problem is preferred
# need to set this before any file actions are encountered in the cf file
#O DontBlameSendmail=safe

# default LDAP map specification
# need to set this now before any LDAP maps are defined
#O LDAPDefaultSpec=-h localhost

##################
#   local info   #
##################

# my LDAP cluster
# need to set this before any LDAP lookups are done (including classes)
#D{sendmailMTACluster}$m

Cwlocalhost
# file containing names of hosts for which we receive email
Fw/etc/mail/local-host-names

# my official domain name
# ... define this only if sendmail cannot automatically determine your domain
#Dj$w.Foo.COM

# host/domain names ending with a token in class P are canonical
CP.

# "Smart" relay host (may be null)
DS


# operators that cannot be in local usernames (i.e., network indicators)
CO @ % !

# a class with just dot (for identifying canonical names)
C..

# a class with just a left bracket (for identifying domain literals)
C[[

# access_db acceptance class
C{Accept}OK RELAY


C{ResOk}OKR


# Hosts for which relaying is permitted ($=R)
FR-o /etc/mail/relay-domains

# arithmetic map
Karith arith
# macro storage map
Kmacro macro
# possible values for TLS_connection in access map
C{Tls}VERIFY ENCR





# dequoting map
Kdequote dequote

# class E: names that should be exposed as from this host, even if we masquerade
# class L: names that should be delivered locally, even if we have a relay
# class M: domains that should be converted to $M
# class N: domains that should not be converted to $M
#CL root
C{E}root
C{w}altnix.com



# my name for error messages
DnMAILER-DAEMON


# Mailer table (overriding domains)
Kmailertable hash -o /etc/mail/mailertable.db

# Virtual user table (maps incoming users)
Kvirtuser hash -o /etc/mail/virtusertable.db

CPREDIRECT

# Access list database (for spam stomping)
Kaccess hash -T<TMPF> -o /etc/mail/access.db

# Configuration version number
DZ8.13.8


###############
#   Options   #
###############

# strip message body to 7 bits on input?
O SevenBitInput=False

# 8-bit data handling
#O EightBitMode=pass8

# wait for alias file rebuild (default units: minutes)
O AliasWait=10

# location of alias file
O AliasFile=/etc/aliases

# minimum number of free blocks on filesystem
O MinFreeBlocks=100

# maximum message size
#O MaxMessageSize=0

# substitution for space (blank) characters
O BlankSub=.

# avoid connecting to "expensive" mailers on initial submission?
O HoldExpensive=False

# checkpoint queue runs after every N successful deliveries
#O CheckpointInterval=10

# default delivery mode
O DeliveryMode=background

# error message header/file
#O ErrorHeader=/etc/mail/error-header

# error mode
#O ErrorMode=print

# save Unix-style "From_" lines at top of header?
#O SaveFromLine=False

# queue file mode (qf files)
#O QueueFileMode=0600

# temporary file mode
O TempFileMode=0600

# match recipients against GECOS field?
#O MatchGECOS=False

# maximum hop count
#O MaxHopCount=25

# location of help file
O HelpFile=/etc/mail/helpfile

# ignore dots as terminators in incoming messages?
#O IgnoreDots=False

# name resolver options
#O ResolverOptions=+AAONLY

# deliver MIME-encapsulated error messages?
O SendMimeErrors=True

# Forward file search path
O ForwardPath=$z/.forward.$w:$z/.forward

# open connection cache size
O ConnectionCacheSize=2

# open connection cache timeout
O ConnectionCacheTimeout=5m

# persistent host status directory
#O HostStatusDirectory=.hoststat

# single thread deliveries (requires HostStatusDirectory)?
#O SingleThreadDelivery=False

# use Errors-To: header?
O UseErrorsTo=False

# log level
O LogLevel=9

# send to me too, even in an alias expansion?
#O MeToo=True

# verify RHS in newaliases?
O CheckAliases=False

# default messages to old style headers if no special punctuation?
O OldStyleHeaders=True

# SMTP daemon options
O DaemonPortOptions=Name=MTA

# SMTP client options
#O ClientPortOptions=Family=inet, Address=0.0.0.0

# Modifiers to define {daemon_flags} for direct submissions
#O DirectSubmissionModifiers

# Use as mail submission program? See sendmail/SECURITY
#O UseMSP

# privacy flags
O PrivacyOptions=authwarnings,novrfy,noexpn,restrictqrun

# who (if anyone) should get extra copies of error messages
#O PostmasterCopy=Postmaster

# slope of queue-only function
#O QueueFactor=600000

# limit on number of concurrent queue runners
#O MaxQueueChildren

# maximum number of queue-runners per queue-grouping with multiple queues
#O MaxRunnersPerQueue=1

# priority of queue runners (nice(3))
#O NiceQueueRun

# shall we sort the queue by hostname first?
#O QueueSortOrder=priority

# minimum time in queue before retry
#O MinQueueAge=30m

# how many jobs can you process in the queue?
#O MaxQueueRunSize=0

# perform initial split of envelope without checking MX records
#O FastSplit=1

# queue directory
O QueueDirectory=/var/spool/mqueue

# key for shared memory; 0 to turn off
#O SharedMemoryKey=0



# timeouts (many of these)
#O Timeout.initial=5m
O Timeout.connect=1m
#O Timeout.aconnect=0s
#O Timeout.iconnect=5m
#O Timeout.helo=5m
#O Timeout.mail=10m
#O Timeout.rcpt=1h
#O Timeout.datainit=5m
#O Timeout.datablock=1h
#O Timeout.datafinal=1h
#O Timeout.rset=5m
#O Timeout.quit=2m
#O Timeout.misc=2m
#O Timeout.command=1h
O Timeout.ident=0
#O Timeout.fileopen=60s
#O Timeout.control=2m
O Timeout.queuereturn=5d
#O Timeout.queuereturn.normal=5d
#O Timeout.queuereturn.urgent=2d
#O Timeout.queuereturn.non-urgent=7d
#O Timeout.queuereturn.dsn=5d
O Timeout.queuewarn=4h
#O Timeout.queuewarn.normal=4h
#O Timeout.queuewarn.urgent=1h
#O Timeout.queuewarn.non-urgent=12h
#O Timeout.queuewarn.dsn=4h
#O Timeout.hoststatus=30m
#O Timeout.resolver.retrans=5s
#O Timeout.resolver.retrans.first=5s
#O Timeout.resolver.retrans.normal=5s
#O Timeout.resolver.retry=4
#O Timeout.resolver.retry.first=4
#O Timeout.resolver.retry.normal=4
#O Timeout.lhlo=2m
#O Timeout.auth=10m
#O Timeout.starttls=1h

# time for DeliverBy; extension disabled if less than 0
#O DeliverByMin=0

# should we not prune routes in route-addr syntax addresses?
#O DontPruneRoutes=False

# queue up everything before forking?
O SuperSafe=True

# status file
O StatusFile=/var/log/mail/statistics

# time zone handling:
#  if undefined, use system default
#  if defined but null, use TZ envariable passed in
#  if defined and non-null, use that info
#O TimeZoneSpec=

# default UID (can be username or userid:groupid)
O DefaultUser=8:12

# list of locations of user database file (null means no lookup)
O UserDatabaseSpec=/etc/mail/userdb.db

# fallback MX host
#O FallbackMXhost=fall.back.host.net

# fallback smart host
#O FallbackSmartHost=fall.back.host.net

# if we are the best MX host for a site, try it directly instead of config err
O TryNullMXList=True

# load average at which we just queue messages
#O QueueLA=8

# load average at which we refuse connections
#O RefuseLA=12

# log interval when refusing connections for this long
#O RejectLogInterval=3h

# load average at which we delay connections; 0 means no limit
#O DelayLA=0

# maximum number of children we allow at one time
#O MaxDaemonChildren=0

# maximum number of new connections per second
#O ConnectionRateThrottle=0

# Width of the window 
#O ConnectionRateWindowSize=60s

# work recipient factor
#O RecipientFactor=30000

# deliver each queued job in a separate process?
#O ForkEachJob=False

# work class factor
#O ClassFactor=1800

# work time factor
#O RetryFactor=90000

# default character set
#O DefaultCharSet=unknown-8bit

# service switch file (name hardwired on Solaris, Ultrix, OSF/1, others)
#O ServiceSwitchFile=/etc/mail/service.switch

# hosts file (normally /etc/hosts)
#O HostsFile=/etc/hosts

# dialup line delay on connection failure
#O DialDelay=0s

# action to take if there are no recipients in the message
#O NoRecipientAction=none

# chrooted environment for writing to files
#O SafeFileEnvironment

# are colons OK in addresses?
#O ColonOkInAddr=True

# shall I avoid expanding CNAMEs (violates protocols)?
#O DontExpandCnames=False

# SMTP initial login message (old $e macro)
O SmtpGreetingMessage=$j Sendmail $v/$Z; $b

# UNIX initial From header format (old $l macro)
O UnixFromLine=From $g $d

# From: lines that have embedded newlines are unwrapped onto one line
#O SingleLineFromHeader=False

# Allow HELO SMTP command that does not include a host name
#O AllowBogusHELO=False

# Characters to be quoted in a full name phrase (@,;:\()[] are automatic)
#O MustQuoteChars=.

# delimiter (operator) characters (old $o macro)
O OperatorChars=.:%@!^/[]+

# shall I avoid calling initgroups(3) because of high NIS costs?
#O DontInitGroups=False

# are group-writable :include: and .forward files (un)trustworthy?
# True (the default) means they are not trustworthy.
#O UnsafeGroupWrites=True


# where do errors that occur when sending errors get sent?
#O DoubleBounceAddress=postmaster

# where to save bounces if all else fails
#O DeadLetterDrop=/var/tmp/dead.letter

# what user id do we assume for the majority of the processing?
#O RunAsUser=sendmail

# maximum number of recipients per SMTP envelope
#O MaxRecipientsPerMessage=0

# limit the rate recipients per SMTP envelope are accepted
# once the threshold number of recipients have been rejected
#O BadRcptThrottle=0

# shall we get local names from our installed interfaces?
O DontProbeInterfaces=True

# Return-Receipt-To: header implies DSN request
#O RrtImpliesDsn=False

# override connection address (for testing)
#O ConnectOnlyTo=0.0.0.0

# Trusted user for file ownership and starting the daemon
#O TrustedUser=root

# Control socket for daemon management
#O ControlSocketName=/var/spool/mqueue/.control

# Maximum MIME header length to protect MUAs
#O MaxMimeHeaderLength=0/0

# Maximum length of the sum of all headers
#O MaxHeadersLength=32768

# Maximum depth of alias recursion
#O MaxAliasRecursion=10

# location of pid file
#O PidFile=/var/run/sendmail.pid

# Prefix string for the process title shown on 'ps' listings
#O ProcessTitlePrefix=prefix

# Data file (df) memory-buffer file maximum size
#O DataFileBufferSize=4096

# Transcript file (xf) memory-buffer file maximum size
#O XscriptFileBufferSize=4096

# lookup type to find information about local mailboxes
#O MailboxDatabase=pw

# override compile time flag REQUIRES_DIR_FSYNC
#O RequiresDirfsync=true

# list of authentication mechanisms
#O AuthMechanisms=EXTERNAL GSSAPI KERBEROS_V4 DIGEST-MD5 CRAM-MD5

# Authentication realm
#O AuthRealm

# default authentication information for outgoing connections
#O DefaultAuthInfo=/etc/mail/default-auth-info

# SMTP AUTH flags
O AuthOptions=A

# SMTP AUTH maximum encryption strength
#O AuthMaxBits

# SMTP STARTTLS server options
#O TLSSrvOptions

# Input mail filters
#O InputMailFilters


# CA directory
#O CACertPath
# CA file
#O CACertFile
# Server Cert
#O ServerCertFile
# Server private key
#O ServerKeyFile
# Client Cert
#O ClientCertFile
# Client private key
#O ClientKeyFile
# File containing certificate revocation lists 
#O CRLFile
# DHParameters (only required if DSA/DH is used)
#O DHParameters
# Random data source (required for systems without /dev/urandom under OpenSSL)
#O RandFile

############################
# QUEUE GROUP DEFINITIONS  #
############################


###########################
#   Message precedences   #
###########################

Pfirst-class=0
Pspecial-delivery=100
Plist=-30
Pbulk=-60
Pjunk=-100

#####################
#   Trusted users   #
#####################

# this is equivalent to setting class "t"
Ft/etc/mail/trusted-users
Troot
Tdaemon
Tuucp

#########################
#   Format of headers   #
#########################

H?P?Return-Path: <$g>
HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
	$.$?{auth_type}(authenticated$?{auth_ssf} bits=${auth_ssf}$.)
	$.by $j ($v/$Z)$?r with $r$. id $i$?{tls_version}
	(version=${tls_version} cipher=${cipher} bits=${cipher_bits} verify=${verify})$.$?u
	for $u; $|;
	$.$b
H?D?Resent-Date: $a
H?D?Date: $a
H?F?Resent-From: $?x$x <$g>$|$g$.
H?F?From: $?x$x <$g>$|$g$.
H?x?Full-Name: $x
# HPosted-Date: $a
# H?l?Received-Date: $b
H?M?Resent-Message-Id: <$t.$i@$j>
H?M?Message-Id: <$t.$i@$j>

#
######################################################################
######################################################################
#####
#####			REWRITING RULES
#####
######################################################################
######################################################################

############################################
###  Ruleset 3 -- Name Canonicalization  ###
############################################
Scanonify=3

# handle null input (translate to <@> special case)
R$@			$@ <@>

# strip group: syntax (not inside angle brackets!) and trailing semicolon
R$*			$: $1 <@>			mark addresses
R$* < $* > $* <@>	$: $1 < $2 > $3			unmark <addr>
R@ $* <@>		$: @ $1				unmark @host:...
R$* [ IPv6 : $+ ] <@>	$: $1 [ IPv6 : $2 ]		unmark IPv6 addr
R$* :: $* <@>		$: $1 :: $2			unmark node::addr
R:include: $* <@>	$: :include: $1			unmark :include:...
R$* : $* [ $* ]		$: $1 : $2 [ $3 ] <@>		remark if leading colon
R$* : $* <@>		$: $2				strip colon if marked
R$* <@>			$: $1				unmark
R$* ;			   $1				strip trailing semi
R$* < $+ :; > $*	$@ $2 :; <@>			catch <list:;>
R$* < $* ; >		   $1 < $2 >			bogus bracketed semi

# null input now results from list:; syntax
R$@			$@ :; <@>

# strip angle brackets -- note RFC733 heuristic to get innermost item
R$*			$: < $1 >			housekeeping <>
R$+ < $* >		   < $2 >			strip excess on left
R< $* > $+		   < $1 >			strip excess on right
R<>			$@ < @ >			MAIL FROM:<> case
R< $+ >			$: $1				remove housekeeping <>

# strip route address <@a,@b,@c:user@d> -> <user@d>
R@ $+ , $+		$2
R@ [ $* ] : $+		$2
R@ $+ : $+		$2

# find focus for list syntax
R $+ : $* ; @ $+	$@ $>Canonify2 $1 : $2 ; < @ $3 >	list syntax
R $+ : $* ;		$@ $1 : $2;			list syntax

# find focus for @ syntax addresses
R$+ @ $+		$: $1 < @ $2 >			focus on domain
R$+ < $+ @ $+ >		$1 $2 < @ $3 >			move gaze right
R$+ < @ $+ >		$@ $>Canonify2 $1 < @ $2 >	already canonical


# convert old-style addresses to a domain-based address
R$- ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	resolve uucp names
R$+ . $- ! $+		$@ $>Canonify2 $3 < @ $1 . $2 >		domain uucps
R$+ ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	uucp subdomains

# if we have % signs, take the rightmost one
R$* % $*		$1 @ $2				First make them all @s.
R$* @ $* @ $*		$1 % $2 @ $3			Undo all but the last.
R$* @ $*		$@ $>Canonify2 $1 < @ $2 >	Insert < > and finish

# else we must be a local name
R$*			$@ $>Canonify2 $1


################################################
###  Ruleset 96 -- bottom half of ruleset 3  ###
################################################

SCanonify2=96

# handle special cases for local names
R$* < @ localhost > $*		$: $1 < @ $j . > $2		no domain at all
R$* < @ localhost . $m > $*	$: $1 < @ $j . > $2		local domain
R$* < @ localhost . UUCP > $*	$: $1 < @ $j . > $2		.UUCP domain

# check for IPv4/IPv6 domain literal
R$* < @ [ $+ ] > $*		$: $1 < @@ [ $2 ] > $3		mark [addr]
R$* < @@ $=w > $*		$: $1 < @ $j . > $3		self-literal
R$* < @@ $+ > $*		$@ $1 < @ $2 > $3		canon IP addr





# if really UUCP, handle it immediately

# try UUCP traffic as a local address
R$* < @ $+ . UUCP > $*		$: $1 < @ $[ $2 $] . UUCP . > $3
R$* < @ $+ . . UUCP . > $*	$@ $1 < @ $2 . > $3

# hostnames ending in class P are always canonical
R$* < @ $* $=P > $*		$: $1 < @ $2 $3 . > $4
R$* < @ $* $~P > $*		$: $&{daemon_flags} $| $1 < @ $2 $3 > $4
R$* CC $* $| $* < @ $+.$+ > $*	$: $3 < @ $4.$5 . > $6
R$* CC $* $| $*			$: $3
# pass to name server to make hostname canonical
R$* $| $* < @ $* > $*		$: $2 < @ $[ $3 $] > $4
R$* $| $*			$: $2

# local host aliases and pseudo-domains are always canonical
R$* < @ $=w > $*		$: $1 < @ $2 . > $3
R$* < @ $=M > $*		$: $1 < @ $2 . > $3
R$* < @ $={VirtHost} > $* 	$: $1 < @ $2 . > $3
R$* < @ $* . . > $*		$1 < @ $2 . > $3


##################################################
###  Ruleset 4 -- Final Output Post-rewriting  ###
##################################################
Sfinal=4

R$+ :; <@>		$@ $1 :				handle <list:;>
R$* <@>			$@				handle <> and list:;

# strip trailing dot off possibly canonical name
R$* < @ $+ . > $*	$1 < @ $2 > $3

# eliminate internal code
R$* < @ *LOCAL* > $*	$1 < @ $j > $2

# externalize local domain info
R$* < $+ > $*		$1 $2 $3			defocus
R@ $+ : @ $+ : $+	@ $1 , @ $2 : $3		<route-addr> canonical
R@ $*			$@ @ $1				... and exit

# UUCP must always be presented in old form
R$+ @ $- . UUCP		$2!$1				u@h.UUCP => h!u

# delete duplicate local names
R$+ % $=w @ $=w		$1 @ $2				u%host@host => u@host



##############################################################
###   Ruleset 97 -- recanonicalize and call ruleset zero   ###
###		   (used for recursive calls)		   ###
##############################################################

SRecurse=97
R$*			$: $>canonify $1
R$*			$@ $>parse $1


######################################
###   Ruleset 0 -- Parse Address   ###
######################################

Sparse=0

R$*			$: $>Parse0 $1		initial parsing
R<@>			$#local $: <@>		special case error msgs
R$*			$: $>ParseLocal $1	handle local hacks
R$*			$: $>Parse1 $1		final parsing

#
#  Parse0 -- do initial syntax checking and eliminate local addresses.
#	This should either return with the (possibly modified) input
#	or return with a #error mailer.  It should not return with a
#	#mailer other than the #error mailer.
#

SParse0
R<@>			$@ <@>			special case error msgs
R$* : $* ; <@>		$#error $@ 5.1.3 $: "553 List:; syntax illegal for recipient addresses"
R@ <@ $* >		< @ $1 >		catch "@@host" bogosity
R<@ $+>			$#error $@ 5.1.3 $: "553 User address required"
R$+ <@>			$#error $@ 5.1.3 $: "553 Hostname required"
R$*			$: <> $1
R<> $* < @ [ $* ] : $+ > $*	$1 < @ [ $2 ] : $3 > $4
R<> $* < @ [ $* ] , $+ > $*	$1 < @ [ $2 ] , $3 > $4
R<> $* < @ [ $* ] $+ > $*	$#error $@ 5.1.2 $: "553 Invalid address"
R<> $* < @ [ $+ ] > $*		$1 < @ [ $2 ] > $3
R<> $* <$* : $* > $*	$#error $@ 5.1.3 $: "553 Colon illegal in host name part"
R<> $*			$1
R$* < @ . $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* .. $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* @ > $*	$#error $@ 5.1.2 $: "553 Invalid route address"
R$* @ $* < @ $* > $*	$#error $@ 5.1.3 $: "553 Invalid route address"
R$* , $~O $*		$#error $@ 5.1.3 $: "553 Invalid route address"


# now delete the local info -- note $=O to find characters that cause forwarding
R$* < @ > $*		$@ $>Parse0 $>canonify $1	user@ => user
R< @ $=w . > : $*	$@ $>Parse0 $>canonify $2	@here:... -> ...
R$- < @ $=w . >		$: $(dequote $1 $) < @ $2 . >	dequote "foo"@here
R< @ $+ >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ $=w . >	$@ $>Parse0 $>canonify $1 $2 $3	...@here -> ...
R$- 			$: $(dequote $1 $) < @ *LOCAL* >	dequote "foo"
R< @ *LOCAL* >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ *LOCAL* >
			$@ $>Parse0 $>canonify $1 $2 $3	...@*LOCAL* -> ...
R$* < @ *LOCAL* >	$: $1

#
#  Parse1 -- the bottom half of ruleset 0.
#

SParse1

# handle numeric address spec
R$* < @ [ $+ ] > $*	$: $>ParseLocal $1 < @ [ $2 ] > $3	numeric internet spec
R$* < @ [ $+ ] > $*	$: $1 < @ [ $2 ] : $S > $3	Add smart host to path
R$* < @ [ $+ ] : > $*		$#esmtp $@ [$2] $: $1 < @ [$2] > $3	no smarthost: send
R$* < @ [ $+ ] : $- : $*> $*	$#$3 $@ $4 $: $1 < @ [$2] > $5	smarthost with mailer
R$* < @ [ $+ ] : $+ > $*	$#esmtp $@ $3 $: $1 < @ [$2] > $4	smarthost without mailer

# handle virtual users
R$+			$: <!> $1		Mark for lookup
R<!> $+ < @ $={VirtHost} . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<!> $+ < @ $=w . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+ + $+ < @ $* . >
			$: < $(virtuser $1 + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $+ < @ $+ . >	$: < $(virtuser + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser @ $3 $@ $1 $@ $2 $@ +$2 $: ! $) > $1 + $2 < @ $3 . >
R<@> $+ < @ $+ . >	$: < $(virtuser @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+			$: $1
R<!> $+			$: $1
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- $+ > $* 	$#error $@ $(dequote $1 $) $: $2
R< $+ > $+ < @ $+ >	$: $>Recurse $1

# short circuit local delivery so forwarded email works


R$=L < @ $=w . >	$#local $: @ $1			special local names
R$+ < @ $=w . >		$#local $: $1			regular local name

# not local -- try mailer table lookup
R$* <@ $+ > $*		$: < $2 > $1 < @ $2 > $3	extract host name
R< $+ . > $*		$: < $1 > $2			strip trailing dot
R< $+ > $*		$: < $(mailertable $1 $) > $2	lookup
R< $~[ : $* > $* 	$>MailerToTriple < $1 : $2 > $3		check -- resolved?
R< $+ > $*		$: $>Mailertable <$1> $2		try domain

# resolve remotely connected UUCP links (if any)

# resolve fake top level domains by forwarding to other hosts



# pass names that still have a host to a smarthost (if defined)
R$* < @ $* > $*		$: $>MailerToTriple < $S > $1 < @ $2 > $3	glue on smarthost name

# deal with other remote names
R$* < @$* > $*		$#esmtp $@ $2 $: $1 < @ $2 > $3	user@host.domain

# handle locally delivered names
R$=L			$#local $: @ $1		special local names
R$+			$#local $: $1			regular local names

###########################################################################
###   Ruleset 5 -- special rewriting after aliases have been expanded   ###
###########################################################################

SLocal_localaddr
Slocaladdr=5
R$+			$: $1 $| $>"Local_localaddr" $1
R$+ $| $#ok		$@ $1			no change
R$+ $| $#$*		$#$2
R$+ $| $*		$: $1




# deal with plussed users so aliases work nicely
R$+ + *			$#local $@ $&h $: $1
R$+ + $*		$#local $@ + $2 $: $1 + *

# prepend an empty "forward host" on the front
R$+			$: <> $1



R< > $+			$: < > < $1 <> $&h >		nope, restore +detail

R< > < $+ <> + $* >	$: < > < $1 + $2 >		check whether +detail
R< > < $+ <> $* >	$: < > < $1 >			else discard
R< > < $+ + $* > $*	   < > < $1 > + $2 $3		find the user part
R< > < $+ > + $*	$#local $@ $2 $: @ $1		strip the extra +
R< > < $+ >		$@ $1				no +detail
R$+			$: $1 <> $&h			add +detail back in

R$+ <> + $*		$: $1 + $2			check whether +detail
R$+ <> $*		$: $1				else discard
R< local : $* > $*	$: $>MailerToTriple < local : $1 > $2	no host extension
R< error : $* > $*	$: $>MailerToTriple < error : $1 > $2	no host extension

R< $~[ : $+ > $+	$: $>MailerToTriple < $1 : $2 > $3 < @ $2 >

R< $+ > $+		$@ $>MailerToTriple < $1 > $2 < @ $1 >


###################################################################
###  Ruleset 90 -- try domain part of mailertable entry 	###
###################################################################

SMailertable=90
R$* <$- . $+ > $*	$: $1$2 < $(mailertable .$3 $@ $1$2 $@ $2 $) > $4
R$* <$~[ : $* > $*	$>MailerToTriple < $2 : $3 > $4		check -- resolved?
R$* < . $+ > $* 	$@ $>Mailertable $1 . <$2> $3		no -- strip & try again
R$* < $* > $*		$: < $(mailertable . $@ $1$2 $) > $3	try "."
R< $~[ : $* > $*	$>MailerToTriple < $1 : $2 > $3		"." found?
R< $* > $*		$@ $2				no mailertable match

###################################################################
###  Ruleset 95 -- canonify mailer:[user@]host syntax to triple	###
###################################################################

SMailerToTriple=95
R< > $*				$@ $1			strip off null relay
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- : $+ > $*		$#error $@ $(dequote $1 $) $: $2
R< error : $+ > $*		$#error $: $1
R< local : $* > $*		$>CanonLocal < $1 > $2
R< $~[ : $+ @ $+ > $*<$*>$*	$# $1 $@ $3 $: $2<@$3>	use literal user
R< $~[ : $+ > $*		$# $1 $@ $2 $: $3	try qualified mailer
R< $=w > $*			$@ $2			delete local host
R< $+ > $*			$#relay $@ $1 $: $2	use unqualified mailer

###################################################################
###  Ruleset CanonLocal -- canonify local: syntax		###
###################################################################

SCanonLocal
# strip local host from routed addresses
R< $* > < @ $+ > : $+		$@ $>Recurse $3
R< $* > $+ $=O $+ < @ $+ >	$@ $>Recurse $2 $3 $4

# strip trailing dot from any host name that may appear
R< $* > $* < @ $* . >		$: < $1 > $2 < @ $3 >

# handle local: syntax -- use old user, either with or without host
R< > $* < @ $* > $*		$#local $@ $1@$2 $: $1
R< > $+				$#local $@ $1    $: $1

# handle local:user@host syntax -- ignore host part
R< $+ @ $+ > $* < @ $* >	$: < $1 > $3 < @ $4 >

# handle local:user syntax
R< $+ > $* <@ $* > $*		$#local $@ $2@$3 $: $1
R< $+ > $* 			$#local $@ $2    $: $1

###################################################################
###  Ruleset 93 -- convert header names to masqueraded form	###
###################################################################

SMasqHdr=93


# do not masquerade anything in class N
R$* < @ $* $=N . >	$@ $1 < @ $2 $3 . >

R$* < @ *LOCAL* >	$@ $1 < @ $j . >

###################################################################
###  Ruleset 94 -- convert envelope names to masqueraded form	###
###################################################################

SMasqEnv=94
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

###################################################################
###  Ruleset 98 -- local part of ruleset zero (can be null)	###
###################################################################

SParseLocal=98

# addresses sent to foo@host.REDIRECT will give a 551 error code
R$* < @ $+ .REDIRECT. >		$: $1 < @ $2 . REDIRECT . > < ${opMode} >
R$* < @ $+ .REDIRECT. > <i>	$: $1 < @ $2 . REDIRECT. >
R$* < @ $+ .REDIRECT. > < $- >	$#error $@ 5.1.1 $: "551 User has moved; please try " <$1@$2>




######################################################################
###  D: LookUpDomain -- search for domain in access database
###
###	Parameters:
###		<$1> -- key (domain name)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SD
R<$*> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <[$+.$-]> <$+> <$- $-> <$*>	$@ $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+::$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+:$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <$+.$+> <$+> <$- $-> <$*>	$@ $>D <$2> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  A: LookUpAddress -- search for host address in access database
###
###	Parameters:
###		<$1> -- key (dot quadded host address)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed through)
######################################################################

SA
R<$+> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <$+::$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+:$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+.$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  CanonAddr --	Convert an address into a standard form for
###			relay checking.  Route address syntax is
###			crudely converted into a %-hack address.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed address, not in source route form
######################################################################

SCanonAddr
R$*			$: $>Parse0 $>canonify $1	make domain canonical


######################################################################
###  ParseRecipient --	Strip off hosts in $=R as well as possibly
###			$* $=m or the access database.
###			Check user portion for host separators.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed, non-local-relaying address
######################################################################

SParseRecipient
R$*				$: <?> $>CanonAddr $1
R<?> $* < @ $* . >		<?> $1 < @ $2 >			strip trailing dots
R<?> $- < @ $* >		$: <?> $(dequote $1 $) < @ $2 >	dequote local part

# if no $=O character, no host in the user portion, we are done
R<?> $* $=O $* < @ $* >		$: <NO> $1 $2 $3 < @ $4>
R<?> $*				$@ $1


R<NO> $* < @ $* $=R >		$: <RELAY> $1 < @ $2 $3 >
R<NO> $* < @ $+ >		$: $>D <$2> <NO> <+ To> <$1 < @ $2 >>
R<$+> <$+>			$: <$1> $2



R<RELAY> $* < @ $* >		$@ $>ParseRecipient $1
R<$+> $*			$@ $2


######################################################################
###  check_relay -- check hostname/address on SMTP startup
######################################################################



SLocal_check_relay
Scheck_relay
R$*			$: $1 $| $>"Local_check_relay" $1
R$* $| $* $| $#$*	$#$3
R$* $| $* $| $*		$@ $>"Basic_check_relay" $1 $| $2

SBasic_check_relay
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

R$+ $| $+		$: $>D < $1 > <?> <+ Connect> < $2 >
R   $| $+		$: $>A < $1 > <?> <+ Connect> <>	empty client_name
R<?> <$+>		$: $>A < $1 > <?> <+ Connect> <>	no: another lookup
R<?> <$*>		$: OK				found nothing
R<$={Accept}> <$*>	$@ $1				return value of lookup
R<REJECT> <$*>		$#error $@ 5.7.1 $: "550 Access denied"
R<DISCARD> <$*>		$#discard $: discard
R<QUARANTINE:$+> <$*>	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> <$*>	$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> <$*>		$#error $: $1
R<$* <TMPF>> <$*>		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> <$*>		$#error $: $1



######################################################################
###  check_mail -- check SMTP MAIL FROM: command argument
######################################################################

SLocal_check_mail
Scheck_mail
R$*			$: $1 $| $>"Local_check_mail" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_mail" $1

SBasic_check_mail
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

# authenticated?
R$*			$: $1 $| $>"tls_client" $&{verify} $| MAIL
R$* $| $#$+		$#$2
R$* $| $*		$: $1

R<>			$@ <OK>			we MUST accept <> (RFC 1123)
R$+			$: <?> $1
R<?><$+>		$: <@> <$1>
R<?>$+			$: <@> <$1>
R$*			$: $&{daemon_flags} $| $1
R$* f $* $| <@> < $* @ $- >	$: < ? $&{client_name} > < $3 @ $4 >
R$* u $* $| <@> < $* >	$: <?> < $3 >
R$* $| $*		$: $2
# handle case of @localhost on address
R<@> < $* @ localhost >	$: < ? $&{client_name} > < $1 @ localhost >
R<@> < $* @ [127.0.0.1] >
			$: < ? $&{client_name} > < $1 @ [127.0.0.1] >
R<@> < $* @ localhost.$m >
			$: < ? $&{client_name} > < $1 @ localhost.$m >
R<@> < $* @ localhost.localdomain >
			$: < ? $&{client_name} > < $1 @ localhost.localdomain >
R<@> < $* @ localhost.UUCP >
			$: < ? $&{client_name} > < $1 @ localhost.UUCP >
R<@> $*			$: $1			no localhost as domain
R<? $=w> $*		$: $2			local client: ok
R<? $+> <$+>		$#error $@ 5.5.4 $: "553 Real domain name required for sender address"
R<?> $*			$: $1
R$*			$: <?> $>CanonAddr $1		canonify sender address and mark it
R<?> $* < @ $+ . >	<?> $1 < @ $2 >			strip trailing dots
# handle non-DNS hostnames (*.bitnet, *.decnet, *.uucp, etc)
R<?> $* < @ $* $=P >	$: <OKR> $1 < @ $2 $3 >
R<?> $* < @ $j >	$: <OKR> $1 < @ $j >
R<?> $* < @ $+ >	$: <OKR> $1 < @ $2 >		... unresolvable OK

# check sender address: user@address, user@, address
R<$+> $+ < @ $* >	$: @<$1> <$2 < @ $3 >> $| <F:$2@$3> <U:$2@> <D:$3>
R<$+> $+		$: @<$1> <$2> $| <U:$2@>
R@ <$+> <$*> $| <$+>	$: <@> <$1> <$2> $| $>SearchList <+ From> $| <$3> <>
R<@> <$+> <$*> $| <$*>	$: <$3> <$1> <$2>		reverse result
# retransform for further use
R<?> <$+> <$*>		$: <$1> $2	no match
R<$+> <$+> <$*>		$: <$1> $3	relevant result, keep it

# handle case of no @domain on address
R<?> $*			$: $&{daemon_flags} $| <?> $1
R$* u $* $| <?> $*	$: <OKR> $3
R$* $| $*		$: $2
R<?> $*			$: < ? $&{client_addr} > $1
R<?> $*			$@ <OKR>			...local unqualed ok
R<? $+> $*		$#error $@ 5.5.4 $: "553 Domain name required for sender address " $&f
							...remote is not
# check results
R<?> $*			$: @ $1		mark address: nothing known about it
R<$={ResOk}> $*		$@ <OKR>	domain ok: stop
R<TEMP> $*		$#error $@ 4.1.8 $: "451 Domain of sender address " $&f " does not resolve"
R<PERM> $*		$#error $@ 5.1.8 $: "553 Domain of sender address " $&f " does not exist"
R<$={Accept}> $*	$# $1		accept from access map
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<REJECT> $*		$#error $@ 5.7.1 $: "550 Access denied"
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db

######################################################################
###  check_rcpt -- check SMTP RCPT TO: command argument
######################################################################

SLocal_check_rcpt
Scheck_rcpt
R$*			$: $1 $| $>"Local_check_rcpt" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_rcpt" $1

SBasic_check_rcpt
# empty address?
R<>			$#error $@ nouser $: "553 User address required"
R$@			$#error $@ nouser $: "553 User address required"
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2


######################################################################
R$*			$: $1 $| @ $>"Rcpt_ok" $1
R$* $| @ $#TEMP $+	$: $1 $| T $2
R$* $| @ $#$*		$#$2
R$* $| @ RELAY		$@ RELAY
R$* $| @ $*		$: O $| $>"Relay_ok" $1
R$* $| T $+		$: T $2 $| $>"Relay_ok" $1
R$* $| $#TEMP $+	$#error $2
R$* $| $#$*		$#$2
R$* $| RELAY		$@ RELAY
R T $+ $| $*		$#error $1
# anything else is bogus
R$*			$#error $@ 5.7.1 $: "550 Relaying denied"


######################################################################
### Rcpt_ok: is the recipient ok?
######################################################################
SRcpt_ok
R$*			$: $>ParseRecipient $1		strip relayable hosts



# blacklist local users or any host from receiving mail
R$*			$: <?> $1
R<?> $+ < @ $=w >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <U:$1@> <D:$2>
R<?> $+ < @ $* >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <D:$2>
R<?> $+			$: <> <$1> $| <U:$1@>
R<> <$*> $| <$+>	$: <@> <$1> $| $>SearchList <+ To> $| <$2> <>
R<@> <$*> $| <$*>	$: <$2> <$1>		reverse result
R<?> <$*>		$: @ $1		mark address as no match
R<$={Accept}> <$*>	$: @ $2		mark address as no match

R<REJECT> $*		$#error $@ 5.2.1 $: "550 Mailbox disabled for this recipient"
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db
R@ $*			$1		remove mark

# authenticated via TLS?
R$*			$: $1 $| $>RelayTLS	client authenticated?
R$* $| $# $+		$# $2			error/ok?
R$* $| $*		$: $1			no

R$*			$: $1 $| $>"Local_Relay_Auth" $&{auth_type}
R$* $| $# $*		$# $2
R$* $| NO		$: $1
R$* $| $*		$: $1 $| $&{auth_type}
R$* $|			$: $1
R$* $| $={TrustAuthMech}	$# RELAY
R$* $| $*		$: $1
# anything terminating locally is ok
R$+ < @ $=w >		$@ RELAY
R$+ < @ $* $=R >	$@ RELAY
R$+ < @ $+ >		$: $>D <$2> <?> <+ To> <$1 < @ $2 >>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2



# check for local user (i.e. unqualified address)
R$*			$: <?> $1
R<?> $* < @ $+ >	$: <REMOTE> $1 < @ $2 >
# local user is ok
R<?> $+			$@ RELAY
R<$+> $*		$: $2

######################################################################
### Relay_ok: is the relay/sender ok?
######################################################################
SRelay_ok
# anything originating locally is ok
# check IP address
R$*			$: $&{client_addr}
R$@			$@ RELAY		originated locally
R0			$@ RELAY		originated locally
R127.0.0.1		$@ RELAY		originated locally
RIPv6:::1		$@ RELAY		originated locally
R$=R $*			$@ RELAY		relayable IP address
R$*			$: $>A <$1> <?> <+ Connect> <$1>
R<RELAY> $* 		$@ RELAY		relayable IP address

R<<TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2
R$*			$: [ $1 ]		put brackets around it...
R$=w			$@ RELAY		... and see if it is local


# check client name: first: did it resolve?
R$*			$: < $&{client_resolve} >
R<TEMP>			$#TEMP $@ 4.4.0 $: "450 Relaying temporarily denied. Cannot resolve PTR record for " $&{client_addr}
R<FORGED>		$#error $@ 5.7.1 $: "550 Relaying denied. IP name possibly forged " $&{client_name}
R<FAIL>			$#error $@ 5.7.1 $: "550 Relaying denied. IP name lookup failed " $&{client_name}
R$*			$: <@> $&{client_name}
# pass to name server to make hostname canonical
R<@> $* $=P 		$:<?>  $1 $2
R<@> $+			$:<?>  $[ $1 $]
R$* .			$1			strip trailing dots
R<?> $=w		$@ RELAY
R<?> $* $=R			$@ RELAY
R<?> $*			$: $>D <$1> <?> <+ Connect> <$1>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2


######################################################################
###  F: LookUpFull -- search for an entry in access database
###
###	lookup of full key (which should be an address) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SF
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1+*@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1+*@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  E: LookUpExact -- search for an entry in access database
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SE
R<$*> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  U: LookUpUser -- search for an entry in access database
###
###	lookup of key (which should be a local part) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key (user@)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SU
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1+*@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1+*@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  SearchList: search a list of items in the access map
###	Parameters:
###		<exact tag> $| <mark:address> <mark:address> ... <>
###	where "exact" is either "+" or "!":
###	<+ TAG>	lookup with and w/o tag
###	<! TAG>	lookup with tag
###	possible values for "mark" are:
###		D: recursive host lookup (LookUpDomain)
###		E: exact lookup, no modifications
###		F: full lookup, try user+ext@domain and user@domain
###		U: user lookup, try user+ext and user (input must have trailing @)
###	return: <RHS of lookup> or <?> (not found)
######################################################################

# class with valid marks for SearchList
C{Src}E F D U 
SSearchList
# just call the ruleset with the name of the tag... nice trick...
R<$+> $| <$={Src}:$*> <$*>	$: <$1> $| <$4> $| $>$2 <$3> <?> <$1> <>
R<$+> $| <> $| <?> <>		$@ <?>
R<$+> $| <$+> $| <?> <>		$@ $>SearchList <$1> $| <$2>
R<$+> $| <$*> $| <$+> <>	$@ <$3>
R<$+> $| <$+>			$@ <$2>


######################################################################
###  trust_auth: is user trusted to authenticate as someone else?
###
###	Parameters:
###		$1: AUTH= parameter from MAIL command
######################################################################

SLocal_trust_auth
Strust_auth
R$*			$: $&{auth_type} $| $1
# required by RFC 2554 section 4.
R$@ $| $*		$#error $@ 5.7.1 $: "550 not authenticated"
R$* $| $&{auth_authen}		$@ identical
R$* $| <$&{auth_authen}>	$@ identical
R$* $| $*		$: $1 $| $>"Local_trust_auth" $2
R$* $| $#$*		$#$2
R$*			$#error $@ 5.7.1 $: "550 " $&{auth_authen} " not allowed to act as " $&{auth_author}

######################################################################
###  Relay_Auth: allow relaying based on authentication?
###
###	Parameters:
###		$1: ${auth_type}
######################################################################
SLocal_Relay_Auth

######################################################################
###  srv_features: which features to offer to a client?
###	(done in server)
######################################################################
Ssrv_features
R$*		$: $>D <$&{client_name}> <?> <! "Srv_Features"> <>
R<?>$*		$: $>A <$&{client_addr}> <?> <! "Srv_Features"> <>
R<?>$*		$: <$(access "Srv_Features": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#temp
R<$+>$*		$# $1

######################################################################
###  try_tls: try to use STARTTLS?
###	(done in client)
######################################################################
Stry_tls
R$*		$: $>D <$&{server_name}> <?> <! "Try_TLS"> <>
R<?>$*		$: $>A <$&{server_addr}> <?> <! "Try_TLS"> <>
R<?>$*		$: <$(access "Try_TLS": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<NO>$*		$#error $@ 5.7.1 $: "550 do not try TLS with " $&{server_name} " ["$&{server_addr}"]"

######################################################################
###  tls_rcpt: is connection with server "good" enough?
###	(done in client, per recipient)
###
###	Parameters:
###		$1: recipient
######################################################################
Stls_rcpt
R$*			$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$+			$: <?> $>CanonAddr $1
R<?> $+ < @ $+ . >	<?> $1 <@ $2 >
R<?> $+ < @ $+ >	$: $1 <@ $2 > $| <F:$1@$2> <U:$1@> <D:$2> <E:>
R<?> $+			$: $1 $| <U:$1@> <E:>
R$* $| $+	$: $1 $| $>SearchList <! "TLS_Rcpt"> $| $2 <>
R$* $| <?>	$@ OK
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$* $| <$+>	$@ $>"TLS_connection" $&{verify} $| <$2>

######################################################################
###  tls_client: is connection with client "good" enough?
###	(done in server)
###
###	Parameters:
###		${verify} $| (MAIL|STARTTLS)
######################################################################
Stls_client
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$* $| $*	$: $1 $| $>D <$&{client_name}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{client_addr}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Clt": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  tls_server: is connection with server "good" enough?
###	(done in client)
###
###	Parameter:
###		${verify}
######################################################################
Stls_server
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$*		$: $1 $| $>D <$&{server_name}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Srv": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  TLS_connection: is TLS connection "good" enough?
###
###	Parameters:
###		${verify} $| <Requirement> [<>]
###		Requirement: RHS from access map, may be ? for none.
######################################################################
STLS_connection
R$* $| <$*>$*			$: $1 $| <$2>
# create the appropriate error codes
R$* $| <PERM + $={Tls} $*>	$: $1 $| <503:5.7.0> <$2 $3>
R$* $| <TEMP + $={Tls} $*>	$: $1 $| <403:4.7.0> <$2 $3>
R$* $| <$={Tls} $*>		$: $1 $| <403:4.7.0> <$2 $3>
# deal with TLS handshake failures: abort
RSOFTWARE $| <$-:$+> $* 	$#error $@ $2 $: $1 " TLS handshake failed."
RSOFTWARE $| $* 		$#error $@ 4.7.0 $: "403 TLS handshake failed."
# deal with TLS protocol errors: abort
RPROTOCOL $| <$-:$+> $* 	$#error $@ $2 $: $1 " STARTTLS failed."
RPROTOCOL $| $* 		$#error $@ 4.7.0 $: "403 STARTTLS failed."
R$* $| <$*> <VERIFY>		$: <$2> <VERIFY> <> $1
R$* $| <$*> <VERIFY + $+>	$: <$2> <VERIFY> <$3> $1
R$* $| <$*> <$={Tls}:$->$*	$: <$2> <$3:$4> <> $1
R$* $| <$*> <$={Tls}:$- + $+>$*	$: <$2> <$3:$4> <$5> $1
R$* $| $*			$@ OK
# authentication required: give appropriate error
# other side did authenticate (via STARTTLS)
R<$*><VERIFY> <> OK		$@ OK
R<$*><VERIFY> <$+> OK		$: <$1> <REQ:0> <$2>
R<$*><VERIFY:$-> <$*> OK	$: <$1> <REQ:$2> <$3>
R<$*><ENCR:$-> <$*> $*		$: <$1> <REQ:$2> <$3>
R<$-:$+><VERIFY $*> <$*>	$#error $@ $2 $: $1 " authentication required"
R<$-:$+><VERIFY $*> <$*> FAIL	$#error $@ $2 $: $1 " authentication failed"
R<$-:$+><VERIFY $*> <$*> NO	$#error $@ $2 $: $1 " not authenticated"
R<$-:$+><VERIFY $*> <$*> NOT	$#error $@ $2 $: $1 " no authentication requested"
R<$-:$+><VERIFY $*> <$*> NONE	$#error $@ $2 $: $1 " other side does not support STARTTLS"
R<$-:$+><VERIFY $*> <$*> $+	$#error $@ $2 $: $1 " authentication failure " $4
R<$*><REQ:$-> <$*>		$: <$1> <REQ:$2> <$3> $>max $&{cipher_bits} : $&{auth_ssf}
R<$*><REQ:$-> <$*> $-		$: <$1> <$2:$4> <$3> $(arith l $@ $4 $@ $2 $)
R<$-:$+><$-:$-> <$*> TRUE	$#error $@ $2 $: $1 " encryption too weak " $4 " less than " $3
R<$-:$+><$-:$-> <$*> $*		$: <$1:$2 ++ $5>
R<$-:$+ ++ >			$@ OK
R<$-:$+ ++ $+ >			$: <$1:$2> <$3>
R<$-:$+> < $+ ++ $+ >		<$1:$2> <$3> <$4>
R<$-:$+> $+			$@ $>"TLS_req" $3 $| <$1:$2>

######################################################################
###  TLS_req: check additional TLS requirements
###
###	Parameters: [<list> <of> <req>] $| <$-:$+>
###		$-: SMTP reply code
###		$+: Enhanced Status Code
######################################################################
STLS_req
R $| $+		$@ OK
R<CN> $* $| <$+>		$: <CN:$&{TLS_Name}> $1 $| <$2>
R<CN:$&{cn_subject}> $* $| <$+>		$@ $>"TLS_req" $1 $| <$2>
R<CN:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " CN " $&{cn_subject} " does not match " $1
R<CS:$&{cert_subject}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CS:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Subject " $&{cert_subject} " does not match " $1
R<CI:$&{cert_issuer}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CI:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Issuer " $&{cert_issuer} " does not match " $1
ROK			$@ OK

######################################################################
###  max: return the maximum of two values separated by :
###
###	Parameters: [$-]:[$-]
######################################################################
Smax
R:		$: 0
R:$-		$: $1
R$-:		$: $1
R$-:$-		$: $(arith l $@ $1 $@ $2 $) : $1 : $2
RTRUE:$-:$-	$: $2
R$-:$-:$-	$: $2


######################################################################
###  RelayTLS: allow relaying based on TLS authentication
###
###	Parameters:
###		none
######################################################################
SRelayTLS
# authenticated?
R$*			$: <?> $&{verify}
R<?> OK			$: OK		authenticated: continue
R<?> $*			$@ NO		not authenticated
R$*			$: $&{cert_issuer}
R$+			$: $(access CERTISSUER:$1 $)
RRELAY			$# RELAY
RSUBJECT		$: <@> $&{cert_subject}
R<@> $+			$: <@> $(access CERTSUBJECT:$1 $)
R<@> RELAY		$# RELAY
R$*			$: NO

######################################################################
###  authinfo: lookup authinfo in the access map
###
###	Parameters:
###		$1: {server_name}
###		$2: {server_addr}
######################################################################
Sauthinfo
R$*		$: $1 $| $>D <$&{server_name}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| <$(access AuthInfo: $: ? $)> <>
R$* $| <?>$*	$@ no				no authinfo available
R$* $| <$*> <>	$# $2





#
######################################################################
######################################################################
#####
#####			MAIL FILTER DEFINITIONS
#####
######################################################################
######################################################################

#
######################################################################
######################################################################
#####
#####			sendmail.cf:1666: m4: cannot open `/usr/share/sendmail-cf/mailer/.m4': No such file or directory
 DEFINITIONS
#####
######################################################################
######################################################################

#####################################
###   SMTP Mailer specification   ###
#####################################

#####  $Id: smtp.m4,v 8.64 2001/04/03 01:52:54 gshapiro Exp $  #####

#
#  common sender and masquerading recipient rewriting
#
SMasqSMTP
R$* < @ $* > $*		$@ $1 < @ $2 > $3		already fully qualified
R$+			$@ $1 < @ *LOCAL* >		add local qualification

#
#  convert pseudo-domain addresses to real domain addresses
#
SPseudoToReal

# pass <route-addr>s through
R< @ $+ > $*		$@ < @ $1 > $2			resolve <route-addr>

# output fake domains as user%fake@relay

# do UUCP heuristics; note that these are shared with UUCP mailers
R$+ < @ $+ .UUCP. >	$: < $2 ! > $1			convert to UUCP form
R$+ < @ $* > $*		$@ $1 < @ $2 > $3		not UUCP form

# leave these in .UUCP form to avoid further tampering
R< $&h ! > $- ! $+	$@ $2 < @ $1 .UUCP. >
R< $&h ! > $-.$+ ! $+	$@ $3 < @ $1.$2 >
R< $&h ! > $+		$@ $1 < @ $&h .UUCP. >
R< $+ ! > $+		$: $1 ! $2 < @ $Y >		use UUCP_RELAY
R$+ < @ $~[ $* : $+ >	$@ $1 < @ $4 >			strip mailer: part
R$+ < @ >		$: $1 < @ *LOCAL* >		if no UUCP_RELAY


#
#  envelope sender rewriting
#
SEnvFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$* :; <@>		$@				list:; special case
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqEnv $1			do masquerading


#
#  envelope recipient rewriting --
#  also header recipient if not masquerading recipients
#
SEnvToSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$+			$: $>MasqSMTP $1		qualify unqual'ed names
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  header sender and masquerading header recipient rewriting
#
SHdrFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R:; <@>			$@				list:; special case

# do special header rewriting
R$* <@> $*		$@ $1 <@> $2			pass null host through
R< @ $* > $*		$@ < @ $1 > $2			pass route-addr through
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqHdr $1			do masquerading


#
#  relay mailer header masquerading recipient rewriting
#
SMasqRelay
R$+			$: $>MasqSMTP $1
R$+			$: $>MasqHdr $1

Msmtp,		P=[IPC], F=mDFMuX, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mesmtp,		P=[IPC], F=mDFMuXa, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Msmtp8,		P=[IPC], F=mDFMuX8, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mdsmtp,		P=[IPC], F=mDFMuXa%, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mrelay,		P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h


######################*****##############
###   PROCMAIL Mailer specification   ###
##################*****##################

#####  $Id: procmail.m4,v 8.22 2001/11/12 23:11:34 ca Exp $  #####

Mprocmail,	P=/usr/bin/procmail, F=DFMSPhnu9, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP/HdrFromSMTP,
		T=DNS/RFC822/X-Unix,
		A=procmail -Y -m $h $f $u


##################################################
###   Local and Program Mailer specification   ###
##################################################

#####  $Id: local.m4,v 8.59 2004/11/23 00:37:25 ca Exp $  #####

#
#  Envelope sender rewriting
#
SEnvFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqEnv $1		do masquerading

#
#  Envelope recipient rewriting
#
SEnvToL
R$+ < @ $* >		$: $1			strip host part

#
#  Header sender rewriting
#
SHdrFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqHdr $1		do masquerading

#
#  Header recipient rewriting
#
SHdrToL
R$+			$: $>AddDomain $1	add local domain if needed
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  Common code to add local domain name (only if always-add-domain)
#
SAddDomain
R$* < @ $* > $* 	$@ $1 < @ $2 > $3	already fully qualified

R$+			$@ $1 < @ *LOCAL* >	add local qualification

Mlocal,		P=/usr/bin/procmail, F=lsDFMAw5:/|@qSPfhn9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL,
		T=DNS/RFC822/X-Unix,
		A=procmail -t -Y -a $h -d $u
Mprog,		P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL, D=$z:/,
		T=X-Unix/X-Unix/X-Unix,
		A=smrsh -c $u



#####  $Id: proto.m4,v 8.719 2006/03/30 20:50:13 ca Exp $  #####

# level 10 config file format
V10/Berkeley

# override file safeties - setting this option compromises system security,
# addressing the actual file configuration problem is preferred
# need to set this before any file actions are encountered in the cf file
#O DontBlameSendmail=safe

# default LDAP map specification
# need to set this now before any LDAP maps are defined
#O LDAPDefaultSpec=-h localhost

##################
#   local info   #
##################

# my LDAP cluster
# need to set this before any LDAP lookups are done (including classes)
#D{sendmailMTACluster}$m

Cwlocalhost
# file containing names of hosts for which we receive email
Fw/etc/mail/local-host-names

# my official domain name
# ... define this only if sendmail cannot automatically determine your domain
Djaltnix.com

# host/domain names ending with a token in class P are canonical
CP.

# "Smart" relay host (may be null)
DS


# operators that cannot be in local usernames (i.e., network indicators)
CO @ % !

# a class with just dot (for identifying canonical names)
C..

# a class with just a left bracket (for identifying domain literals)
C[[

# access_db acceptance class
C{Accept}OK RELAY


C{ResOk}OKR


# Hosts for which relaying is permitted ($=R)
FR-o /etc/mail/relay-domains

# arithmetic map
Karith arith
# macro storage map
Kmacro macro
# possible values for TLS_connection in access map
C{Tls}VERIFY ENCR





# dequoting map
Kdequote dequote

# class E: names that should be exposed as from this host, even if we masquerade
# class L: names that should be delivered locally, even if we have a relay
# class M: domains that should be converted to $M
# class N: domains that should not be converted to $M
#CL root
C{E}root
C{w}localhost.localdomain



# my name for error messages
DnMAILER-DAEMON


# Mailer table (overriding domains)
Kmailertable hash -o /etc/mail/mailertable.db

# Virtual user table (maps incoming users)
Kvirtuser hash -o /etc/mail/virtusertable.db

CPREDIRECT

# Access list database (for spam stomping)
Kaccess hash -T<TMPF> -o /etc/mail/access.db

# Configuration version number
DZ8.13.8


###############
#   Options   #
###############

# strip message body to 7 bits on input?
O SevenBitInput=False

# 8-bit data handling
#O EightBitMode=pass8

# wait for alias file rebuild (default units: minutes)
O AliasWait=10

# location of alias file
O AliasFile=/etc/aliases

# minimum number of free blocks on filesystem
O MinFreeBlocks=100

# maximum message size
#O MaxMessageSize=0

# substitution for space (blank) characters
O BlankSub=.

# avoid connecting to "expensive" mailers on initial submission?
O HoldExpensive=False

# checkpoint queue runs after every N successful deliveries
#O CheckpointInterval=10

# default delivery mode
O DeliveryMode=background

# error message header/file
#O ErrorHeader=/etc/mail/error-header

# error mode
#O ErrorMode=print

# save Unix-style "From_" lines at top of header?
#O SaveFromLine=False

# queue file mode (qf files)
#O QueueFileMode=0600

# temporary file mode
O TempFileMode=0600

# match recipients against GECOS field?
#O MatchGECOS=False

# maximum hop count
#O MaxHopCount=25

# location of help file
O HelpFile=/etc/mail/helpfile

# ignore dots as terminators in incoming messages?
#O IgnoreDots=False

# name resolver options
#O ResolverOptions=+AAONLY

# deliver MIME-encapsulated error messages?
O SendMimeErrors=True

# Forward file search path
O ForwardPath=$z/.forward.$w:$z/.forward

# open connection cache size
O ConnectionCacheSize=2

# open connection cache timeout
O ConnectionCacheTimeout=5m

# persistent host status directory
#O HostStatusDirectory=.hoststat

# single thread deliveries (requires HostStatusDirectory)?
#O SingleThreadDelivery=False

# use Errors-To: header?
O UseErrorsTo=False

# log level
O LogLevel=9

# send to me too, even in an alias expansion?
#O MeToo=True

# verify RHS in newaliases?
O CheckAliases=False

# default messages to old style headers if no special punctuation?
O OldStyleHeaders=True

# SMTP daemon options
O DaemonPortOptions=Name=MTA

# SMTP client options
#O ClientPortOptions=Family=inet, Address=0.0.0.0

# Modifiers to define {daemon_flags} for direct submissions
#O DirectSubmissionModifiers

# Use as mail submission program? See sendmail/SECURITY
#O UseMSP

# privacy flags
O PrivacyOptions=authwarnings,novrfy,noexpn,restrictqrun

# who (if anyone) should get extra copies of error messages
#O PostmasterCopy=Postmaster

# slope of queue-only function
#O QueueFactor=600000

# limit on number of concurrent queue runners
#O MaxQueueChildren

# maximum number of queue-runners per queue-grouping with multiple queues
#O MaxRunnersPerQueue=1

# priority of queue runners (nice(3))
#O NiceQueueRun

# shall we sort the queue by hostname first?
#O QueueSortOrder=priority

# minimum time in queue before retry
#O MinQueueAge=30m

# how many jobs can you process in the queue?
#O MaxQueueRunSize=0

# perform initial split of envelope without checking MX records
#O FastSplit=1

# queue directory
O QueueDirectory=/var/spool/mqueue

# key for shared memory; 0 to turn off
#O SharedMemoryKey=0



# timeouts (many of these)
#O Timeout.initial=5m
O Timeout.connect=1m
#O Timeout.aconnect=0s
#O Timeout.iconnect=5m
#O Timeout.helo=5m
#O Timeout.mail=10m
#O Timeout.rcpt=1h
#O Timeout.datainit=5m
#O Timeout.datablock=1h
#O Timeout.datafinal=1h
#O Timeout.rset=5m
#O Timeout.quit=2m
#O Timeout.misc=2m
#O Timeout.command=1h
O Timeout.ident=0
#O Timeout.fileopen=60s
#O Timeout.control=2m
O Timeout.queuereturn=5d
#O Timeout.queuereturn.normal=5d
#O Timeout.queuereturn.urgent=2d
#O Timeout.queuereturn.non-urgent=7d
#O Timeout.queuereturn.dsn=5d
O Timeout.queuewarn=4h
#O Timeout.queuewarn.normal=4h
#O Timeout.queuewarn.urgent=1h
#O Timeout.queuewarn.non-urgent=12h
#O Timeout.queuewarn.dsn=4h
#O Timeout.hoststatus=30m
#O Timeout.resolver.retrans=5s
#O Timeout.resolver.retrans.first=5s
#O Timeout.resolver.retrans.normal=5s
#O Timeout.resolver.retry=4
#O Timeout.resolver.retry.first=4
#O Timeout.resolver.retry.normal=4
#O Timeout.lhlo=2m
#O Timeout.auth=10m
#O Timeout.starttls=1h

# time for DeliverBy; extension disabled if less than 0
#O DeliverByMin=0

# should we not prune routes in route-addr syntax addresses?
#O DontPruneRoutes=False

# queue up everything before forking?
O SuperSafe=True

# status file
O StatusFile=/var/log/mail/statistics

# time zone handling:
#  if undefined, use system default
#  if defined but null, use TZ envariable passed in
#  if defined and non-null, use that info
#O TimeZoneSpec=

# default UID (can be username or userid:groupid)
O DefaultUser=8:12

# list of locations of user database file (null means no lookup)
O UserDatabaseSpec=/etc/mail/userdb.db

# fallback MX host
#O FallbackMXhost=fall.back.host.net

# fallback smart host
#O FallbackSmartHost=fall.back.host.net

# if we are the best MX host for a site, try it directly instead of config err
O TryNullMXList=True

# load average at which we just queue messages
#O QueueLA=8

# load average at which we refuse connections
#O RefuseLA=12

# log interval when refusing connections for this long
#O RejectLogInterval=3h

# load average at which we delay connections; 0 means no limit
#O DelayLA=0

# maximum number of children we allow at one time
#O MaxDaemonChildren=0

# maximum number of new connections per second
#O ConnectionRateThrottle=0

# Width of the window 
#O ConnectionRateWindowSize=60s

# work recipient factor
#O RecipientFactor=30000

# deliver each queued job in a separate process?
#O ForkEachJob=False

# work class factor
#O ClassFactor=1800

# work time factor
#O RetryFactor=90000

# default character set
#O DefaultCharSet=unknown-8bit

# service switch file (name hardwired on Solaris, Ultrix, OSF/1, others)
#O ServiceSwitchFile=/etc/mail/service.switch

# hosts file (normally /etc/hosts)
#O HostsFile=/etc/hosts

# dialup line delay on connection failure
#O DialDelay=0s

# action to take if there are no recipients in the message
#O NoRecipientAction=none

# chrooted environment for writing to files
#O SafeFileEnvironment

# are colons OK in addresses?
#O ColonOkInAddr=True

# shall I avoid expanding CNAMEs (violates protocols)?
#O DontExpandCnames=False

# SMTP initial login message (old $e macro)
O SmtpGreetingMessage=$j Sendmail $v/$Z; $b

# UNIX initial From header format (old $l macro)
O UnixFromLine=From $g $d

# From: lines that have embedded newlines are unwrapped onto one line
#O SingleLineFromHeader=False

# Allow HELO SMTP command that does not include a host name
#O AllowBogusHELO=False

# Characters to be quoted in a full name phrase (@,;:\()[] are automatic)
#O MustQuoteChars=.

# delimiter (operator) characters (old $o macro)
O OperatorChars=.:%@!^/[]+

# shall I avoid calling initgroups(3) because of high NIS costs?
#O DontInitGroups=False

# are group-writable :include: and .forward files (un)trustworthy?
# True (the default) means they are not trustworthy.
#O UnsafeGroupWrites=True


# where do errors that occur when sending errors get sent?
#O DoubleBounceAddress=postmaster

# where to save bounces if all else fails
#O DeadLetterDrop=/var/tmp/dead.letter

# what user id do we assume for the majority of the processing?
#O RunAsUser=sendmail

# maximum number of recipients per SMTP envelope
#O MaxRecipientsPerMessage=0

# limit the rate recipients per SMTP envelope are accepted
# once the threshold number of recipients have been rejected
#O BadRcptThrottle=0

# shall we get local names from our installed interfaces?
O DontProbeInterfaces=True

# Return-Receipt-To: header implies DSN request
#O RrtImpliesDsn=False

# override connection address (for testing)
#O ConnectOnlyTo=0.0.0.0

# Trusted user for file ownership and starting the daemon
#O TrustedUser=root

# Control socket for daemon management
#O ControlSocketName=/var/spool/mqueue/.control

# Maximum MIME header length to protect MUAs
#O MaxMimeHeaderLength=0/0

# Maximum length of the sum of all headers
#O MaxHeadersLength=32768

# Maximum depth of alias recursion
#O MaxAliasRecursion=10

# location of pid file
#O PidFile=/var/run/sendmail.pid

# Prefix string for the process title shown on 'ps' listings
#O ProcessTitlePrefix=prefix

# Data file (df) memory-buffer file maximum size
#O DataFileBufferSize=4096

# Transcript file (xf) memory-buffer file maximum size
#O XscriptFileBufferSize=4096

# lookup type to find information about local mailboxes
#O MailboxDatabase=pw

# override compile time flag REQUIRES_DIR_FSYNC
#O RequiresDirfsync=true

# list of authentication mechanisms
#O AuthMechanisms=EXTERNAL GSSAPI KERBEROS_V4 DIGEST-MD5 CRAM-MD5

# Authentication realm
#O AuthRealm

# default authentication information for outgoing connections
#O DefaultAuthInfo=/etc/mail/default-auth-info

# SMTP AUTH flags
O AuthOptions=A

# SMTP AUTH maximum encryption strength
#O AuthMaxBits

# SMTP STARTTLS server options
#O TLSSrvOptions

# Input mail filters
#O InputMailFilters


# CA directory
#O CACertPath
# CA file
#O CACertFile
# Server Cert
#O ServerCertFile
# Server private key
#O ServerKeyFile
# Client Cert
#O ClientCertFile
# Client private key
#O ClientKeyFile
# File containing certificate revocation lists 
#O CRLFile
# DHParameters (only required if DSA/DH is used)
#O DHParameters
# Random data source (required for systems without /dev/urandom under OpenSSL)
#O RandFile

############################
# QUEUE GROUP DEFINITIONS  #
############################


###########################
#   Message precedences   #
###########################

Pfirst-class=0
Pspecial-delivery=100
Plist=-30
Pbulk=-60
Pjunk=-100

#####################
#   Trusted users   #
#####################

# this is equivalent to setting class "t"
Ft/etc/mail/trusted-users
Troot
Tdaemon
Tuucp

#########################
#   Format of headers   #
#########################

H?P?Return-Path: <$g>
HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
	$.$?{auth_type}(authenticated$?{auth_ssf} bits=${auth_ssf}$.)
	$.by $j ($v/$Z)$?r with $r$. id $i$?{tls_version}
	(version=${tls_version} cipher=${cipher} bits=${cipher_bits} verify=${verify})$.$?u
	for $u; $|;
	$.$b
H?D?Resent-Date: $a
H?D?Date: $a
H?F?Resent-From: $?x$x <$g>$|$g$.
H?F?From: $?x$x <$g>$|$g$.
H?x?Full-Name: $x
# HPosted-Date: $a
# H?l?Received-Date: $b
H?M?Resent-Message-Id: <$t.$i@$j>
H?M?Message-Id: <$t.$i@$j>

#
######################################################################
######################################################################
#####
#####			REWRITING RULES
#####
######################################################################
######################################################################

############################################
###  Ruleset 3 -- Name Canonicalization  ###
############################################
Scanonify=3

# handle null input (translate to <@> special case)
R$@			$@ <@>

# strip group: syntax (not inside angle brackets!) and trailing semicolon
R$*			$: $1 <@>			mark addresses
R$* < $* > $* <@>	$: $1 < $2 > $3			unmark <addr>
R@ $* <@>		$: @ $1				unmark @host:...
R$* [ IPv6 : $+ ] <@>	$: $1 [ IPv6 : $2 ]		unmark IPv6 addr
R$* :: $* <@>		$: $1 :: $2			unmark node::addr
R:include: $* <@>	$: :include: $1			unmark :include:...
R$* : $* [ $* ]		$: $1 : $2 [ $3 ] <@>		remark if leading colon
R$* : $* <@>		$: $2				strip colon if marked
R$* <@>			$: $1				unmark
R$* ;			   $1				strip trailing semi
R$* < $+ :; > $*	$@ $2 :; <@>			catch <list:;>
R$* < $* ; >		   $1 < $2 >			bogus bracketed semi

# null input now results from list:; syntax
R$@			$@ :; <@>

# strip angle brackets -- note RFC733 heuristic to get innermost item
R$*			$: < $1 >			housekeeping <>
R$+ < $* >		   < $2 >			strip excess on left
R< $* > $+		   < $1 >			strip excess on right
R<>			$@ < @ >			MAIL FROM:<> case
R< $+ >			$: $1				remove housekeeping <>

# strip route address <@a,@b,@c:user@d> -> <user@d>
R@ $+ , $+		$2
R@ [ $* ] : $+		$2
R@ $+ : $+		$2

# find focus for list syntax
R $+ : $* ; @ $+	$@ $>Canonify2 $1 : $2 ; < @ $3 >	list syntax
R $+ : $* ;		$@ $1 : $2;			list syntax

# find focus for @ syntax addresses
R$+ @ $+		$: $1 < @ $2 >			focus on domain
R$+ < $+ @ $+ >		$1 $2 < @ $3 >			move gaze right
R$+ < @ $+ >		$@ $>Canonify2 $1 < @ $2 >	already canonical


# convert old-style addresses to a domain-based address
R$- ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	resolve uucp names
R$+ . $- ! $+		$@ $>Canonify2 $3 < @ $1 . $2 >		domain uucps
R$+ ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	uucp subdomains

# if we have % signs, take the rightmost one
R$* % $*		$1 @ $2				First make them all @s.
R$* @ $* @ $*		$1 % $2 @ $3			Undo all but the last.
R$* @ $*		$@ $>Canonify2 $1 < @ $2 >	Insert < > and finish

# else we must be a local name
R$*			$@ $>Canonify2 $1


################################################
###  Ruleset 96 -- bottom half of ruleset 3  ###
################################################

SCanonify2=96

# handle special cases for local names
R$* < @ localhost > $*		$: $1 < @ $j . > $2		no domain at all
R$* < @ localhost . $m > $*	$: $1 < @ $j . > $2		local domain
R$* < @ localhost . UUCP > $*	$: $1 < @ $j . > $2		.UUCP domain

# check for IPv4/IPv6 domain literal
R$* < @ [ $+ ] > $*		$: $1 < @@ [ $2 ] > $3		mark [addr]
R$* < @@ $=w > $*		$: $1 < @ $j . > $3		self-literal
R$* < @@ $+ > $*		$@ $1 < @ $2 > $3		canon IP addr





# if really UUCP, handle it immediately

# try UUCP traffic as a local address
R$* < @ $+ . UUCP > $*		$: $1 < @ $[ $2 $] . UUCP . > $3
R$* < @ $+ . . UUCP . > $*	$@ $1 < @ $2 . > $3

# hostnames ending in class P are always canonical
R$* < @ $* $=P > $*		$: $1 < @ $2 $3 . > $4
R$* < @ $* $~P > $*		$: $&{daemon_flags} $| $1 < @ $2 $3 > $4
R$* CC $* $| $* < @ $+.$+ > $*	$: $3 < @ $4.$5 . > $6
R$* CC $* $| $*			$: $3
# pass to name server to make hostname canonical
R$* $| $* < @ $* > $*		$: $2 < @ $[ $3 $] > $4
R$* $| $*			$: $2

# local host aliases and pseudo-domains are always canonical
R$* < @ $=w > $*		$: $1 < @ $2 . > $3
R$* < @ $=M > $*		$: $1 < @ $2 . > $3
R$* < @ $={VirtHost} > $* 	$: $1 < @ $2 . > $3
R$* < @ $* . . > $*		$1 < @ $2 . > $3


##################################################
###  Ruleset 4 -- Final Output Post-rewriting  ###
##################################################
Sfinal=4

R$+ :; <@>		$@ $1 :				handle <list:;>
R$* <@>			$@				handle <> and list:;

# strip trailing dot off possibly canonical name
R$* < @ $+ . > $*	$1 < @ $2 > $3

# eliminate internal code
R$* < @ *LOCAL* > $*	$1 < @ $j > $2

# externalize local domain info
R$* < $+ > $*		$1 $2 $3			defocus
R@ $+ : @ $+ : $+	@ $1 , @ $2 : $3		<route-addr> canonical
R@ $*			$@ @ $1				... and exit

# UUCP must always be presented in old form
R$+ @ $- . UUCP		$2!$1				u@h.UUCP => h!u

# delete duplicate local names
R$+ % $=w @ $=w		$1 @ $2				u%host@host => u@host



##############################################################
###   Ruleset 97 -- recanonicalize and call ruleset zero   ###
###		   (used for recursive calls)		   ###
##############################################################

SRecurse=97
R$*			$: $>canonify $1
R$*			$@ $>parse $1


######################################
###   Ruleset 0 -- Parse Address   ###
######################################

Sparse=0

R$*			$: $>Parse0 $1		initial parsing
R<@>			$#local $: <@>		special case error msgs
R$*			$: $>ParseLocal $1	handle local hacks
R$*			$: $>Parse1 $1		final parsing

#
#  Parse0 -- do initial syntax checking and eliminate local addresses.
#	This should either return with the (possibly modified) input
#	or return with a #error mailer.  It should not return with a
#	#mailer other than the #error mailer.
#

SParse0
R<@>			$@ <@>			special case error msgs
R$* : $* ; <@>		$#error $@ 5.1.3 $: "553 List:; syntax illegal for recipient addresses"
R@ <@ $* >		< @ $1 >		catch "@@host" bogosity
R<@ $+>			$#error $@ 5.1.3 $: "553 User address required"
R$+ <@>			$#error $@ 5.1.3 $: "553 Hostname required"
R$*			$: <> $1
R<> $* < @ [ $* ] : $+ > $*	$1 < @ [ $2 ] : $3 > $4
R<> $* < @ [ $* ] , $+ > $*	$1 < @ [ $2 ] , $3 > $4
R<> $* < @ [ $* ] $+ > $*	$#error $@ 5.1.2 $: "553 Invalid address"
R<> $* < @ [ $+ ] > $*		$1 < @ [ $2 ] > $3
R<> $* <$* : $* > $*	$#error $@ 5.1.3 $: "553 Colon illegal in host name part"
R<> $*			$1
R$* < @ . $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* .. $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* @ > $*	$#error $@ 5.1.2 $: "553 Invalid route address"
R$* @ $* < @ $* > $*	$#error $@ 5.1.3 $: "553 Invalid route address"
R$* , $~O $*		$#error $@ 5.1.3 $: "553 Invalid route address"


# now delete the local info -- note $=O to find characters that cause forwarding
R$* < @ > $*		$@ $>Parse0 $>canonify $1	user@ => user
R< @ $=w . > : $*	$@ $>Parse0 $>canonify $2	@here:... -> ...
R$- < @ $=w . >		$: $(dequote $1 $) < @ $2 . >	dequote "foo"@here
R< @ $+ >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ $=w . >	$@ $>Parse0 $>canonify $1 $2 $3	...@here -> ...
R$- 			$: $(dequote $1 $) < @ *LOCAL* >	dequote "foo"
R< @ *LOCAL* >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ *LOCAL* >
			$@ $>Parse0 $>canonify $1 $2 $3	...@*LOCAL* -> ...
R$* < @ *LOCAL* >	$: $1

#
#  Parse1 -- the bottom half of ruleset 0.
#

SParse1

# handle numeric address spec
R$* < @ [ $+ ] > $*	$: $>ParseLocal $1 < @ [ $2 ] > $3	numeric internet spec
R$* < @ [ $+ ] > $*	$: $1 < @ [ $2 ] : $S > $3	Add smart host to path
R$* < @ [ $+ ] : > $*		$#esmtp $@ [$2] $: $1 < @ [$2] > $3	no smarthost: send
R$* < @ [ $+ ] : $- : $*> $*	$#$3 $@ $4 $: $1 < @ [$2] > $5	smarthost with mailer
R$* < @ [ $+ ] : $+ > $*	$#esmtp $@ $3 $: $1 < @ [$2] > $4	smarthost without mailer

# handle virtual users
R$+			$: <!> $1		Mark for lookup
R<!> $+ < @ $={VirtHost} . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<!> $+ < @ $=w . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+ + $+ < @ $* . >
			$: < $(virtuser $1 + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $+ < @ $+ . >	$: < $(virtuser + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser @ $3 $@ $1 $@ $2 $@ +$2 $: ! $) > $1 + $2 < @ $3 . >
R<@> $+ < @ $+ . >	$: < $(virtuser @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+			$: $1
R<!> $+			$: $1
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- $+ > $* 	$#error $@ $(dequote $1 $) $: $2
R< $+ > $+ < @ $+ >	$: $>Recurse $1

# short circuit local delivery so forwarded email works


R$=L < @ $=w . >	$#local $: @ $1			special local names
R$+ < @ $=w . >		$#local $: $1			regular local name

# not local -- try mailer table lookup
R$* <@ $+ > $*		$: < $2 > $1 < @ $2 > $3	extract host name
R< $+ . > $*		$: < $1 > $2			strip trailing dot
R< $+ > $*		$: < $(mailertable $1 $) > $2	lookup
R< $~[ : $* > $* 	$>MailerToTriple < $1 : $2 > $3		check -- resolved?
R< $+ > $*		$: $>Mailertable <$1> $2		try domain

# resolve remotely connected UUCP links (if any)

# resolve fake top level domains by forwarding to other hosts



# pass names that still have a host to a smarthost (if defined)
R$* < @ $* > $*		$: $>MailerToTriple < $S > $1 < @ $2 > $3	glue on smarthost name

# deal with other remote names
R$* < @$* > $*		$#esmtp $@ $2 $: $1 < @ $2 > $3	user@host.domain

# handle locally delivered names
R$=L			$#local $: @ $1		special local names
R$+			$#local $: $1			regular local names

###########################################################################
###   Ruleset 5 -- special rewriting after aliases have been expanded   ###
###########################################################################

SLocal_localaddr
Slocaladdr=5
R$+			$: $1 $| $>"Local_localaddr" $1
R$+ $| $#ok		$@ $1			no change
R$+ $| $#$*		$#$2
R$+ $| $*		$: $1




# deal with plussed users so aliases work nicely
R$+ + *			$#local $@ $&h $: $1
R$+ + $*		$#local $@ + $2 $: $1 + *

# prepend an empty "forward host" on the front
R$+			$: <> $1



R< > $+			$: < > < $1 <> $&h >		nope, restore +detail

R< > < $+ <> + $* >	$: < > < $1 + $2 >		check whether +detail
R< > < $+ <> $* >	$: < > < $1 >			else discard
R< > < $+ + $* > $*	   < > < $1 > + $2 $3		find the user part
R< > < $+ > + $*	$#local $@ $2 $: @ $1		strip the extra +
R< > < $+ >		$@ $1				no +detail
R$+			$: $1 <> $&h			add +detail back in

R$+ <> + $*		$: $1 + $2			check whether +detail
R$+ <> $*		$: $1				else discard
R< local : $* > $*	$: $>MailerToTriple < local : $1 > $2	no host extension
R< error : $* > $*	$: $>MailerToTriple < error : $1 > $2	no host extension

R< $~[ : $+ > $+	$: $>MailerToTriple < $1 : $2 > $3 < @ $2 >

R< $+ > $+		$@ $>MailerToTriple < $1 > $2 < @ $1 >


###################################################################
###  Ruleset 90 -- try domain part of mailertable entry 	###
###################################################################

SMailertable=90
R$* <$- . $+ > $*	$: $1$2 < $(mailertable .$3 $@ $1$2 $@ $2 $) > $4
R$* <$~[ : $* > $*	$>MailerToTriple < $2 : $3 > $4		check -- resolved?
R$* < . $+ > $* 	$@ $>Mailertable $1 . <$2> $3		no -- strip & try again
R$* < $* > $*		$: < $(mailertable . $@ $1$2 $) > $3	try "."
R< $~[ : $* > $*	$>MailerToTriple < $1 : $2 > $3		"." found?
R< $* > $*		$@ $2				no mailertable match

###################################################################
###  Ruleset 95 -- canonify mailer:[user@]host syntax to triple	###
###################################################################

SMailerToTriple=95
R< > $*				$@ $1			strip off null relay
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- : $+ > $*		$#error $@ $(dequote $1 $) $: $2
R< error : $+ > $*		$#error $: $1
R< local : $* > $*		$>CanonLocal < $1 > $2
R< $~[ : $+ @ $+ > $*<$*>$*	$# $1 $@ $3 $: $2<@$3>	use literal user
R< $~[ : $+ > $*		$# $1 $@ $2 $: $3	try qualified mailer
R< $=w > $*			$@ $2			delete local host
R< $+ > $*			$#relay $@ $1 $: $2	use unqualified mailer

###################################################################
###  Ruleset CanonLocal -- canonify local: syntax		###
###################################################################

SCanonLocal
# strip local host from routed addresses
R< $* > < @ $+ > : $+		$@ $>Recurse $3
R< $* > $+ $=O $+ < @ $+ >	$@ $>Recurse $2 $3 $4

# strip trailing dot from any host name that may appear
R< $* > $* < @ $* . >		$: < $1 > $2 < @ $3 >

# handle local: syntax -- use old user, either with or without host
R< > $* < @ $* > $*		$#local $@ $1@$2 $: $1
R< > $+				$#local $@ $1    $: $1

# handle local:user@host syntax -- ignore host part
R< $+ @ $+ > $* < @ $* >	$: < $1 > $3 < @ $4 >

# handle local:user syntax
R< $+ > $* <@ $* > $*		$#local $@ $2@$3 $: $1
R< $+ > $* 			$#local $@ $2    $: $1

###################################################################
###  Ruleset 93 -- convert header names to masqueraded form	###
###################################################################

SMasqHdr=93


# do not masquerade anything in class N
R$* < @ $* $=N . >	$@ $1 < @ $2 $3 . >

R$* < @ *LOCAL* >	$@ $1 < @ $j . >

###################################################################
###  Ruleset 94 -- convert envelope names to masqueraded form	###
###################################################################

SMasqEnv=94
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

###################################################################
###  Ruleset 98 -- local part of ruleset zero (can be null)	###
###################################################################

SParseLocal=98

# addresses sent to foo@host.REDIRECT will give a 551 error code
R$* < @ $+ .REDIRECT. >		$: $1 < @ $2 . REDIRECT . > < ${opMode} >
R$* < @ $+ .REDIRECT. > <i>	$: $1 < @ $2 . REDIRECT. >
R$* < @ $+ .REDIRECT. > < $- >	$#error $@ 5.1.1 $: "551 User has moved; please try " <$1@$2>




######################################################################
###  D: LookUpDomain -- search for domain in access database
###
###	Parameters:
###		<$1> -- key (domain name)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SD
R<$*> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <[$+.$-]> <$+> <$- $-> <$*>	$@ $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+::$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+:$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <$+.$+> <$+> <$- $-> <$*>	$@ $>D <$2> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  A: LookUpAddress -- search for host address in access database
###
###	Parameters:
###		<$1> -- key (dot quadded host address)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed through)
######################################################################

SA
R<$+> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <$+::$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+:$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+.$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  CanonAddr --	Convert an address into a standard form for
###			relay checking.  Route address syntax is
###			crudely converted into a %-hack address.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed address, not in source route form
######################################################################

SCanonAddr
R$*			$: $>Parse0 $>canonify $1	make domain canonical


######################################################################
###  ParseRecipient --	Strip off hosts in $=R as well as possibly
###			$* $=m or the access database.
###			Check user portion for host separators.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed, non-local-relaying address
######################################################################

SParseRecipient
R$*				$: <?> $>CanonAddr $1
R<?> $* < @ $* . >		<?> $1 < @ $2 >			strip trailing dots
R<?> $- < @ $* >		$: <?> $(dequote $1 $) < @ $2 >	dequote local part

# if no $=O character, no host in the user portion, we are done
R<?> $* $=O $* < @ $* >		$: <NO> $1 $2 $3 < @ $4>
R<?> $*				$@ $1


R<NO> $* < @ $* $=R >		$: <RELAY> $1 < @ $2 $3 >
R<NO> $* < @ $+ >		$: $>D <$2> <NO> <+ To> <$1 < @ $2 >>
R<$+> <$+>			$: <$1> $2



R<RELAY> $* < @ $* >		$@ $>ParseRecipient $1
R<$+> $*			$@ $2


######################################################################
###  check_relay -- check hostname/address on SMTP startup
######################################################################



SLocal_check_relay
Scheck_relay
R$*			$: $1 $| $>"Local_check_relay" $1
R$* $| $* $| $#$*	$#$3
R$* $| $* $| $*		$@ $>"Basic_check_relay" $1 $| $2

SBasic_check_relay
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

R$+ $| $+		$: $>D < $1 > <?> <+ Connect> < $2 >
R   $| $+		$: $>A < $1 > <?> <+ Connect> <>	empty client_name
R<?> <$+>		$: $>A < $1 > <?> <+ Connect> <>	no: another lookup
R<?> <$*>		$: OK				found nothing
R<$={Accept}> <$*>	$@ $1				return value of lookup
R<REJECT> <$*>		$#error $@ 5.7.1 $: "550 Access denied"
R<DISCARD> <$*>		$#discard $: discard
R<QUARANTINE:$+> <$*>	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> <$*>	$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> <$*>		$#error $: $1
R<$* <TMPF>> <$*>		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> <$*>		$#error $: $1



######################################################################
###  check_mail -- check SMTP `MAIL FROM:' command argument
######################################################################

SLocal_check_mail
Scheck_mail
R$*			$: $1 $| $>"Local_check_mail" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_mail" $1

SBasic_check_mail
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

# authenticated?
R$*			$: $1 $| $>"tls_client" $&{verify} $| MAIL
R$* $| $#$+		$#$2
R$* $| $*		$: $1

R<>			$@ <OK>			we MUST accept <> (RFC 1123)
R$+			$: <?> $1
R<?><$+>		$: <@> <$1>
R<?>$+			$: <@> <$1>
R$*			$: $&{daemon_flags} $| $1
R$* f $* $| <@> < $* @ $- >	$: < ? $&{client_name} > < $3 @ $4 >
R$* u $* $| <@> < $* >	$: <?> < $3 >
R$* $| $*		$: $2
# handle case of @localhost on address
R<@> < $* @ localhost >	$: < ? $&{client_name} > < $1 @ localhost >
R<@> < $* @ [127.0.0.1] >
			$: < ? $&{client_name} > < $1 @ [127.0.0.1] >
R<@> < $* @ localhost.$m >
			$: < ? $&{client_name} > < $1 @ localhost.$m >
R<@> < $* @ localhost.localdomain >
			$: < ? $&{client_name} > < $1 @ localhost.localdomain >
R<@> < $* @ localhost.UUCP >
			$: < ? $&{client_name} > < $1 @ localhost.UUCP >
R<@> $*			$: $1			no localhost as domain
R<? $=w> $*		$: $2			local client: ok
R<? $+> <$+>		$#error $@ 5.5.4 $: "553 Real domain name required for sender address"
R<?> $*			$: $1
R$*			$: <?> $>CanonAddr $1		canonify sender address and mark it
R<?> $* < @ $+ . >	<?> $1 < @ $2 >			strip trailing dots
# handle non-DNS hostnames (*.bitnet, *.decnet, *.uucp, etc)
R<?> $* < @ $* $=P >	$: <OKR> $1 < @ $2 $3 >
R<?> $* < @ $j >	$: <OKR> $1 < @ $j >
R<?> $* < @ $+ >	$: <OKR> $1 < @ $2 >		... unresolvable OK

# check sender address: user@address, user@, address
R<$+> $+ < @ $* >	$: @<$1> <$2 < @ $3 >> $| <F:$2@$3> <U:$2@> <D:$3>
R<$+> $+		$: @<$1> <$2> $| <U:$2@>
R@ <$+> <$*> $| <$+>	$: <@> <$1> <$2> $| $>SearchList <+ From> $| <$3> <>
R<@> <$+> <$*> $| <$*>	$: <$3> <$1> <$2>		reverse result
# retransform for further use
R<?> <$+> <$*>		$: <$1> $2	no match
R<$+> <$+> <$*>		$: <$1> $3	relevant result, keep it

# handle case of no @domain on address
R<?> $*			$: $&{daemon_flags} $| <?> $1
R$* u $* $| <?> $*	$: <OKR> $3
R$* $| $*		$: $2
R<?> $*			$: < ? $&{client_addr} > $1
R<?> $*			$@ <OKR>			...local unqualed ok
R<? $+> $*		$#error $@ 5.5.4 $: "553 Domain name required for sender address " $&f
							...remote is not
# check results
R<?> $*			$: @ $1		mark address: nothing known about it
R<$={ResOk}> $*		$@ <OKR>	domain ok: stop
R<TEMP> $*		$#error $@ 4.1.8 $: "451 Domain of sender address " $&f " does not resolve"
R<PERM> $*		$#error $@ 5.1.8 $: "553 Domain of sender address " $&f " does not exist"
R<$={Accept}> $*	$# $1		accept from access map
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<REJECT> $*		$#error $@ 5.7.1 $: "550 Access denied"
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db

######################################################################
###  check_rcpt -- check SMTP `RCPT TO:' command argument
######################################################################

SLocal_check_rcpt
Scheck_rcpt
R$*			$: $1 $| $>"Local_check_rcpt" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_rcpt" $1

SBasic_check_rcpt
# empty address?
R<>			$#error $@ nouser $: "553 User address required"
R$@			$#error $@ nouser $: "553 User address required"
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2


######################################################################
R$*			$: $1 $| @ $>"Rcpt_ok" $1
R$* $| @ $#TEMP $+	$: $1 $| T $2
R$* $| @ $#$*		$#$2
R$* $| @ RELAY		$@ RELAY
R$* $| @ $*		$: O $| $>"Relay_ok" $1
R$* $| T $+		$: T $2 $| $>"Relay_ok" $1
R$* $| $#TEMP $+	$#error $2
R$* $| $#$*		$#$2
R$* $| RELAY		$@ RELAY
R T $+ $| $*		$#error $1
# anything else is bogus
R$*			$#error $@ 5.7.1 $: "550 Relaying denied"


######################################################################
### Rcpt_ok: is the recipient ok?
######################################################################
SRcpt_ok
R$*			$: $>ParseRecipient $1		strip relayable hosts



# blacklist local users or any host from receiving mail
R$*			$: <?> $1
R<?> $+ < @ $=w >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <U:$1@> <D:$2>
R<?> $+ < @ $* >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <D:$2>
R<?> $+			$: <> <$1> $| <U:$1@>
R<> <$*> $| <$+>	$: <@> <$1> $| $>SearchList <+ To> $| <$2> <>
R<@> <$*> $| <$*>	$: <$2> <$1>		reverse result
R<?> <$*>		$: @ $1		mark address as no match
R<$={Accept}> <$*>	$: @ $2		mark address as no match

R<REJECT> $*		$#error $@ 5.2.1 $: "550 Mailbox disabled for this recipient"
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db
R@ $*			$1		remove mark

# authenticated via TLS?
R$*			$: $1 $| $>RelayTLS	client authenticated?
R$* $| $# $+		$# $2			error/ok?
R$* $| $*		$: $1			no

R$*			$: $1 $| $>"Local_Relay_Auth" $&{auth_type}
R$* $| $# $*		$# $2
R$* $| NO		$: $1
R$* $| $*		$: $1 $| $&{auth_type}
R$* $|			$: $1
R$* $| $={TrustAuthMech}	$# RELAY
R$* $| $*		$: $1
# anything terminating locally is ok
R$+ < @ $=w >		$@ RELAY
R$+ < @ $* $=R >	$@ RELAY
R$+ < @ $+ >		$: $>D <$2> <?> <+ To> <$1 < @ $2 >>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2



# check for local user (i.e. unqualified address)
R$*			$: <?> $1
R<?> $* < @ $+ >	$: <REMOTE> $1 < @ $2 >
# local user is ok
R<?> $+			$@ RELAY
R<$+> $*		$: $2

######################################################################
### Relay_ok: is the relay/sender ok?
######################################################################
SRelay_ok
# anything originating locally is ok
# check IP address
R$*			$: $&{client_addr}
R$@			$@ RELAY		originated locally
R0			$@ RELAY		originated locally
R127.0.0.1		$@ RELAY		originated locally
RIPv6:::1		$@ RELAY		originated locally
R$=R $*			$@ RELAY		relayable IP address
R$*			$: $>A <$1> <?> <+ Connect> <$1>
R<RELAY> $* 		$@ RELAY		relayable IP address

R<<TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2
R$*			$: [ $1 ]		put brackets around it...
R$=w			$@ RELAY		... and see if it is local


# check client name: first: did it resolve?
R$*			$: < $&{client_resolve} >
R<TEMP>			$#TEMP $@ 4.4.0 $: "450 Relaying temporarily denied. Cannot resolve PTR record for " $&{client_addr}
R<FORGED>		$#error $@ 5.7.1 $: "550 Relaying denied. IP name possibly forged " $&{client_name}
R<FAIL>			$#error $@ 5.7.1 $: "550 Relaying denied. IP name lookup failed " $&{client_name}
R$*			$: <@> $&{client_name}
# pass to name server to make hostname canonical
R<@> $* $=P 		$:<?>  $1 $2
R<@> $+			$:<?>  $[ $1 $]
R$* .			$1			strip trailing dots
R<?> $=w		$@ RELAY
R<?> $* $=R			$@ RELAY
R<?> $*			$: $>D <$1> <?> <+ Connect> <$1>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2


######################################################################
###  F: LookUpFull -- search for an entry in access database
###
###	lookup of full key (which should be an address) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SF
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1+*@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1+*@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  E: LookUpExact -- search for an entry in access database
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SE
R<$*> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  U: LookUpUser -- search for an entry in access database
###
###	lookup of key (which should be a local part) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key (user@)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SU
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1+*@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1+*@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  SearchList: search a list of items in the access map
###	Parameters:
###		<exact tag> $| <mark:address> <mark:address> ... <>
###	where "exact" is either "+" or "!":
###	<+ TAG>	lookup with and w/o tag
###	<! TAG>	lookup with tag
###	possible values for "mark" are:
###		D: recursive host lookup (LookUpDomain)
###		E: exact lookup, no modifications
###		F: full lookup, try user+ext@domain and user@domain
###		U: user lookup, try user+ext and user (input must have trailing @)
###	return: <RHS of lookup> or <?> (not found)
######################################################################

# class with valid marks for SearchList
C{Src}E F D U 
SSearchList
# just call the ruleset with the name of the tag... nice trick...
R<$+> $| <$={Src}:$*> <$*>	$: <$1> $| <$4> $| $>$2 <$3> <?> <$1> <>
R<$+> $| <> $| <?> <>		$@ <?>
R<$+> $| <$+> $| <?> <>		$@ $>SearchList <$1> $| <$2>
R<$+> $| <$*> $| <$+> <>	$@ <$3>
R<$+> $| <$+>			$@ <$2>


######################################################################
###  trust_auth: is user trusted to authenticate as someone else?
###
###	Parameters:
###		$1: AUTH= parameter from MAIL command
######################################################################

SLocal_trust_auth
Strust_auth
R$*			$: $&{auth_type} $| $1
# required by RFC 2554 section 4.
R$@ $| $*		$#error $@ 5.7.1 $: "550 not authenticated"
R$* $| $&{auth_authen}		$@ identical
R$* $| <$&{auth_authen}>	$@ identical
R$* $| $*		$: $1 $| $>"Local_trust_auth" $2
R$* $| $#$*		$#$2
R$*			$#error $@ 5.7.1 $: "550 " $&{auth_authen} " not allowed to act as " $&{auth_author}

######################################################################
###  Relay_Auth: allow relaying based on authentication?
###
###	Parameters:
###		$1: ${auth_type}
######################################################################
SLocal_Relay_Auth

######################################################################
###  srv_features: which features to offer to a client?
###	(done in server)
######################################################################
Ssrv_features
R$*		$: $>D <$&{client_name}> <?> <! "Srv_Features"> <>
R<?>$*		$: $>A <$&{client_addr}> <?> <! "Srv_Features"> <>
R<?>$*		$: <$(access "Srv_Features": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#temp
R<$+>$*		$# $1

######################################################################
###  try_tls: try to use STARTTLS?
###	(done in client)
######################################################################
Stry_tls
R$*		$: $>D <$&{server_name}> <?> <! "Try_TLS"> <>
R<?>$*		$: $>A <$&{server_addr}> <?> <! "Try_TLS"> <>
R<?>$*		$: <$(access "Try_TLS": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<NO>$*		$#error $@ 5.7.1 $: "550 do not try TLS with " $&{server_name} " ["$&{server_addr}"]"

######################################################################
###  tls_rcpt: is connection with server "good" enough?
###	(done in client, per recipient)
###
###	Parameters:
###		$1: recipient
######################################################################
Stls_rcpt
R$*			$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$+			$: <?> $>CanonAddr $1
R<?> $+ < @ $+ . >	<?> $1 <@ $2 >
R<?> $+ < @ $+ >	$: $1 <@ $2 > $| <F:$1@$2> <U:$1@> <D:$2> <E:>
R<?> $+			$: $1 $| <U:$1@> <E:>
R$* $| $+	$: $1 $| $>SearchList <! "TLS_Rcpt"> $| $2 <>
R$* $| <?>	$@ OK
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$* $| <$+>	$@ $>"TLS_connection" $&{verify} $| <$2>

######################################################################
###  tls_client: is connection with client "good" enough?
###	(done in server)
###
###	Parameters:
###		${verify} $| (MAIL|STARTTLS)
######################################################################
Stls_client
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$* $| $*	$: $1 $| $>D <$&{client_name}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{client_addr}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Clt": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  tls_server: is connection with server "good" enough?
###	(done in client)
###
###	Parameter:
###		${verify}
######################################################################
Stls_server
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$*		$: $1 $| $>D <$&{server_name}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Srv": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  TLS_connection: is TLS connection "good" enough?
###
###	Parameters:
###		${verify} $| <Requirement> [<>]
###		Requirement: RHS from access map, may be ? for none.
######################################################################
STLS_connection
R$* $| <$*>$*			$: $1 $| <$2>
# create the appropriate error codes
R$* $| <PERM + $={Tls} $*>	$: $1 $| <503:5.7.0> <$2 $3>
R$* $| <TEMP + $={Tls} $*>	$: $1 $| <403:4.7.0> <$2 $3>
R$* $| <$={Tls} $*>		$: $1 $| <403:4.7.0> <$2 $3>
# deal with TLS handshake failures: abort
RSOFTWARE $| <$-:$+> $* 	$#error $@ $2 $: $1 " TLS handshake failed."
RSOFTWARE $| $* 		$#error $@ 4.7.0 $: "403 TLS handshake failed."
# deal with TLS protocol errors: abort
RPROTOCOL $| <$-:$+> $* 	$#error $@ $2 $: $1 " STARTTLS failed."
RPROTOCOL $| $* 		$#error $@ 4.7.0 $: "403 STARTTLS failed."
R$* $| <$*> <VERIFY>		$: <$2> <VERIFY> <> $1
R$* $| <$*> <VERIFY + $+>	$: <$2> <VERIFY> <$3> $1
R$* $| <$*> <$={Tls}:$->$*	$: <$2> <$3:$4> <> $1
R$* $| <$*> <$={Tls}:$- + $+>$*	$: <$2> <$3:$4> <$5> $1
R$* $| $*			$@ OK
# authentication required: give appropriate error
# other side did authenticate (via STARTTLS)
R<$*><VERIFY> <> OK		$@ OK
R<$*><VERIFY> <$+> OK		$: <$1> <REQ:0> <$2>
R<$*><VERIFY:$-> <$*> OK	$: <$1> <REQ:$2> <$3>
R<$*><ENCR:$-> <$*> $*		$: <$1> <REQ:$2> <$3>
R<$-:$+><VERIFY $*> <$*>	$#error $@ $2 $: $1 " authentication required"
R<$-:$+><VERIFY $*> <$*> FAIL	$#error $@ $2 $: $1 " authentication failed"
R<$-:$+><VERIFY $*> <$*> NO	$#error $@ $2 $: $1 " not authenticated"
R<$-:$+><VERIFY $*> <$*> NOT	$#error $@ $2 $: $1 " no authentication requested"
R<$-:$+><VERIFY $*> <$*> NONE	$#error $@ $2 $: $1 " other side does not support STARTTLS"
R<$-:$+><VERIFY $*> <$*> $+	$#error $@ $2 $: $1 " authentication failure " $4
R<$*><REQ:$-> <$*>		$: <$1> <REQ:$2> <$3> $>max $&{cipher_bits} : $&{auth_ssf}
R<$*><REQ:$-> <$*> $-		$: <$1> <$2:$4> <$3> $(arith l $@ $4 $@ $2 $)
R<$-:$+><$-:$-> <$*> TRUE	$#error $@ $2 $: $1 " encryption too weak " $4 " less than " $3
R<$-:$+><$-:$-> <$*> $*		$: <$1:$2 ++ $5>
R<$-:$+ ++ >			$@ OK
R<$-:$+ ++ $+ >			$: <$1:$2> <$3>
R<$-:$+> < $+ ++ $+ >		<$1:$2> <$3> <$4>
R<$-:$+> $+			$@ $>"TLS_req" $3 $| <$1:$2>

######################################################################
###  TLS_req: check additional TLS requirements
###
###	Parameters: [<list> <of> <req>] $| <$-:$+>
###		$-: SMTP reply code
###		$+: Enhanced Status Code
######################################################################
STLS_req
R $| $+		$@ OK
R<CN> $* $| <$+>		$: <CN:$&{TLS_Name}> $1 $| <$2>
R<CN:$&{cn_subject}> $* $| <$+>		$@ $>"TLS_req" $1 $| <$2>
R<CN:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " CN " $&{cn_subject} " does not match " $1
R<CS:$&{cert_subject}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CS:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Subject " $&{cert_subject} " does not match " $1
R<CI:$&{cert_issuer}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CI:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Issuer " $&{cert_issuer} " does not match " $1
ROK			$@ OK

######################################################################
###  max: return the maximum of two values separated by :
###
###	Parameters: [$-]:[$-]
######################################################################
Smax
R:		$: 0
R:$-		$: $1
R$-:		$: $1
R$-:$-		$: $(arith l $@ $1 $@ $2 $) : $1 : $2
RTRUE:$-:$-	$: $2
R$-:$-:$-	$: $2


######################################################################
###  RelayTLS: allow relaying based on TLS authentication
###
###	Parameters:
###		none
######################################################################
SRelayTLS
# authenticated?
R$*			$: <?> $&{verify}
R<?> OK			$: OK		authenticated: continue
R<?> $*			$@ NO		not authenticated
R$*			$: $&{cert_issuer}
R$+			$: $(access CERTISSUER:$1 $)
RRELAY			$# RELAY
RSUBJECT		$: <@> $&{cert_subject}
R<@> $+			$: <@> $(access CERTSUBJECT:$1 $)
R<@> RELAY		$# RELAY
R$*			$: NO

######################################################################
###  authinfo: lookup authinfo in the access map
###
###	Parameters:
###		$1: {server_name}
###		$2: {server_addr}
######################################################################
Sauthinfo
R$*		$: $1 $| $>D <$&{server_name}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| <$(access AuthInfo: $: ? $)> <>
R$* $| <?>$*	$@ no				no authinfo available
R$* $| <$*> <>	$# $2





#
######################################################################
######################################################################
#####
#####			MAIL FILTER DEFINITIONS
#####
######################################################################
######################################################################

#
######################################################################
######################################################################
#####
#####			MAILER DEFINITIONS
#####
######################################################################
######################################################################

#####################################
###   SMTP Mailer specification   ###
#####################################

#####  $Id: smtp.m4,v 8.64 2001/04/03 01:52:54 gshapiro Exp $  #####

#
#  common sender and masquerading recipient rewriting
#
SMasqSMTP
R$* < @ $* > $*		$@ $1 < @ $2 > $3		already fully qualified
R$+			$@ $1 < @ *LOCAL* >		add local qualification

#
#  convert pseudo-domain addresses to real domain addresses
#
SPseudoToReal

# pass <route-addr>s through
R< @ $+ > $*		$@ < @ $1 > $2			resolve <route-addr>

# output fake domains as user%fake@relay

# do UUCP heuristics; note that these are shared with UUCP mailers
R$+ < @ $+ .UUCP. >	$: < $2 ! > $1			convert to UUCP form
R$+ < @ $* > $*		$@ $1 < @ $2 > $3		not UUCP form

# leave these in .UUCP form to avoid further tampering
R< $&h ! > $- ! $+	$@ $2 < @ $1 .UUCP. >
R< $&h ! > $-.$+ ! $+	$@ $3 < @ $1.$2 >
R< $&h ! > $+		$@ $1 < @ $&h .UUCP. >
R< $+ ! > $+		$: $1 ! $2 < @ $Y >		use UUCP_RELAY
R$+ < @ $~[ $* : $+ >	$@ $1 < @ $4 >			strip mailer: part
R$+ < @ >		$: $1 < @ *LOCAL* >		if no UUCP_RELAY


#
#  envelope sender rewriting
#
SEnvFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$* :; <@>		$@				list:; special case
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqEnv $1			do masquerading


#
#  envelope recipient rewriting --
#  also header recipient if not masquerading recipients
#
SEnvToSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$+			$: $>MasqSMTP $1		qualify unqual'ed names
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  header sender and masquerading header recipient rewriting
#
SHdrFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R:; <@>			$@				list:; special case

# do special header rewriting
R$* <@> $*		$@ $1 <@> $2			pass null host through
R< @ $* > $*		$@ < @ $1 > $2			pass route-addr through
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqHdr $1			do masquerading


#
#  relay mailer header masquerading recipient rewriting
#
SMasqRelay
R$+			$: $>MasqSMTP $1
R$+			$: $>MasqHdr $1

Msmtp,		P=[IPC], F=mDFMuX, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mesmtp,		P=[IPC], F=mDFMuXa, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Msmtp8,		P=[IPC], F=mDFMuX8, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mdsmtp,		P=[IPC], F=mDFMuXa%, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mrelay,		P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h


######################*****##############
###   PROCMAIL Mailer specification   ###
##################*****##################

#####  $Id: procmail.m4,v 8.22 2001/11/12 23:11:34 ca Exp $  #####

Mprocmail,	P=/usr/bin/procmail, F=DFMSPhnu9, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP/HdrFromSMTP,
		T=DNS/RFC822/X-Unix,
		A=procmail -Y -m $h $f $u


##################################################
###   Local and Program Mailer specification   ###
##################################################

#####  $Id: local.m4,v 8.59 2004/11/23 00:37:25 ca Exp $  #####

#
#  Envelope sender rewriting
#
SEnvFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqEnv $1		do masquerading

#
#  Envelope recipient rewriting
#
SEnvToL
R$+ < @ $* >		$: $1			strip host part

#
#  Header sender rewriting
#
SHdrFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqHdr $1		do masquerading

#
#  Header recipient rewriting
#
SHdrToL
R$+			$: $>AddDomain $1	add local domain if needed
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  Common code to add local domain name (only if always-add-domain)
#
SAddDomain
R$* < @ $* > $* 	$@ $1 < @ $2 > $3	already fully qualified

R$+			$@ $1 < @ *LOCAL* >	add local qualification

Mlocal,		P=/usr/bin/procmail, F=lsDFMAw5:/|@qSPfhn9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL,
		T=DNS/RFC822/X-Unix,
		A=procmail -t -Y -a $h -d $u
Mprog,		P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL, D=$z:/,
		T=X-Unix/X-Unix/X-Unix,
		A=smrsh -c $u

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# m4 sendmail.mc  sendmail.cf
#
# Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
#	All rights reserved.
# Copyright (c) 1983, 1995 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.
#
#

######################################################################
######################################################################
#####
#####		SENDMAIL CONFIGURATION FILE
#####
##### built by root@altnix.com on Fri May 2 12:26:11 IST 2014
##### in /etc/mail
##### using /usr/share/sendmail-cf/ as configuration include directory
#####
######################################################################
#####
#####	DO NOT EDIT THIS FILE!  Only edit the source .mc file.
#####
######################################################################
######################################################################

#####  $Id: cfhead.m4,v 8.116 2004/01/28 22:02:22 ca Exp $  #####
#####  $Id: cf.m4,v 8.32 1999/02/07 07:26:14 gshapiro Exp $  #####
#####  setup for linux  #####
#####  $Id: linux.m4,v 8.13 2000/09/17 17:30:00 gshapiro Exp $  #####



#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####


#####  $Id: no_default_msa.m4,v 8.2 2001/02/14 05:03:22 gshapiro Exp $  #####

#####  $Id: smrsh.m4,v 8.14 1999/11/18 05:06:23 ca Exp $  #####

#####  $Id: mailertable.m4,v 8.25 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: virtusertable.m4,v 8.23 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: redirect.m4,v 8.15 1999/08/06 01:47:36 gshapiro Exp $  #####

#####  $Id: always_add_domain.m4,v 8.11 2000/09/12 22:00:53 ca Exp $  #####

#####  $Id: use_cw_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: use_ct_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####

#####  $Id: access_db.m4,v 8.26 2004/06/24 18:10:02 ca Exp $  #####

#####  $Id: blacklist_recipients.m4,v 8.13 1999/04/02 02:25:13 gshapiro Exp $  #####

#####  $Id: accept_unresolvable_domains.m4,v 8.10 1999/02/07 07:26:07 gshapiro Exp $  #####


#
# Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
#	All rights reserved.
# Copyright (c) 1983, 1995 Eric P. Allman.  All rights reserved.
# Copyright (c) 1988, 1993
#	The Regents of the University of California.  All rights reserved.
#
# By using this file, you agree to the terms and conditions set
# forth in the LICENSE file which can be found at the top level of
# the sendmail distribution.
#
#

######################################################################
######################################################################
#####
#####		SENDMAIL CONFIGURATION FILE
#####
##### built by root@altnix.com on Fri May 2 12:03:46 IST 2014
##### in /etc/mail
##### using /usr/share/sendmail-cf/ as configuration include directory
#####
######################################################################
#####
#####	DO NOT EDIT THIS FILE!  Only edit the source .mc file.
#####
######################################################################
######################################################################

#####  $Id: cfhead.m4,v 8.116 2004/01/28 22:02:22 ca Exp $  #####
#####  $Id: cf.m4,v 8.32 1999/02/07 07:26:14 gshapiro Exp $  #####
#####  setup for linux  #####
#####  $Id: linux.m4,v 8.13 2000/09/17 17:30:00 gshapiro Exp $  #####



#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####


#####  $Id: no_default_msa.m4,v 8.2 2001/02/14 05:03:22 gshapiro Exp $  #####

#####  $Id: smrsh.m4,v 8.14 1999/11/18 05:06:23 ca Exp $  #####

#####  $Id: mailertable.m4,v 8.25 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: virtusertable.m4,v 8.23 2002/06/27 23:23:57 gshapiro Exp $  #####

#####  $Id: redirect.m4,v 8.15 1999/08/06 01:47:36 gshapiro Exp $  #####

#####  $Id: always_add_domain.m4,v 8.11 2000/09/12 22:00:53 ca Exp $  #####

#####  $Id: use_cw_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: use_ct_file.m4,v 8.11 2001/08/26 20:58:57 gshapiro Exp $  #####


#####  $Id: local_procmail.m4,v 8.22 2002/11/17 04:24:19 ca Exp $  #####

#####  $Id: access_db.m4,v 8.26 2004/06/24 18:10:02 ca Exp $  #####

#####  $Id: blacklist_recipients.m4,v 8.13 1999/04/02 02:25:13 gshapiro Exp $  #####

#####  $Id: accept_unresolvable_domains.m4,v 8.10 1999/02/07 07:26:07 gshapiro Exp $  #####


#####  $Id: proto.m4,v 8.719 2006/03/30 20:50:13 ca Exp $  #####

# level 10 config file format
V10/Berkeley

# override file safeties - setting this option compromises system security,
# addressing the actual file configuration problem is preferred
# need to set this before any file actions are encountered in the cf file
#O DontBlameSendmail=safe

# default LDAP map specification
# need to set this now before any LDAP maps are defined
#O LDAPDefaultSpec=-h localhost

##################
#   local info   #
##################

# my LDAP cluster
# need to set this before any LDAP lookups are done (including classes)
#D{sendmailMTACluster}$m

Cwlocalhost
# file containing names of hosts for which we receive email
Fw/etc/mail/local-host-names

# my official domain name
# ... define this only if sendmail cannot automatically determine your domain
#Dj$w.Foo.COM

# host/domain names ending with a token in class P are canonical
CP.

# "Smart" relay host (may be null)
DS


# operators that cannot be in local usernames (i.e., network indicators)
CO @ % !

# a class with just dot (for identifying canonical names)
C..

# a class with just a left bracket (for identifying domain literals)
C[[

# access_db acceptance class
C{Accept}OK RELAY


C{ResOk}OKR


# Hosts for which relaying is permitted ($=R)
FR-o /etc/mail/relay-domains

# arithmetic map
Karith arith
# macro storage map
Kmacro macro
# possible values for TLS_connection in access map
C{Tls}VERIFY ENCR





# dequoting map
Kdequote dequote

# class E: names that should be exposed as from this host, even if we masquerade
# class L: names that should be delivered locally, even if we have a relay
# class M: domains that should be converted to $M
# class N: domains that should not be converted to $M
#CL root
C{E}root
C{w}altnix.com



# my name for error messages
DnMAILER-DAEMON


# Mailer table (overriding domains)
Kmailertable hash -o /etc/mail/mailertable.db

# Virtual user table (maps incoming users)
Kvirtuser hash -o /etc/mail/virtusertable.db

CPREDIRECT

# Access list database (for spam stomping)
Kaccess hash -T<TMPF> -o /etc/mail/access.db

# Configuration version number
DZ8.13.8


###############
#   Options   #
###############

# strip message body to 7 bits on input?
O SevenBitInput=False

# 8-bit data handling
#O EightBitMode=pass8

# wait for alias file rebuild (default units: minutes)
O AliasWait=10

# location of alias file
O AliasFile=/etc/aliases

# minimum number of free blocks on filesystem
O MinFreeBlocks=100

# maximum message size
#O MaxMessageSize=0

# substitution for space (blank) characters
O BlankSub=.

# avoid connecting to "expensive" mailers on initial submission?
O HoldExpensive=False

# checkpoint queue runs after every N successful deliveries
#O CheckpointInterval=10

# default delivery mode
O DeliveryMode=background

# error message header/file
#O ErrorHeader=/etc/mail/error-header

# error mode
#O ErrorMode=print

# save Unix-style "From_" lines at top of header?
#O SaveFromLine=False

# queue file mode (qf files)
#O QueueFileMode=0600

# temporary file mode
O TempFileMode=0600

# match recipients against GECOS field?
#O MatchGECOS=False

# maximum hop count
#O MaxHopCount=25

# location of help file
O HelpFile=/etc/mail/helpfile

# ignore dots as terminators in incoming messages?
#O IgnoreDots=False

# name resolver options
#O ResolverOptions=+AAONLY

# deliver MIME-encapsulated error messages?
O SendMimeErrors=True

# Forward file search path
O ForwardPath=$z/.forward.$w:$z/.forward

# open connection cache size
O ConnectionCacheSize=2

# open connection cache timeout
O ConnectionCacheTimeout=5m

# persistent host status directory
#O HostStatusDirectory=.hoststat

# single thread deliveries (requires HostStatusDirectory)?
#O SingleThreadDelivery=False

# use Errors-To: header?
O UseErrorsTo=False

# log level
O LogLevel=9

# send to me too, even in an alias expansion?
#O MeToo=True

# verify RHS in newaliases?
O CheckAliases=False

# default messages to old style headers if no special punctuation?
O OldStyleHeaders=True

# SMTP daemon options
O DaemonPortOptions=Name=MTA

# SMTP client options
#O ClientPortOptions=Family=inet, Address=0.0.0.0

# Modifiers to define {daemon_flags} for direct submissions
#O DirectSubmissionModifiers

# Use as mail submission program? See sendmail/SECURITY
#O UseMSP

# privacy flags
O PrivacyOptions=authwarnings,novrfy,noexpn,restrictqrun

# who (if anyone) should get extra copies of error messages
#O PostmasterCopy=Postmaster

# slope of queue-only function
#O QueueFactor=600000

# limit on number of concurrent queue runners
#O MaxQueueChildren

# maximum number of queue-runners per queue-grouping with multiple queues
#O MaxRunnersPerQueue=1

# priority of queue runners (nice(3))
#O NiceQueueRun

# shall we sort the queue by hostname first?
#O QueueSortOrder=priority

# minimum time in queue before retry
#O MinQueueAge=30m

# how many jobs can you process in the queue?
#O MaxQueueRunSize=0

# perform initial split of envelope without checking MX records
#O FastSplit=1

# queue directory
O QueueDirectory=/var/spool/mqueue

# key for shared memory; 0 to turn off
#O SharedMemoryKey=0



# timeouts (many of these)
#O Timeout.initial=5m
O Timeout.connect=1m
#O Timeout.aconnect=0s
#O Timeout.iconnect=5m
#O Timeout.helo=5m
#O Timeout.mail=10m
#O Timeout.rcpt=1h
#O Timeout.datainit=5m
#O Timeout.datablock=1h
#O Timeout.datafinal=1h
#O Timeout.rset=5m
#O Timeout.quit=2m
#O Timeout.misc=2m
#O Timeout.command=1h
O Timeout.ident=0
#O Timeout.fileopen=60s
#O Timeout.control=2m
O Timeout.queuereturn=5d
#O Timeout.queuereturn.normal=5d
#O Timeout.queuereturn.urgent=2d
#O Timeout.queuereturn.non-urgent=7d
#O Timeout.queuereturn.dsn=5d
O Timeout.queuewarn=4h
#O Timeout.queuewarn.normal=4h
#O Timeout.queuewarn.urgent=1h
#O Timeout.queuewarn.non-urgent=12h
#O Timeout.queuewarn.dsn=4h
#O Timeout.hoststatus=30m
#O Timeout.resolver.retrans=5s
#O Timeout.resolver.retrans.first=5s
#O Timeout.resolver.retrans.normal=5s
#O Timeout.resolver.retry=4
#O Timeout.resolver.retry.first=4
#O Timeout.resolver.retry.normal=4
#O Timeout.lhlo=2m
#O Timeout.auth=10m
#O Timeout.starttls=1h

# time for DeliverBy; extension disabled if less than 0
#O DeliverByMin=0

# should we not prune routes in route-addr syntax addresses?
#O DontPruneRoutes=False

# queue up everything before forking?
O SuperSafe=True

# status file
O StatusFile=/var/log/mail/statistics

# time zone handling:
#  if undefined, use system default
#  if defined but null, use TZ envariable passed in
#  if defined and non-null, use that info
#O TimeZoneSpec=

# default UID (can be username or userid:groupid)
O DefaultUser=8:12

# list of locations of user database file (null means no lookup)
O UserDatabaseSpec=/etc/mail/userdb.db

# fallback MX host
#O FallbackMXhost=fall.back.host.net

# fallback smart host
#O FallbackSmartHost=fall.back.host.net

# if we are the best MX host for a site, try it directly instead of config err
O TryNullMXList=True

# load average at which we just queue messages
#O QueueLA=8

# load average at which we refuse connections
#O RefuseLA=12

# log interval when refusing connections for this long
#O RejectLogInterval=3h

# load average at which we delay connections; 0 means no limit
#O DelayLA=0

# maximum number of children we allow at one time
#O MaxDaemonChildren=0

# maximum number of new connections per second
#O ConnectionRateThrottle=0

# Width of the window 
#O ConnectionRateWindowSize=60s

# work recipient factor
#O RecipientFactor=30000

# deliver each queued job in a separate process?
#O ForkEachJob=False

# work class factor
#O ClassFactor=1800

# work time factor
#O RetryFactor=90000

# default character set
#O DefaultCharSet=unknown-8bit

# service switch file (name hardwired on Solaris, Ultrix, OSF/1, others)
#O ServiceSwitchFile=/etc/mail/service.switch

# hosts file (normally /etc/hosts)
#O HostsFile=/etc/hosts

# dialup line delay on connection failure
#O DialDelay=0s

# action to take if there are no recipients in the message
#O NoRecipientAction=none

# chrooted environment for writing to files
#O SafeFileEnvironment

# are colons OK in addresses?
#O ColonOkInAddr=True

# shall I avoid expanding CNAMEs (violates protocols)?
#O DontExpandCnames=False

# SMTP initial login message (old $e macro)
O SmtpGreetingMessage=$j Sendmail $v/$Z; $b

# UNIX initial From header format (old $l macro)
O UnixFromLine=From $g $d

# From: lines that have embedded newlines are unwrapped onto one line
#O SingleLineFromHeader=False

# Allow HELO SMTP command that does not include a host name
#O AllowBogusHELO=False

# Characters to be quoted in a full name phrase (@,;:\()[] are automatic)
#O MustQuoteChars=.

# delimiter (operator) characters (old $o macro)
O OperatorChars=.:%@!^/[]+

# shall I avoid calling initgroups(3) because of high NIS costs?
#O DontInitGroups=False

# are group-writable :include: and .forward files (un)trustworthy?
# True (the default) means they are not trustworthy.
#O UnsafeGroupWrites=True


# where do errors that occur when sending errors get sent?
#O DoubleBounceAddress=postmaster

# where to save bounces if all else fails
#O DeadLetterDrop=/var/tmp/dead.letter

# what user id do we assume for the majority of the processing?
#O RunAsUser=sendmail

# maximum number of recipients per SMTP envelope
#O MaxRecipientsPerMessage=0

# limit the rate recipients per SMTP envelope are accepted
# once the threshold number of recipients have been rejected
#O BadRcptThrottle=0

# shall we get local names from our installed interfaces?
O DontProbeInterfaces=True

# Return-Receipt-To: header implies DSN request
#O RrtImpliesDsn=False

# override connection address (for testing)
#O ConnectOnlyTo=0.0.0.0

# Trusted user for file ownership and starting the daemon
#O TrustedUser=root

# Control socket for daemon management
#O ControlSocketName=/var/spool/mqueue/.control

# Maximum MIME header length to protect MUAs
#O MaxMimeHeaderLength=0/0

# Maximum length of the sum of all headers
#O MaxHeadersLength=32768

# Maximum depth of alias recursion
#O MaxAliasRecursion=10

# location of pid file
#O PidFile=/var/run/sendmail.pid

# Prefix string for the process title shown on 'ps' listings
#O ProcessTitlePrefix=prefix

# Data file (df) memory-buffer file maximum size
#O DataFileBufferSize=4096

# Transcript file (xf) memory-buffer file maximum size
#O XscriptFileBufferSize=4096

# lookup type to find information about local mailboxes
#O MailboxDatabase=pw

# override compile time flag REQUIRES_DIR_FSYNC
#O RequiresDirfsync=true

# list of authentication mechanisms
#O AuthMechanisms=EXTERNAL GSSAPI KERBEROS_V4 DIGEST-MD5 CRAM-MD5

# Authentication realm
#O AuthRealm

# default authentication information for outgoing connections
#O DefaultAuthInfo=/etc/mail/default-auth-info

# SMTP AUTH flags
O AuthOptions=A

# SMTP AUTH maximum encryption strength
#O AuthMaxBits

# SMTP STARTTLS server options
#O TLSSrvOptions

# Input mail filters
#O InputMailFilters


# CA directory
#O CACertPath
# CA file
#O CACertFile
# Server Cert
#O ServerCertFile
# Server private key
#O ServerKeyFile
# Client Cert
#O ClientCertFile
# Client private key
#O ClientKeyFile
# File containing certificate revocation lists 
#O CRLFile
# DHParameters (only required if DSA/DH is used)
#O DHParameters
# Random data source (required for systems without /dev/urandom under OpenSSL)
#O RandFile

############################
# QUEUE GROUP DEFINITIONS  #
############################


###########################
#   Message precedences   #
###########################

Pfirst-class=0
Pspecial-delivery=100
Plist=-30
Pbulk=-60
Pjunk=-100

#####################
#   Trusted users   #
#####################

# this is equivalent to setting class "t"
Ft/etc/mail/trusted-users
Troot
Tdaemon
Tuucp

#########################
#   Format of headers   #
#########################

H?P?Return-Path: <$g>
HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
	$.$?{auth_type}(authenticated$?{auth_ssf} bits=${auth_ssf}$.)
	$.by $j ($v/$Z)$?r with $r$. id $i$?{tls_version}
	(version=${tls_version} cipher=${cipher} bits=${cipher_bits} verify=${verify})$.$?u
	for $u; $|;
	$.$b
H?D?Resent-Date: $a
H?D?Date: $a
H?F?Resent-From: $?x$x <$g>$|$g$.
H?F?From: $?x$x <$g>$|$g$.
H?x?Full-Name: $x
# HPosted-Date: $a
# H?l?Received-Date: $b
H?M?Resent-Message-Id: <$t.$i@$j>
H?M?Message-Id: <$t.$i@$j>

#
######################################################################
######################################################################
#####
#####			REWRITING RULES
#####
######################################################################
######################################################################

############################################
###  Ruleset 3 -- Name Canonicalization  ###
############################################
Scanonify=3

# handle null input (translate to <@> special case)
R$@			$@ <@>

# strip group: syntax (not inside angle brackets!) and trailing semicolon
R$*			$: $1 <@>			mark addresses
R$* < $* > $* <@>	$: $1 < $2 > $3			unmark <addr>
R@ $* <@>		$: @ $1				unmark @host:...
R$* [ IPv6 : $+ ] <@>	$: $1 [ IPv6 : $2 ]		unmark IPv6 addr
R$* :: $* <@>		$: $1 :: $2			unmark node::addr
R:include: $* <@>	$: :include: $1			unmark :include:...
R$* : $* [ $* ]		$: $1 : $2 [ $3 ] <@>		remark if leading colon
R$* : $* <@>		$: $2				strip colon if marked
R$* <@>			$: $1				unmark
R$* ;			   $1				strip trailing semi
R$* < $+ :; > $*	$@ $2 :; <@>			catch <list:;>
R$* < $* ; >		   $1 < $2 >			bogus bracketed semi

# null input now results from list:; syntax
R$@			$@ :; <@>

# strip angle brackets -- note RFC733 heuristic to get innermost item
R$*			$: < $1 >			housekeeping <>
R$+ < $* >		   < $2 >			strip excess on left
R< $* > $+		   < $1 >			strip excess on right
R<>			$@ < @ >			MAIL FROM:<> case
R< $+ >			$: $1				remove housekeeping <>

# strip route address <@a,@b,@c:user@d> -> <user@d>
R@ $+ , $+		$2
R@ [ $* ] : $+		$2
R@ $+ : $+		$2

# find focus for list syntax
R $+ : $* ; @ $+	$@ $>Canonify2 $1 : $2 ; < @ $3 >	list syntax
R $+ : $* ;		$@ $1 : $2;			list syntax

# find focus for @ syntax addresses
R$+ @ $+		$: $1 < @ $2 >			focus on domain
R$+ < $+ @ $+ >		$1 $2 < @ $3 >			move gaze right
R$+ < @ $+ >		$@ $>Canonify2 $1 < @ $2 >	already canonical


# convert old-style addresses to a domain-based address
R$- ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	resolve uucp names
R$+ . $- ! $+		$@ $>Canonify2 $3 < @ $1 . $2 >		domain uucps
R$+ ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	uucp subdomains

# if we have % signs, take the rightmost one
R$* % $*		$1 @ $2				First make them all @s.
R$* @ $* @ $*		$1 % $2 @ $3			Undo all but the last.
R$* @ $*		$@ $>Canonify2 $1 < @ $2 >	Insert < > and finish

# else we must be a local name
R$*			$@ $>Canonify2 $1


################################################
###  Ruleset 96 -- bottom half of ruleset 3  ###
################################################

SCanonify2=96

# handle special cases for local names
R$* < @ localhost > $*		$: $1 < @ $j . > $2		no domain at all
R$* < @ localhost . $m > $*	$: $1 < @ $j . > $2		local domain
R$* < @ localhost . UUCP > $*	$: $1 < @ $j . > $2		.UUCP domain

# check for IPv4/IPv6 domain literal
R$* < @ [ $+ ] > $*		$: $1 < @@ [ $2 ] > $3		mark [addr]
R$* < @@ $=w > $*		$: $1 < @ $j . > $3		self-literal
R$* < @@ $+ > $*		$@ $1 < @ $2 > $3		canon IP addr





# if really UUCP, handle it immediately

# try UUCP traffic as a local address
R$* < @ $+ . UUCP > $*		$: $1 < @ $[ $2 $] . UUCP . > $3
R$* < @ $+ . . UUCP . > $*	$@ $1 < @ $2 . > $3

# hostnames ending in class P are always canonical
R$* < @ $* $=P > $*		$: $1 < @ $2 $3 . > $4
R$* < @ $* $~P > $*		$: $&{daemon_flags} $| $1 < @ $2 $3 > $4
R$* CC $* $| $* < @ $+.$+ > $*	$: $3 < @ $4.$5 . > $6
R$* CC $* $| $*			$: $3
# pass to name server to make hostname canonical
R$* $| $* < @ $* > $*		$: $2 < @ $[ $3 $] > $4
R$* $| $*			$: $2

# local host aliases and pseudo-domains are always canonical
R$* < @ $=w > $*		$: $1 < @ $2 . > $3
R$* < @ $=M > $*		$: $1 < @ $2 . > $3
R$* < @ $={VirtHost} > $* 	$: $1 < @ $2 . > $3
R$* < @ $* . . > $*		$1 < @ $2 . > $3


##################################################
###  Ruleset 4 -- Final Output Post-rewriting  ###
##################################################
Sfinal=4

R$+ :; <@>		$@ $1 :				handle <list:;>
R$* <@>			$@				handle <> and list:;

# strip trailing dot off possibly canonical name
R$* < @ $+ . > $*	$1 < @ $2 > $3

# eliminate internal code
R$* < @ *LOCAL* > $*	$1 < @ $j > $2

# externalize local domain info
R$* < $+ > $*		$1 $2 $3			defocus
R@ $+ : @ $+ : $+	@ $1 , @ $2 : $3		<route-addr> canonical
R@ $*			$@ @ $1				... and exit

# UUCP must always be presented in old form
R$+ @ $- . UUCP		$2!$1				u@h.UUCP => h!u

# delete duplicate local names
R$+ % $=w @ $=w		$1 @ $2				u%host@host => u@host



##############################################################
###   Ruleset 97 -- recanonicalize and call ruleset zero   ###
###		   (used for recursive calls)		   ###
##############################################################

SRecurse=97
R$*			$: $>canonify $1
R$*			$@ $>parse $1


######################################
###   Ruleset 0 -- Parse Address   ###
######################################

Sparse=0

R$*			$: $>Parse0 $1		initial parsing
R<@>			$#local $: <@>		special case error msgs
R$*			$: $>ParseLocal $1	handle local hacks
R$*			$: $>Parse1 $1		final parsing

#
#  Parse0 -- do initial syntax checking and eliminate local addresses.
#	This should either return with the (possibly modified) input
#	or return with a #error mailer.  It should not return with a
#	#mailer other than the #error mailer.
#

SParse0
R<@>			$@ <@>			special case error msgs
R$* : $* ; <@>		$#error $@ 5.1.3 $: "553 List:; syntax illegal for recipient addresses"
R@ <@ $* >		< @ $1 >		catch "@@host" bogosity
R<@ $+>			$#error $@ 5.1.3 $: "553 User address required"
R$+ <@>			$#error $@ 5.1.3 $: "553 Hostname required"
R$*			$: <> $1
R<> $* < @ [ $* ] : $+ > $*	$1 < @ [ $2 ] : $3 > $4
R<> $* < @ [ $* ] , $+ > $*	$1 < @ [ $2 ] , $3 > $4
R<> $* < @ [ $* ] $+ > $*	$#error $@ 5.1.2 $: "553 Invalid address"
R<> $* < @ [ $+ ] > $*		$1 < @ [ $2 ] > $3
R<> $* <$* : $* > $*	$#error $@ 5.1.3 $: "553 Colon illegal in host name part"
R<> $*			$1
R$* < @ . $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* .. $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* @ > $*	$#error $@ 5.1.2 $: "553 Invalid route address"
R$* @ $* < @ $* > $*	$#error $@ 5.1.3 $: "553 Invalid route address"
R$* , $~O $*		$#error $@ 5.1.3 $: "553 Invalid route address"


# now delete the local info -- note $=O to find characters that cause forwarding
R$* < @ > $*		$@ $>Parse0 $>canonify $1	user@ => user
R< @ $=w . > : $*	$@ $>Parse0 $>canonify $2	@here:... -> ...
R$- < @ $=w . >		$: $(dequote $1 $) < @ $2 . >	dequote "foo"@here
R< @ $+ >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ $=w . >	$@ $>Parse0 $>canonify $1 $2 $3	...@here -> ...
R$- 			$: $(dequote $1 $) < @ *LOCAL* >	dequote "foo"
R< @ *LOCAL* >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ *LOCAL* >
			$@ $>Parse0 $>canonify $1 $2 $3	...@*LOCAL* -> ...
R$* < @ *LOCAL* >	$: $1

#
#  Parse1 -- the bottom half of ruleset 0.
#

SParse1

# handle numeric address spec
R$* < @ [ $+ ] > $*	$: $>ParseLocal $1 < @ [ $2 ] > $3	numeric internet spec
R$* < @ [ $+ ] > $*	$: $1 < @ [ $2 ] : $S > $3	Add smart host to path
R$* < @ [ $+ ] : > $*		$#esmtp $@ [$2] $: $1 < @ [$2] > $3	no smarthost: send
R$* < @ [ $+ ] : $- : $*> $*	$#$3 $@ $4 $: $1 < @ [$2] > $5	smarthost with mailer
R$* < @ [ $+ ] : $+ > $*	$#esmtp $@ $3 $: $1 < @ [$2] > $4	smarthost without mailer

# handle virtual users
R$+			$: <!> $1		Mark for lookup
R<!> $+ < @ $={VirtHost} . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<!> $+ < @ $=w . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+ + $+ < @ $* . >
			$: < $(virtuser $1 + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $+ < @ $+ . >	$: < $(virtuser + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser @ $3 $@ $1 $@ $2 $@ +$2 $: ! $) > $1 + $2 < @ $3 . >
R<@> $+ < @ $+ . >	$: < $(virtuser @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+			$: $1
R<!> $+			$: $1
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- $+ > $* 	$#error $@ $(dequote $1 $) $: $2
R< $+ > $+ < @ $+ >	$: $>Recurse $1

# short circuit local delivery so forwarded email works


R$=L < @ $=w . >	$#local $: @ $1			special local names
R$+ < @ $=w . >		$#local $: $1			regular local name

# not local -- try mailer table lookup
R$* <@ $+ > $*		$: < $2 > $1 < @ $2 > $3	extract host name
R< $+ . > $*		$: < $1 > $2			strip trailing dot
R< $+ > $*		$: < $(mailertable $1 $) > $2	lookup
R< $~[ : $* > $* 	$>MailerToTriple < $1 : $2 > $3		check -- resolved?
R< $+ > $*		$: $>Mailertable <$1> $2		try domain

# resolve remotely connected UUCP links (if any)

# resolve fake top level domains by forwarding to other hosts



# pass names that still have a host to a smarthost (if defined)
R$* < @ $* > $*		$: $>MailerToTriple < $S > $1 < @ $2 > $3	glue on smarthost name

# deal with other remote names
R$* < @$* > $*		$#esmtp $@ $2 $: $1 < @ $2 > $3	user@host.domain

# handle locally delivered names
R$=L			$#local $: @ $1		special local names
R$+			$#local $: $1			regular local names

###########################################################################
###   Ruleset 5 -- special rewriting after aliases have been expanded   ###
###########################################################################

SLocal_localaddr
Slocaladdr=5
R$+			$: $1 $| $>"Local_localaddr" $1
R$+ $| $#ok		$@ $1			no change
R$+ $| $#$*		$#$2
R$+ $| $*		$: $1




# deal with plussed users so aliases work nicely
R$+ + *			$#local $@ $&h $: $1
R$+ + $*		$#local $@ + $2 $: $1 + *

# prepend an empty "forward host" on the front
R$+			$: <> $1



R< > $+			$: < > < $1 <> $&h >		nope, restore +detail

R< > < $+ <> + $* >	$: < > < $1 + $2 >		check whether +detail
R< > < $+ <> $* >	$: < > < $1 >			else discard
R< > < $+ + $* > $*	   < > < $1 > + $2 $3		find the user part
R< > < $+ > + $*	$#local $@ $2 $: @ $1		strip the extra +
R< > < $+ >		$@ $1				no +detail
R$+			$: $1 <> $&h			add +detail back in

R$+ <> + $*		$: $1 + $2			check whether +detail
R$+ <> $*		$: $1				else discard
R< local : $* > $*	$: $>MailerToTriple < local : $1 > $2	no host extension
R< error : $* > $*	$: $>MailerToTriple < error : $1 > $2	no host extension

R< $~[ : $+ > $+	$: $>MailerToTriple < $1 : $2 > $3 < @ $2 >

R< $+ > $+		$@ $>MailerToTriple < $1 > $2 < @ $1 >


###################################################################
###  Ruleset 90 -- try domain part of mailertable entry 	###
###################################################################

SMailertable=90
R$* <$- . $+ > $*	$: $1$2 < $(mailertable .$3 $@ $1$2 $@ $2 $) > $4
R$* <$~[ : $* > $*	$>MailerToTriple < $2 : $3 > $4		check -- resolved?
R$* < . $+ > $* 	$@ $>Mailertable $1 . <$2> $3		no -- strip & try again
R$* < $* > $*		$: < $(mailertable . $@ $1$2 $) > $3	try "."
R< $~[ : $* > $*	$>MailerToTriple < $1 : $2 > $3		"." found?
R< $* > $*		$@ $2				no mailertable match

###################################################################
###  Ruleset 95 -- canonify mailer:[user@]host syntax to triple	###
###################################################################

SMailerToTriple=95
R< > $*				$@ $1			strip off null relay
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- : $+ > $*		$#error $@ $(dequote $1 $) $: $2
R< error : $+ > $*		$#error $: $1
R< local : $* > $*		$>CanonLocal < $1 > $2
R< $~[ : $+ @ $+ > $*<$*>$*	$# $1 $@ $3 $: $2<@$3>	use literal user
R< $~[ : $+ > $*		$# $1 $@ $2 $: $3	try qualified mailer
R< $=w > $*			$@ $2			delete local host
R< $+ > $*			$#relay $@ $1 $: $2	use unqualified mailer

###################################################################
###  Ruleset CanonLocal -- canonify local: syntax		###
###################################################################

SCanonLocal
# strip local host from routed addresses
R< $* > < @ $+ > : $+		$@ $>Recurse $3
R< $* > $+ $=O $+ < @ $+ >	$@ $>Recurse $2 $3 $4

# strip trailing dot from any host name that may appear
R< $* > $* < @ $* . >		$: < $1 > $2 < @ $3 >

# handle local: syntax -- use old user, either with or without host
R< > $* < @ $* > $*		$#local $@ $1@$2 $: $1
R< > $+				$#local $@ $1    $: $1

# handle local:user@host syntax -- ignore host part
R< $+ @ $+ > $* < @ $* >	$: < $1 > $3 < @ $4 >

# handle local:user syntax
R< $+ > $* <@ $* > $*		$#local $@ $2@$3 $: $1
R< $+ > $* 			$#local $@ $2    $: $1

###################################################################
###  Ruleset 93 -- convert header names to masqueraded form	###
###################################################################

SMasqHdr=93


# do not masquerade anything in class N
R$* < @ $* $=N . >	$@ $1 < @ $2 $3 . >

R$* < @ *LOCAL* >	$@ $1 < @ $j . >

###################################################################
###  Ruleset 94 -- convert envelope names to masqueraded form	###
###################################################################

SMasqEnv=94
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

###################################################################
###  Ruleset 98 -- local part of ruleset zero (can be null)	###
###################################################################

SParseLocal=98

# addresses sent to foo@host.REDIRECT will give a 551 error code
R$* < @ $+ .REDIRECT. >		$: $1 < @ $2 . REDIRECT . > < ${opMode} >
R$* < @ $+ .REDIRECT. > <i>	$: $1 < @ $2 . REDIRECT. >
R$* < @ $+ .REDIRECT. > < $- >	$#error $@ 5.1.1 $: "551 User has moved; please try " <$1@$2>




######################################################################
###  D: LookUpDomain -- search for domain in access database
###
###	Parameters:
###		<$1> -- key (domain name)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SD
R<$*> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <[$+.$-]> <$+> <$- $-> <$*>	$@ $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+::$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+:$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <$+.$+> <$+> <$- $-> <$*>	$@ $>D <$2> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  A: LookUpAddress -- search for host address in access database
###
###	Parameters:
###		<$1> -- key (dot quadded host address)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed through)
######################################################################

SA
R<$+> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <$+::$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+:$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+.$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  CanonAddr --	Convert an address into a standard form for
###			relay checking.  Route address syntax is
###			crudely converted into a %-hack address.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed address, not in source route form
######################################################################

SCanonAddr
R$*			$: $>Parse0 $>canonify $1	make domain canonical


######################################################################
###  ParseRecipient --	Strip off hosts in $=R as well as possibly
###			$* $=m or the access database.
###			Check user portion for host separators.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed, non-local-relaying address
######################################################################

SParseRecipient
R$*				$: <?> $>CanonAddr $1
R<?> $* < @ $* . >		<?> $1 < @ $2 >			strip trailing dots
R<?> $- < @ $* >		$: <?> $(dequote $1 $) < @ $2 >	dequote local part

# if no $=O character, no host in the user portion, we are done
R<?> $* $=O $* < @ $* >		$: <NO> $1 $2 $3 < @ $4>
R<?> $*				$@ $1


R<NO> $* < @ $* $=R >		$: <RELAY> $1 < @ $2 $3 >
R<NO> $* < @ $+ >		$: $>D <$2> <NO> <+ To> <$1 < @ $2 >>
R<$+> <$+>			$: <$1> $2



R<RELAY> $* < @ $* >		$@ $>ParseRecipient $1
R<$+> $*			$@ $2


######################################################################
###  check_relay -- check hostname/address on SMTP startup
######################################################################



SLocal_check_relay
Scheck_relay
R$*			$: $1 $| $>"Local_check_relay" $1
R$* $| $* $| $#$*	$#$3
R$* $| $* $| $*		$@ $>"Basic_check_relay" $1 $| $2

SBasic_check_relay
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

R$+ $| $+		$: $>D < $1 > <?> <+ Connect> < $2 >
R   $| $+		$: $>A < $1 > <?> <+ Connect> <>	empty client_name
R<?> <$+>		$: $>A < $1 > <?> <+ Connect> <>	no: another lookup
R<?> <$*>		$: OK				found nothing
R<$={Accept}> <$*>	$@ $1				return value of lookup
R<REJECT> <$*>		$#error $@ 5.7.1 $: "550 Access denied"
R<DISCARD> <$*>		$#discard $: discard
R<QUARANTINE:$+> <$*>	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> <$*>	$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> <$*>		$#error $: $1
R<$* <TMPF>> <$*>		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> <$*>		$#error $: $1



######################################################################
###  check_mail -- check SMTP MAIL FROM: command argument
######################################################################

SLocal_check_mail
Scheck_mail
R$*			$: $1 $| $>"Local_check_mail" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_mail" $1

SBasic_check_mail
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

# authenticated?
R$*			$: $1 $| $>"tls_client" $&{verify} $| MAIL
R$* $| $#$+		$#$2
R$* $| $*		$: $1

R<>			$@ <OK>			we MUST accept <> (RFC 1123)
R$+			$: <?> $1
R<?><$+>		$: <@> <$1>
R<?>$+			$: <@> <$1>
R$*			$: $&{daemon_flags} $| $1
R$* f $* $| <@> < $* @ $- >	$: < ? $&{client_name} > < $3 @ $4 >
R$* u $* $| <@> < $* >	$: <?> < $3 >
R$* $| $*		$: $2
# handle case of @localhost on address
R<@> < $* @ localhost >	$: < ? $&{client_name} > < $1 @ localhost >
R<@> < $* @ [127.0.0.1] >
			$: < ? $&{client_name} > < $1 @ [127.0.0.1] >
R<@> < $* @ localhost.$m >
			$: < ? $&{client_name} > < $1 @ localhost.$m >
R<@> < $* @ localhost.localdomain >
			$: < ? $&{client_name} > < $1 @ localhost.localdomain >
R<@> < $* @ localhost.UUCP >
			$: < ? $&{client_name} > < $1 @ localhost.UUCP >
R<@> $*			$: $1			no localhost as domain
R<? $=w> $*		$: $2			local client: ok
R<? $+> <$+>		$#error $@ 5.5.4 $: "553 Real domain name required for sender address"
R<?> $*			$: $1
R$*			$: <?> $>CanonAddr $1		canonify sender address and mark it
R<?> $* < @ $+ . >	<?> $1 < @ $2 >			strip trailing dots
# handle non-DNS hostnames (*.bitnet, *.decnet, *.uucp, etc)
R<?> $* < @ $* $=P >	$: <OKR> $1 < @ $2 $3 >
R<?> $* < @ $j >	$: <OKR> $1 < @ $j >
R<?> $* < @ $+ >	$: <OKR> $1 < @ $2 >		... unresolvable OK

# check sender address: user@address, user@, address
R<$+> $+ < @ $* >	$: @<$1> <$2 < @ $3 >> $| <F:$2@$3> <U:$2@> <D:$3>
R<$+> $+		$: @<$1> <$2> $| <U:$2@>
R@ <$+> <$*> $| <$+>	$: <@> <$1> <$2> $| $>SearchList <+ From> $| <$3> <>
R<@> <$+> <$*> $| <$*>	$: <$3> <$1> <$2>		reverse result
# retransform for further use
R<?> <$+> <$*>		$: <$1> $2	no match
R<$+> <$+> <$*>		$: <$1> $3	relevant result, keep it

# handle case of no @domain on address
R<?> $*			$: $&{daemon_flags} $| <?> $1
R$* u $* $| <?> $*	$: <OKR> $3
R$* $| $*		$: $2
R<?> $*			$: < ? $&{client_addr} > $1
R<?> $*			$@ <OKR>			...local unqualed ok
R<? $+> $*		$#error $@ 5.5.4 $: "553 Domain name required for sender address " $&f
							...remote is not
# check results
R<?> $*			$: @ $1		mark address: nothing known about it
R<$={ResOk}> $*		$@ <OKR>	domain ok: stop
R<TEMP> $*		$#error $@ 4.1.8 $: "451 Domain of sender address " $&f " does not resolve"
R<PERM> $*		$#error $@ 5.1.8 $: "553 Domain of sender address " $&f " does not exist"
R<$={Accept}> $*	$# $1		accept from access map
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<REJECT> $*		$#error $@ 5.7.1 $: "550 Access denied"
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db

######################################################################
###  check_rcpt -- check SMTP RCPT TO: command argument
######################################################################

SLocal_check_rcpt
Scheck_rcpt
R$*			$: $1 $| $>"Local_check_rcpt" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_rcpt" $1

SBasic_check_rcpt
# empty address?
R<>			$#error $@ nouser $: "553 User address required"
R$@			$#error $@ nouser $: "553 User address required"
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2


######################################################################
R$*			$: $1 $| @ $>"Rcpt_ok" $1
R$* $| @ $#TEMP $+	$: $1 $| T $2
R$* $| @ $#$*		$#$2
R$* $| @ RELAY		$@ RELAY
R$* $| @ $*		$: O $| $>"Relay_ok" $1
R$* $| T $+		$: T $2 $| $>"Relay_ok" $1
R$* $| $#TEMP $+	$#error $2
R$* $| $#$*		$#$2
R$* $| RELAY		$@ RELAY
R T $+ $| $*		$#error $1
# anything else is bogus
R$*			$#error $@ 5.7.1 $: "550 Relaying denied"


######################################################################
### Rcpt_ok: is the recipient ok?
######################################################################
SRcpt_ok
R$*			$: $>ParseRecipient $1		strip relayable hosts



# blacklist local users or any host from receiving mail
R$*			$: <?> $1
R<?> $+ < @ $=w >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <U:$1@> <D:$2>
R<?> $+ < @ $* >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <D:$2>
R<?> $+			$: <> <$1> $| <U:$1@>
R<> <$*> $| <$+>	$: <@> <$1> $| $>SearchList <+ To> $| <$2> <>
R<@> <$*> $| <$*>	$: <$2> <$1>		reverse result
R<?> <$*>		$: @ $1		mark address as no match
R<$={Accept}> <$*>	$: @ $2		mark address as no match

R<REJECT> $*		$#error $@ 5.2.1 $: "550 Mailbox disabled for this recipient"
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db
R@ $*			$1		remove mark

# authenticated via TLS?
R$*			$: $1 $| $>RelayTLS	client authenticated?
R$* $| $# $+		$# $2			error/ok?
R$* $| $*		$: $1			no

R$*			$: $1 $| $>"Local_Relay_Auth" $&{auth_type}
R$* $| $# $*		$# $2
R$* $| NO		$: $1
R$* $| $*		$: $1 $| $&{auth_type}
R$* $|			$: $1
R$* $| $={TrustAuthMech}	$# RELAY
R$* $| $*		$: $1
# anything terminating locally is ok
R$+ < @ $=w >		$@ RELAY
R$+ < @ $* $=R >	$@ RELAY
R$+ < @ $+ >		$: $>D <$2> <?> <+ To> <$1 < @ $2 >>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2



# check for local user (i.e. unqualified address)
R$*			$: <?> $1
R<?> $* < @ $+ >	$: <REMOTE> $1 < @ $2 >
# local user is ok
R<?> $+			$@ RELAY
R<$+> $*		$: $2

######################################################################
### Relay_ok: is the relay/sender ok?
######################################################################
SRelay_ok
# anything originating locally is ok
# check IP address
R$*			$: $&{client_addr}
R$@			$@ RELAY		originated locally
R0			$@ RELAY		originated locally
R127.0.0.1		$@ RELAY		originated locally
RIPv6:::1		$@ RELAY		originated locally
R$=R $*			$@ RELAY		relayable IP address
R$*			$: $>A <$1> <?> <+ Connect> <$1>
R<RELAY> $* 		$@ RELAY		relayable IP address

R<<TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2
R$*			$: [ $1 ]		put brackets around it...
R$=w			$@ RELAY		... and see if it is local


# check client name: first: did it resolve?
R$*			$: < $&{client_resolve} >
R<TEMP>			$#TEMP $@ 4.4.0 $: "450 Relaying temporarily denied. Cannot resolve PTR record for " $&{client_addr}
R<FORGED>		$#error $@ 5.7.1 $: "550 Relaying denied. IP name possibly forged " $&{client_name}
R<FAIL>			$#error $@ 5.7.1 $: "550 Relaying denied. IP name lookup failed " $&{client_name}
R$*			$: <@> $&{client_name}
# pass to name server to make hostname canonical
R<@> $* $=P 		$:<?>  $1 $2
R<@> $+			$:<?>  $[ $1 $]
R$* .			$1			strip trailing dots
R<?> $=w		$@ RELAY
R<?> $* $=R			$@ RELAY
R<?> $*			$: $>D <$1> <?> <+ Connect> <$1>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2


######################################################################
###  F: LookUpFull -- search for an entry in access database
###
###	lookup of full key (which should be an address) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SF
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1+*@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1+*@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  E: LookUpExact -- search for an entry in access database
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SE
R<$*> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  U: LookUpUser -- search for an entry in access database
###
###	lookup of key (which should be a local part) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key (user@)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SU
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1+*@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1+*@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  SearchList: search a list of items in the access map
###	Parameters:
###		<exact tag> $| <mark:address> <mark:address> ... <>
###	where "exact" is either "+" or "!":
###	<+ TAG>	lookup with and w/o tag
###	<! TAG>	lookup with tag
###	possible values for "mark" are:
###		D: recursive host lookup (LookUpDomain)
###		E: exact lookup, no modifications
###		F: full lookup, try user+ext@domain and user@domain
###		U: user lookup, try user+ext and user (input must have trailing @)
###	return: <RHS of lookup> or <?> (not found)
######################################################################

# class with valid marks for SearchList
C{Src}E F D U 
SSearchList
# just call the ruleset with the name of the tag... nice trick...
R<$+> $| <$={Src}:$*> <$*>	$: <$1> $| <$4> $| $>$2 <$3> <?> <$1> <>
R<$+> $| <> $| <?> <>		$@ <?>
R<$+> $| <$+> $| <?> <>		$@ $>SearchList <$1> $| <$2>
R<$+> $| <$*> $| <$+> <>	$@ <$3>
R<$+> $| <$+>			$@ <$2>


######################################################################
###  trust_auth: is user trusted to authenticate as someone else?
###
###	Parameters:
###		$1: AUTH= parameter from MAIL command
######################################################################

SLocal_trust_auth
Strust_auth
R$*			$: $&{auth_type} $| $1
# required by RFC 2554 section 4.
R$@ $| $*		$#error $@ 5.7.1 $: "550 not authenticated"
R$* $| $&{auth_authen}		$@ identical
R$* $| <$&{auth_authen}>	$@ identical
R$* $| $*		$: $1 $| $>"Local_trust_auth" $2
R$* $| $#$*		$#$2
R$*			$#error $@ 5.7.1 $: "550 " $&{auth_authen} " not allowed to act as " $&{auth_author}

######################################################################
###  Relay_Auth: allow relaying based on authentication?
###
###	Parameters:
###		$1: ${auth_type}
######################################################################
SLocal_Relay_Auth

######################################################################
###  srv_features: which features to offer to a client?
###	(done in server)
######################################################################
Ssrv_features
R$*		$: $>D <$&{client_name}> <?> <! "Srv_Features"> <>
R<?>$*		$: $>A <$&{client_addr}> <?> <! "Srv_Features"> <>
R<?>$*		$: <$(access "Srv_Features": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#temp
R<$+>$*		$# $1

######################################################################
###  try_tls: try to use STARTTLS?
###	(done in client)
######################################################################
Stry_tls
R$*		$: $>D <$&{server_name}> <?> <! "Try_TLS"> <>
R<?>$*		$: $>A <$&{server_addr}> <?> <! "Try_TLS"> <>
R<?>$*		$: <$(access "Try_TLS": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<NO>$*		$#error $@ 5.7.1 $: "550 do not try TLS with " $&{server_name} " ["$&{server_addr}"]"

######################################################################
###  tls_rcpt: is connection with server "good" enough?
###	(done in client, per recipient)
###
###	Parameters:
###		$1: recipient
######################################################################
Stls_rcpt
R$*			$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$+			$: <?> $>CanonAddr $1
R<?> $+ < @ $+ . >	<?> $1 <@ $2 >
R<?> $+ < @ $+ >	$: $1 <@ $2 > $| <F:$1@$2> <U:$1@> <D:$2> <E:>
R<?> $+			$: $1 $| <U:$1@> <E:>
R$* $| $+	$: $1 $| $>SearchList <! "TLS_Rcpt"> $| $2 <>
R$* $| <?>	$@ OK
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$* $| <$+>	$@ $>"TLS_connection" $&{verify} $| <$2>

######################################################################
###  tls_client: is connection with client "good" enough?
###	(done in server)
###
###	Parameters:
###		${verify} $| (MAIL|STARTTLS)
######################################################################
Stls_client
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$* $| $*	$: $1 $| $>D <$&{client_name}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{client_addr}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Clt": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  tls_server: is connection with server "good" enough?
###	(done in client)
###
###	Parameter:
###		${verify}
######################################################################
Stls_server
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$*		$: $1 $| $>D <$&{server_name}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Srv": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  TLS_connection: is TLS connection "good" enough?
###
###	Parameters:
###		${verify} $| <Requirement> [<>]
###		Requirement: RHS from access map, may be ? for none.
######################################################################
STLS_connection
R$* $| <$*>$*			$: $1 $| <$2>
# create the appropriate error codes
R$* $| <PERM + $={Tls} $*>	$: $1 $| <503:5.7.0> <$2 $3>
R$* $| <TEMP + $={Tls} $*>	$: $1 $| <403:4.7.0> <$2 $3>
R$* $| <$={Tls} $*>		$: $1 $| <403:4.7.0> <$2 $3>
# deal with TLS handshake failures: abort
RSOFTWARE $| <$-:$+> $* 	$#error $@ $2 $: $1 " TLS handshake failed."
RSOFTWARE $| $* 		$#error $@ 4.7.0 $: "403 TLS handshake failed."
# deal with TLS protocol errors: abort
RPROTOCOL $| <$-:$+> $* 	$#error $@ $2 $: $1 " STARTTLS failed."
RPROTOCOL $| $* 		$#error $@ 4.7.0 $: "403 STARTTLS failed."
R$* $| <$*> <VERIFY>		$: <$2> <VERIFY> <> $1
R$* $| <$*> <VERIFY + $+>	$: <$2> <VERIFY> <$3> $1
R$* $| <$*> <$={Tls}:$->$*	$: <$2> <$3:$4> <> $1
R$* $| <$*> <$={Tls}:$- + $+>$*	$: <$2> <$3:$4> <$5> $1
R$* $| $*			$@ OK
# authentication required: give appropriate error
# other side did authenticate (via STARTTLS)
R<$*><VERIFY> <> OK		$@ OK
R<$*><VERIFY> <$+> OK		$: <$1> <REQ:0> <$2>
R<$*><VERIFY:$-> <$*> OK	$: <$1> <REQ:$2> <$3>
R<$*><ENCR:$-> <$*> $*		$: <$1> <REQ:$2> <$3>
R<$-:$+><VERIFY $*> <$*>	$#error $@ $2 $: $1 " authentication required"
R<$-:$+><VERIFY $*> <$*> FAIL	$#error $@ $2 $: $1 " authentication failed"
R<$-:$+><VERIFY $*> <$*> NO	$#error $@ $2 $: $1 " not authenticated"
R<$-:$+><VERIFY $*> <$*> NOT	$#error $@ $2 $: $1 " no authentication requested"
R<$-:$+><VERIFY $*> <$*> NONE	$#error $@ $2 $: $1 " other side does not support STARTTLS"
R<$-:$+><VERIFY $*> <$*> $+	$#error $@ $2 $: $1 " authentication failure " $4
R<$*><REQ:$-> <$*>		$: <$1> <REQ:$2> <$3> $>max $&{cipher_bits} : $&{auth_ssf}
R<$*><REQ:$-> <$*> $-		$: <$1> <$2:$4> <$3> $(arith l $@ $4 $@ $2 $)
R<$-:$+><$-:$-> <$*> TRUE	$#error $@ $2 $: $1 " encryption too weak " $4 " less than " $3
R<$-:$+><$-:$-> <$*> $*		$: <$1:$2 ++ $5>
R<$-:$+ ++ >			$@ OK
R<$-:$+ ++ $+ >			$: <$1:$2> <$3>
R<$-:$+> < $+ ++ $+ >		<$1:$2> <$3> <$4>
R<$-:$+> $+			$@ $>"TLS_req" $3 $| <$1:$2>

######################################################################
###  TLS_req: check additional TLS requirements
###
###	Parameters: [<list> <of> <req>] $| <$-:$+>
###		$-: SMTP reply code
###		$+: Enhanced Status Code
######################################################################
STLS_req
R $| $+		$@ OK
R<CN> $* $| <$+>		$: <CN:$&{TLS_Name}> $1 $| <$2>
R<CN:$&{cn_subject}> $* $| <$+>		$@ $>"TLS_req" $1 $| <$2>
R<CN:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " CN " $&{cn_subject} " does not match " $1
R<CS:$&{cert_subject}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CS:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Subject " $&{cert_subject} " does not match " $1
R<CI:$&{cert_issuer}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CI:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Issuer " $&{cert_issuer} " does not match " $1
ROK			$@ OK

######################################################################
###  max: return the maximum of two values separated by :
###
###	Parameters: [$-]:[$-]
######################################################################
Smax
R:		$: 0
R:$-		$: $1
R$-:		$: $1
R$-:$-		$: $(arith l $@ $1 $@ $2 $) : $1 : $2
RTRUE:$-:$-	$: $2
R$-:$-:$-	$: $2


######################################################################
###  RelayTLS: allow relaying based on TLS authentication
###
###	Parameters:
###		none
######################################################################
SRelayTLS
# authenticated?
R$*			$: <?> $&{verify}
R<?> OK			$: OK		authenticated: continue
R<?> $*			$@ NO		not authenticated
R$*			$: $&{cert_issuer}
R$+			$: $(access CERTISSUER:$1 $)
RRELAY			$# RELAY
RSUBJECT		$: <@> $&{cert_subject}
R<@> $+			$: <@> $(access CERTSUBJECT:$1 $)
R<@> RELAY		$# RELAY
R$*			$: NO

######################################################################
###  authinfo: lookup authinfo in the access map
###
###	Parameters:
###		$1: {server_name}
###		$2: {server_addr}
######################################################################
Sauthinfo
R$*		$: $1 $| $>D <$&{server_name}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| <$(access AuthInfo: $: ? $)> <>
R$* $| <?>$*	$@ no				no authinfo available
R$* $| <$*> <>	$# $2





#
######################################################################
######################################################################
#####
#####			MAIL FILTER DEFINITIONS
#####
######################################################################
######################################################################

#
######################################################################
######################################################################
#####
#####			sendmail.cf:1666: m4: cannot open `/usr/share/sendmail-cf/mailer/.m4': No such file or directory
 DEFINITIONS
#####
######################################################################
######################################################################

#####################################
###   SMTP Mailer specification   ###
#####################################

#####  $Id: smtp.m4,v 8.64 2001/04/03 01:52:54 gshapiro Exp $  #####

#
#  common sender and masquerading recipient rewriting
#
SMasqSMTP
R$* < @ $* > $*		$@ $1 < @ $2 > $3		already fully qualified
R$+			$@ $1 < @ *LOCAL* >		add local qualification

#
#  convert pseudo-domain addresses to real domain addresses
#
SPseudoToReal

# pass <route-addr>s through
R< @ $+ > $*		$@ < @ $1 > $2			resolve <route-addr>

# output fake domains as user%fake@relay

# do UUCP heuristics; note that these are shared with UUCP mailers
R$+ < @ $+ .UUCP. >	$: < $2 ! > $1			convert to UUCP form
R$+ < @ $* > $*		$@ $1 < @ $2 > $3		not UUCP form

# leave these in .UUCP form to avoid further tampering
R< $&h ! > $- ! $+	$@ $2 < @ $1 .UUCP. >
R< $&h ! > $-.$+ ! $+	$@ $3 < @ $1.$2 >
R< $&h ! > $+		$@ $1 < @ $&h .UUCP. >
R< $+ ! > $+		$: $1 ! $2 < @ $Y >		use UUCP_RELAY
R$+ < @ $~[ $* : $+ >	$@ $1 < @ $4 >			strip mailer: part
R$+ < @ >		$: $1 < @ *LOCAL* >		if no UUCP_RELAY


#
#  envelope sender rewriting
#
SEnvFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$* :; <@>		$@				list:; special case
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqEnv $1			do masquerading


#
#  envelope recipient rewriting --
#  also header recipient if not masquerading recipients
#
SEnvToSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$+			$: $>MasqSMTP $1		qualify unqual'ed names
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  header sender and masquerading header recipient rewriting
#
SHdrFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R:; <@>			$@				list:; special case

# do special header rewriting
R$* <@> $*		$@ $1 <@> $2			pass null host through
R< @ $* > $*		$@ < @ $1 > $2			pass route-addr through
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqHdr $1			do masquerading


#
#  relay mailer header masquerading recipient rewriting
#
SMasqRelay
R$+			$: $>MasqSMTP $1
R$+			$: $>MasqHdr $1

Msmtp,		P=[IPC], F=mDFMuX, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mesmtp,		P=[IPC], F=mDFMuXa, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Msmtp8,		P=[IPC], F=mDFMuX8, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mdsmtp,		P=[IPC], F=mDFMuXa%, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mrelay,		P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h


######################*****##############
###   PROCMAIL Mailer specification   ###
##################*****##################

#####  $Id: procmail.m4,v 8.22 2001/11/12 23:11:34 ca Exp $  #####

Mprocmail,	P=/usr/bin/procmail, F=DFMSPhnu9, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP/HdrFromSMTP,
		T=DNS/RFC822/X-Unix,
		A=procmail -Y -m $h $f $u


##################################################
###   Local and Program Mailer specification   ###
##################################################

#####  $Id: local.m4,v 8.59 2004/11/23 00:37:25 ca Exp $  #####

#
#  Envelope sender rewriting
#
SEnvFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqEnv $1		do masquerading

#
#  Envelope recipient rewriting
#
SEnvToL
R$+ < @ $* >		$: $1			strip host part

#
#  Header sender rewriting
#
SHdrFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqHdr $1		do masquerading

#
#  Header recipient rewriting
#
SHdrToL
R$+			$: $>AddDomain $1	add local domain if needed
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  Common code to add local domain name (only if always-add-domain)
#
SAddDomain
R$* < @ $* > $* 	$@ $1 < @ $2 > $3	already fully qualified

R$+			$@ $1 < @ *LOCAL* >	add local qualification

Mlocal,		P=/usr/bin/procmail, F=lsDFMAw5:/|@qSPfhn9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL,
		T=DNS/RFC822/X-Unix,
		A=procmail -t -Y -a $h -d $u
Mprog,		P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL, D=$z:/,
		T=X-Unix/X-Unix/X-Unix,
		A=smrsh -c $u



#####  $Id: proto.m4,v 8.719 2006/03/30 20:50:13 ca Exp $  #####

# level 10 config file format
V10/Berkeley

# override file safeties - setting this option compromises system security,
# addressing the actual file configuration problem is preferred
# need to set this before any file actions are encountered in the cf file
#O DontBlameSendmail=safe

# default LDAP map specification
# need to set this now before any LDAP maps are defined
#O LDAPDefaultSpec=-h localhost

##################
#   local info   #
##################

# my LDAP cluster
# need to set this before any LDAP lookups are done (including classes)
#D{sendmailMTACluster}$m

Cwlocalhost
# file containing names of hosts for which we receive email
Fw/etc/mail/local-host-names

# my official domain name
# ... define this only if sendmail cannot automatically determine your domain
Djaltnix.com

# host/domain names ending with a token in class P are canonical
CP.

# "Smart" relay host (may be null)
DS


# operators that cannot be in local usernames (i.e., network indicators)
CO @ % !

# a class with just dot (for identifying canonical names)
C..

# a class with just a left bracket (for identifying domain literals)
C[[

# access_db acceptance class
C{Accept}OK RELAY


C{ResOk}OKR


# Hosts for which relaying is permitted ($=R)
FR-o /etc/mail/relay-domains

# arithmetic map
Karith arith
# macro storage map
Kmacro macro
# possible values for TLS_connection in access map
C{Tls}VERIFY ENCR





# dequoting map
Kdequote dequote

# class E: names that should be exposed as from this host, even if we masquerade
# class L: names that should be delivered locally, even if we have a relay
# class M: domains that should be converted to $M
# class N: domains that should not be converted to $M
#CL root
C{E}root
C{w}localhost.localdomain



# my name for error messages
DnMAILER-DAEMON


# Mailer table (overriding domains)
Kmailertable hash -o /etc/mail/mailertable.db

# Virtual user table (maps incoming users)
Kvirtuser hash -o /etc/mail/virtusertable.db

CPREDIRECT

# Access list database (for spam stomping)
Kaccess hash -T<TMPF> -o /etc/mail/access.db

# Configuration version number
DZ8.13.8


###############
#   Options   #
###############

# strip message body to 7 bits on input?
O SevenBitInput=False

# 8-bit data handling
#O EightBitMode=pass8

# wait for alias file rebuild (default units: minutes)
O AliasWait=10

# location of alias file
O AliasFile=/etc/aliases

# minimum number of free blocks on filesystem
O MinFreeBlocks=100

# maximum message size
#O MaxMessageSize=0

# substitution for space (blank) characters
O BlankSub=.

# avoid connecting to "expensive" mailers on initial submission?
O HoldExpensive=False

# checkpoint queue runs after every N successful deliveries
#O CheckpointInterval=10

# default delivery mode
O DeliveryMode=background

# error message header/file
#O ErrorHeader=/etc/mail/error-header

# error mode
#O ErrorMode=print

# save Unix-style "From_" lines at top of header?
#O SaveFromLine=False

# queue file mode (qf files)
#O QueueFileMode=0600

# temporary file mode
O TempFileMode=0600

# match recipients against GECOS field?
#O MatchGECOS=False

# maximum hop count
#O MaxHopCount=25

# location of help file
O HelpFile=/etc/mail/helpfile

# ignore dots as terminators in incoming messages?
#O IgnoreDots=False

# name resolver options
#O ResolverOptions=+AAONLY

# deliver MIME-encapsulated error messages?
O SendMimeErrors=True

# Forward file search path
O ForwardPath=$z/.forward.$w:$z/.forward

# open connection cache size
O ConnectionCacheSize=2

# open connection cache timeout
O ConnectionCacheTimeout=5m

# persistent host status directory
#O HostStatusDirectory=.hoststat

# single thread deliveries (requires HostStatusDirectory)?
#O SingleThreadDelivery=False

# use Errors-To: header?
O UseErrorsTo=False

# log level
O LogLevel=9

# send to me too, even in an alias expansion?
#O MeToo=True

# verify RHS in newaliases?
O CheckAliases=False

# default messages to old style headers if no special punctuation?
O OldStyleHeaders=True

# SMTP daemon options
O DaemonPortOptions=Name=MTA

# SMTP client options
#O ClientPortOptions=Family=inet, Address=0.0.0.0

# Modifiers to define {daemon_flags} for direct submissions
#O DirectSubmissionModifiers

# Use as mail submission program? See sendmail/SECURITY
#O UseMSP

# privacy flags
O PrivacyOptions=authwarnings,novrfy,noexpn,restrictqrun

# who (if anyone) should get extra copies of error messages
#O PostmasterCopy=Postmaster

# slope of queue-only function
#O QueueFactor=600000

# limit on number of concurrent queue runners
#O MaxQueueChildren

# maximum number of queue-runners per queue-grouping with multiple queues
#O MaxRunnersPerQueue=1

# priority of queue runners (nice(3))
#O NiceQueueRun

# shall we sort the queue by hostname first?
#O QueueSortOrder=priority

# minimum time in queue before retry
#O MinQueueAge=30m

# how many jobs can you process in the queue?
#O MaxQueueRunSize=0

# perform initial split of envelope without checking MX records
#O FastSplit=1

# queue directory
O QueueDirectory=/var/spool/mqueue

# key for shared memory; 0 to turn off
#O SharedMemoryKey=0



# timeouts (many of these)
#O Timeout.initial=5m
O Timeout.connect=1m
#O Timeout.aconnect=0s
#O Timeout.iconnect=5m
#O Timeout.helo=5m
#O Timeout.mail=10m
#O Timeout.rcpt=1h
#O Timeout.datainit=5m
#O Timeout.datablock=1h
#O Timeout.datafinal=1h
#O Timeout.rset=5m
#O Timeout.quit=2m
#O Timeout.misc=2m
#O Timeout.command=1h
O Timeout.ident=0
#O Timeout.fileopen=60s
#O Timeout.control=2m
O Timeout.queuereturn=5d
#O Timeout.queuereturn.normal=5d
#O Timeout.queuereturn.urgent=2d
#O Timeout.queuereturn.non-urgent=7d
#O Timeout.queuereturn.dsn=5d
O Timeout.queuewarn=4h
#O Timeout.queuewarn.normal=4h
#O Timeout.queuewarn.urgent=1h
#O Timeout.queuewarn.non-urgent=12h
#O Timeout.queuewarn.dsn=4h
#O Timeout.hoststatus=30m
#O Timeout.resolver.retrans=5s
#O Timeout.resolver.retrans.first=5s
#O Timeout.resolver.retrans.normal=5s
#O Timeout.resolver.retry=4
#O Timeout.resolver.retry.first=4
#O Timeout.resolver.retry.normal=4
#O Timeout.lhlo=2m
#O Timeout.auth=10m
#O Timeout.starttls=1h

# time for DeliverBy; extension disabled if less than 0
#O DeliverByMin=0

# should we not prune routes in route-addr syntax addresses?
#O DontPruneRoutes=False

# queue up everything before forking?
O SuperSafe=True

# status file
O StatusFile=/var/log/mail/statistics

# time zone handling:
#  if undefined, use system default
#  if defined but null, use TZ envariable passed in
#  if defined and non-null, use that info
#O TimeZoneSpec=

# default UID (can be username or userid:groupid)
O DefaultUser=8:12

# list of locations of user database file (null means no lookup)
O UserDatabaseSpec=/etc/mail/userdb.db

# fallback MX host
#O FallbackMXhost=fall.back.host.net

# fallback smart host
#O FallbackSmartHost=fall.back.host.net

# if we are the best MX host for a site, try it directly instead of config err
O TryNullMXList=True

# load average at which we just queue messages
#O QueueLA=8

# load average at which we refuse connections
#O RefuseLA=12

# log interval when refusing connections for this long
#O RejectLogInterval=3h

# load average at which we delay connections; 0 means no limit
#O DelayLA=0

# maximum number of children we allow at one time
#O MaxDaemonChildren=0

# maximum number of new connections per second
#O ConnectionRateThrottle=0

# Width of the window 
#O ConnectionRateWindowSize=60s

# work recipient factor
#O RecipientFactor=30000

# deliver each queued job in a separate process?
#O ForkEachJob=False

# work class factor
#O ClassFactor=1800

# work time factor
#O RetryFactor=90000

# default character set
#O DefaultCharSet=unknown-8bit

# service switch file (name hardwired on Solaris, Ultrix, OSF/1, others)
#O ServiceSwitchFile=/etc/mail/service.switch

# hosts file (normally /etc/hosts)
#O HostsFile=/etc/hosts

# dialup line delay on connection failure
#O DialDelay=0s

# action to take if there are no recipients in the message
#O NoRecipientAction=none

# chrooted environment for writing to files
#O SafeFileEnvironment

# are colons OK in addresses?
#O ColonOkInAddr=True

# shall I avoid expanding CNAMEs (violates protocols)?
#O DontExpandCnames=False

# SMTP initial login message (old $e macro)
O SmtpGreetingMessage=$j Sendmail $v/$Z; $b

# UNIX initial From header format (old $l macro)
O UnixFromLine=From $g $d

# From: lines that have embedded newlines are unwrapped onto one line
#O SingleLineFromHeader=False

# Allow HELO SMTP command that does not include a host name
#O AllowBogusHELO=False

# Characters to be quoted in a full name phrase (@,;:\()[] are automatic)
#O MustQuoteChars=.

# delimiter (operator) characters (old $o macro)
O OperatorChars=.:%@!^/[]+

# shall I avoid calling initgroups(3) because of high NIS costs?
#O DontInitGroups=False

# are group-writable :include: and .forward files (un)trustworthy?
# True (the default) means they are not trustworthy.
#O UnsafeGroupWrites=True


# where do errors that occur when sending errors get sent?
#O DoubleBounceAddress=postmaster

# where to save bounces if all else fails
#O DeadLetterDrop=/var/tmp/dead.letter

# what user id do we assume for the majority of the processing?
#O RunAsUser=sendmail

# maximum number of recipients per SMTP envelope
#O MaxRecipientsPerMessage=0

# limit the rate recipients per SMTP envelope are accepted
# once the threshold number of recipients have been rejected
#O BadRcptThrottle=0

# shall we get local names from our installed interfaces?
O DontProbeInterfaces=True

# Return-Receipt-To: header implies DSN request
#O RrtImpliesDsn=False

# override connection address (for testing)
#O ConnectOnlyTo=0.0.0.0

# Trusted user for file ownership and starting the daemon
#O TrustedUser=root

# Control socket for daemon management
#O ControlSocketName=/var/spool/mqueue/.control

# Maximum MIME header length to protect MUAs
#O MaxMimeHeaderLength=0/0

# Maximum length of the sum of all headers
#O MaxHeadersLength=32768

# Maximum depth of alias recursion
#O MaxAliasRecursion=10

# location of pid file
#O PidFile=/var/run/sendmail.pid

# Prefix string for the process title shown on 'ps' listings
#O ProcessTitlePrefix=prefix

# Data file (df) memory-buffer file maximum size
#O DataFileBufferSize=4096

# Transcript file (xf) memory-buffer file maximum size
#O XscriptFileBufferSize=4096

# lookup type to find information about local mailboxes
#O MailboxDatabase=pw

# override compile time flag REQUIRES_DIR_FSYNC
#O RequiresDirfsync=true

# list of authentication mechanisms
#O AuthMechanisms=EXTERNAL GSSAPI KERBEROS_V4 DIGEST-MD5 CRAM-MD5

# Authentication realm
#O AuthRealm

# default authentication information for outgoing connections
#O DefaultAuthInfo=/etc/mail/default-auth-info

# SMTP AUTH flags
O AuthOptions=A

# SMTP AUTH maximum encryption strength
#O AuthMaxBits

# SMTP STARTTLS server options
#O TLSSrvOptions

# Input mail filters
#O InputMailFilters


# CA directory
#O CACertPath
# CA file
#O CACertFile
# Server Cert
#O ServerCertFile
# Server private key
#O ServerKeyFile
# Client Cert
#O ClientCertFile
# Client private key
#O ClientKeyFile
# File containing certificate revocation lists 
#O CRLFile
# DHParameters (only required if DSA/DH is used)
#O DHParameters
# Random data source (required for systems without /dev/urandom under OpenSSL)
#O RandFile

############################
# QUEUE GROUP DEFINITIONS  #
############################


###########################
#   Message precedences   #
###########################

Pfirst-class=0
Pspecial-delivery=100
Plist=-30
Pbulk=-60
Pjunk=-100

#####################
#   Trusted users   #
#####################

# this is equivalent to setting class "t"
Ft/etc/mail/trusted-users
Troot
Tdaemon
Tuucp

#########################
#   Format of headers   #
#########################

H?P?Return-Path: <$g>
HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
	$.$?{auth_type}(authenticated$?{auth_ssf} bits=${auth_ssf}$.)
	$.by $j ($v/$Z)$?r with $r$. id $i$?{tls_version}
	(version=${tls_version} cipher=${cipher} bits=${cipher_bits} verify=${verify})$.$?u
	for $u; $|;
	$.$b
H?D?Resent-Date: $a
H?D?Date: $a
H?F?Resent-From: $?x$x <$g>$|$g$.
H?F?From: $?x$x <$g>$|$g$.
H?x?Full-Name: $x
# HPosted-Date: $a
# H?l?Received-Date: $b
H?M?Resent-Message-Id: <$t.$i@$j>
H?M?Message-Id: <$t.$i@$j>

#
######################################################################
######################################################################
#####
#####			REWRITING RULES
#####
######################################################################
######################################################################

############################################
###  Ruleset 3 -- Name Canonicalization  ###
############################################
Scanonify=3

# handle null input (translate to <@> special case)
R$@			$@ <@>

# strip group: syntax (not inside angle brackets!) and trailing semicolon
R$*			$: $1 <@>			mark addresses
R$* < $* > $* <@>	$: $1 < $2 > $3			unmark <addr>
R@ $* <@>		$: @ $1				unmark @host:...
R$* [ IPv6 : $+ ] <@>	$: $1 [ IPv6 : $2 ]		unmark IPv6 addr
R$* :: $* <@>		$: $1 :: $2			unmark node::addr
R:include: $* <@>	$: :include: $1			unmark :include:...
R$* : $* [ $* ]		$: $1 : $2 [ $3 ] <@>		remark if leading colon
R$* : $* <@>		$: $2				strip colon if marked
R$* <@>			$: $1				unmark
R$* ;			   $1				strip trailing semi
R$* < $+ :; > $*	$@ $2 :; <@>			catch <list:;>
R$* < $* ; >		   $1 < $2 >			bogus bracketed semi

# null input now results from list:; syntax
R$@			$@ :; <@>

# strip angle brackets -- note RFC733 heuristic to get innermost item
R$*			$: < $1 >			housekeeping <>
R$+ < $* >		   < $2 >			strip excess on left
R< $* > $+		   < $1 >			strip excess on right
R<>			$@ < @ >			MAIL FROM:<> case
R< $+ >			$: $1				remove housekeeping <>

# strip route address <@a,@b,@c:user@d> -> <user@d>
R@ $+ , $+		$2
R@ [ $* ] : $+		$2
R@ $+ : $+		$2

# find focus for list syntax
R $+ : $* ; @ $+	$@ $>Canonify2 $1 : $2 ; < @ $3 >	list syntax
R $+ : $* ;		$@ $1 : $2;			list syntax

# find focus for @ syntax addresses
R$+ @ $+		$: $1 < @ $2 >			focus on domain
R$+ < $+ @ $+ >		$1 $2 < @ $3 >			move gaze right
R$+ < @ $+ >		$@ $>Canonify2 $1 < @ $2 >	already canonical


# convert old-style addresses to a domain-based address
R$- ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	resolve uucp names
R$+ . $- ! $+		$@ $>Canonify2 $3 < @ $1 . $2 >		domain uucps
R$+ ! $+		$@ $>Canonify2 $2 < @ $1 .UUCP >	uucp subdomains

# if we have % signs, take the rightmost one
R$* % $*		$1 @ $2				First make them all @s.
R$* @ $* @ $*		$1 % $2 @ $3			Undo all but the last.
R$* @ $*		$@ $>Canonify2 $1 < @ $2 >	Insert < > and finish

# else we must be a local name
R$*			$@ $>Canonify2 $1


################################################
###  Ruleset 96 -- bottom half of ruleset 3  ###
################################################

SCanonify2=96

# handle special cases for local names
R$* < @ localhost > $*		$: $1 < @ $j . > $2		no domain at all
R$* < @ localhost . $m > $*	$: $1 < @ $j . > $2		local domain
R$* < @ localhost . UUCP > $*	$: $1 < @ $j . > $2		.UUCP domain

# check for IPv4/IPv6 domain literal
R$* < @ [ $+ ] > $*		$: $1 < @@ [ $2 ] > $3		mark [addr]
R$* < @@ $=w > $*		$: $1 < @ $j . > $3		self-literal
R$* < @@ $+ > $*		$@ $1 < @ $2 > $3		canon IP addr





# if really UUCP, handle it immediately

# try UUCP traffic as a local address
R$* < @ $+ . UUCP > $*		$: $1 < @ $[ $2 $] . UUCP . > $3
R$* < @ $+ . . UUCP . > $*	$@ $1 < @ $2 . > $3

# hostnames ending in class P are always canonical
R$* < @ $* $=P > $*		$: $1 < @ $2 $3 . > $4
R$* < @ $* $~P > $*		$: $&{daemon_flags} $| $1 < @ $2 $3 > $4
R$* CC $* $| $* < @ $+.$+ > $*	$: $3 < @ $4.$5 . > $6
R$* CC $* $| $*			$: $3
# pass to name server to make hostname canonical
R$* $| $* < @ $* > $*		$: $2 < @ $[ $3 $] > $4
R$* $| $*			$: $2

# local host aliases and pseudo-domains are always canonical
R$* < @ $=w > $*		$: $1 < @ $2 . > $3
R$* < @ $=M > $*		$: $1 < @ $2 . > $3
R$* < @ $={VirtHost} > $* 	$: $1 < @ $2 . > $3
R$* < @ $* . . > $*		$1 < @ $2 . > $3


##################################################
###  Ruleset 4 -- Final Output Post-rewriting  ###
##################################################
Sfinal=4

R$+ :; <@>		$@ $1 :				handle <list:;>
R$* <@>			$@				handle <> and list:;

# strip trailing dot off possibly canonical name
R$* < @ $+ . > $*	$1 < @ $2 > $3

# eliminate internal code
R$* < @ *LOCAL* > $*	$1 < @ $j > $2

# externalize local domain info
R$* < $+ > $*		$1 $2 $3			defocus
R@ $+ : @ $+ : $+	@ $1 , @ $2 : $3		<route-addr> canonical
R@ $*			$@ @ $1				... and exit

# UUCP must always be presented in old form
R$+ @ $- . UUCP		$2!$1				u@h.UUCP => h!u

# delete duplicate local names
R$+ % $=w @ $=w		$1 @ $2				u%host@host => u@host



##############################################################
###   Ruleset 97 -- recanonicalize and call ruleset zero   ###
###		   (used for recursive calls)		   ###
##############################################################

SRecurse=97
R$*			$: $>canonify $1
R$*			$@ $>parse $1


######################################
###   Ruleset 0 -- Parse Address   ###
######################################

Sparse=0

R$*			$: $>Parse0 $1		initial parsing
R<@>			$#local $: <@>		special case error msgs
R$*			$: $>ParseLocal $1	handle local hacks
R$*			$: $>Parse1 $1		final parsing

#
#  Parse0 -- do initial syntax checking and eliminate local addresses.
#	This should either return with the (possibly modified) input
#	or return with a #error mailer.  It should not return with a
#	#mailer other than the #error mailer.
#

SParse0
R<@>			$@ <@>			special case error msgs
R$* : $* ; <@>		$#error $@ 5.1.3 $: "553 List:; syntax illegal for recipient addresses"
R@ <@ $* >		< @ $1 >		catch "@@host" bogosity
R<@ $+>			$#error $@ 5.1.3 $: "553 User address required"
R$+ <@>			$#error $@ 5.1.3 $: "553 Hostname required"
R$*			$: <> $1
R<> $* < @ [ $* ] : $+ > $*	$1 < @ [ $2 ] : $3 > $4
R<> $* < @ [ $* ] , $+ > $*	$1 < @ [ $2 ] , $3 > $4
R<> $* < @ [ $* ] $+ > $*	$#error $@ 5.1.2 $: "553 Invalid address"
R<> $* < @ [ $+ ] > $*		$1 < @ [ $2 ] > $3
R<> $* <$* : $* > $*	$#error $@ 5.1.3 $: "553 Colon illegal in host name part"
R<> $*			$1
R$* < @ . $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* .. $* > $*	$#error $@ 5.1.2 $: "553 Invalid host name"
R$* < @ $* @ > $*	$#error $@ 5.1.2 $: "553 Invalid route address"
R$* @ $* < @ $* > $*	$#error $@ 5.1.3 $: "553 Invalid route address"
R$* , $~O $*		$#error $@ 5.1.3 $: "553 Invalid route address"


# now delete the local info -- note $=O to find characters that cause forwarding
R$* < @ > $*		$@ $>Parse0 $>canonify $1	user@ => user
R< @ $=w . > : $*	$@ $>Parse0 $>canonify $2	@here:... -> ...
R$- < @ $=w . >		$: $(dequote $1 $) < @ $2 . >	dequote "foo"@here
R< @ $+ >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ $=w . >	$@ $>Parse0 $>canonify $1 $2 $3	...@here -> ...
R$- 			$: $(dequote $1 $) < @ *LOCAL* >	dequote "foo"
R< @ *LOCAL* >		$#error $@ 5.1.3 $: "553 User address required"
R$* $=O $* < @ *LOCAL* >
			$@ $>Parse0 $>canonify $1 $2 $3	...@*LOCAL* -> ...
R$* < @ *LOCAL* >	$: $1

#
#  Parse1 -- the bottom half of ruleset 0.
#

SParse1

# handle numeric address spec
R$* < @ [ $+ ] > $*	$: $>ParseLocal $1 < @ [ $2 ] > $3	numeric internet spec
R$* < @ [ $+ ] > $*	$: $1 < @ [ $2 ] : $S > $3	Add smart host to path
R$* < @ [ $+ ] : > $*		$#esmtp $@ [$2] $: $1 < @ [$2] > $3	no smarthost: send
R$* < @ [ $+ ] : $- : $*> $*	$#$3 $@ $4 $: $1 < @ [$2] > $5	smarthost with mailer
R$* < @ [ $+ ] : $+ > $*	$#esmtp $@ $3 $: $1 < @ [$2] > $4	smarthost without mailer

# handle virtual users
R$+			$: <!> $1		Mark for lookup
R<!> $+ < @ $={VirtHost} . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<!> $+ < @ $=w . > 	$: < $(virtuser $1 @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+ + $+ < @ $* . >
			$: < $(virtuser $1 + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $* . >
			$: < $(virtuser $1 @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $+ < @ $+ . >	$: < $(virtuser + + @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser + * @ $3 $@ $1 $@ $2 $@ +$2 $: @ $) > $1 + $2 < @ $3 . >
R<@> $+ + $* < @ $+ . >	$: < $(virtuser @ $3 $@ $1 $@ $2 $@ +$2 $: ! $) > $1 + $2 < @ $3 . >
R<@> $+ < @ $+ . >	$: < $(virtuser @ $2 $@ $1 $: @ $) > $1 < @ $2 . >
R<@> $+			$: $1
R<!> $+			$: $1
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- $+ > $* 	$#error $@ $(dequote $1 $) $: $2
R< $+ > $+ < @ $+ >	$: $>Recurse $1

# short circuit local delivery so forwarded email works


R$=L < @ $=w . >	$#local $: @ $1			special local names
R$+ < @ $=w . >		$#local $: $1			regular local name

# not local -- try mailer table lookup
R$* <@ $+ > $*		$: < $2 > $1 < @ $2 > $3	extract host name
R< $+ . > $*		$: < $1 > $2			strip trailing dot
R< $+ > $*		$: < $(mailertable $1 $) > $2	lookup
R< $~[ : $* > $* 	$>MailerToTriple < $1 : $2 > $3		check -- resolved?
R< $+ > $*		$: $>Mailertable <$1> $2		try domain

# resolve remotely connected UUCP links (if any)

# resolve fake top level domains by forwarding to other hosts



# pass names that still have a host to a smarthost (if defined)
R$* < @ $* > $*		$: $>MailerToTriple < $S > $1 < @ $2 > $3	glue on smarthost name

# deal with other remote names
R$* < @$* > $*		$#esmtp $@ $2 $: $1 < @ $2 > $3	user@host.domain

# handle locally delivered names
R$=L			$#local $: @ $1		special local names
R$+			$#local $: $1			regular local names

###########################################################################
###   Ruleset 5 -- special rewriting after aliases have been expanded   ###
###########################################################################

SLocal_localaddr
Slocaladdr=5
R$+			$: $1 $| $>"Local_localaddr" $1
R$+ $| $#ok		$@ $1			no change
R$+ $| $#$*		$#$2
R$+ $| $*		$: $1




# deal with plussed users so aliases work nicely
R$+ + *			$#local $@ $&h $: $1
R$+ + $*		$#local $@ + $2 $: $1 + *

# prepend an empty "forward host" on the front
R$+			$: <> $1



R< > $+			$: < > < $1 <> $&h >		nope, restore +detail

R< > < $+ <> + $* >	$: < > < $1 + $2 >		check whether +detail
R< > < $+ <> $* >	$: < > < $1 >			else discard
R< > < $+ + $* > $*	   < > < $1 > + $2 $3		find the user part
R< > < $+ > + $*	$#local $@ $2 $: @ $1		strip the extra +
R< > < $+ >		$@ $1				no +detail
R$+			$: $1 <> $&h			add +detail back in

R$+ <> + $*		$: $1 + $2			check whether +detail
R$+ <> $*		$: $1				else discard
R< local : $* > $*	$: $>MailerToTriple < local : $1 > $2	no host extension
R< error : $* > $*	$: $>MailerToTriple < error : $1 > $2	no host extension

R< $~[ : $+ > $+	$: $>MailerToTriple < $1 : $2 > $3 < @ $2 >

R< $+ > $+		$@ $>MailerToTriple < $1 > $2 < @ $1 >


###################################################################
###  Ruleset 90 -- try domain part of mailertable entry 	###
###################################################################

SMailertable=90
R$* <$- . $+ > $*	$: $1$2 < $(mailertable .$3 $@ $1$2 $@ $2 $) > $4
R$* <$~[ : $* > $*	$>MailerToTriple < $2 : $3 > $4		check -- resolved?
R$* < . $+ > $* 	$@ $>Mailertable $1 . <$2> $3		no -- strip & try again
R$* < $* > $*		$: < $(mailertable . $@ $1$2 $) > $3	try "."
R< $~[ : $* > $*	$>MailerToTriple < $1 : $2 > $3		"." found?
R< $* > $*		$@ $2				no mailertable match

###################################################################
###  Ruleset 95 -- canonify mailer:[user@]host syntax to triple	###
###################################################################

SMailerToTriple=95
R< > $*				$@ $1			strip off null relay
R< error : $-.$-.$- : $+ > $* 	$#error $@ $1.$2.$3 $: $4
R< error : $- : $+ > $*		$#error $@ $(dequote $1 $) $: $2
R< error : $+ > $*		$#error $: $1
R< local : $* > $*		$>CanonLocal < $1 > $2
R< $~[ : $+ @ $+ > $*<$*>$*	$# $1 $@ $3 $: $2<@$3>	use literal user
R< $~[ : $+ > $*		$# $1 $@ $2 $: $3	try qualified mailer
R< $=w > $*			$@ $2			delete local host
R< $+ > $*			$#relay $@ $1 $: $2	use unqualified mailer

###################################################################
###  Ruleset CanonLocal -- canonify local: syntax		###
###################################################################

SCanonLocal
# strip local host from routed addresses
R< $* > < @ $+ > : $+		$@ $>Recurse $3
R< $* > $+ $=O $+ < @ $+ >	$@ $>Recurse $2 $3 $4

# strip trailing dot from any host name that may appear
R< $* > $* < @ $* . >		$: < $1 > $2 < @ $3 >

# handle local: syntax -- use old user, either with or without host
R< > $* < @ $* > $*		$#local $@ $1@$2 $: $1
R< > $+				$#local $@ $1    $: $1

# handle local:user@host syntax -- ignore host part
R< $+ @ $+ > $* < @ $* >	$: < $1 > $3 < @ $4 >

# handle local:user syntax
R< $+ > $* <@ $* > $*		$#local $@ $2@$3 $: $1
R< $+ > $* 			$#local $@ $2    $: $1

###################################################################
###  Ruleset 93 -- convert header names to masqueraded form	###
###################################################################

SMasqHdr=93


# do not masquerade anything in class N
R$* < @ $* $=N . >	$@ $1 < @ $2 $3 . >

R$* < @ *LOCAL* >	$@ $1 < @ $j . >

###################################################################
###  Ruleset 94 -- convert envelope names to masqueraded form	###
###################################################################

SMasqEnv=94
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

###################################################################
###  Ruleset 98 -- local part of ruleset zero (can be null)	###
###################################################################

SParseLocal=98

# addresses sent to foo@host.REDIRECT will give a 551 error code
R$* < @ $+ .REDIRECT. >		$: $1 < @ $2 . REDIRECT . > < ${opMode} >
R$* < @ $+ .REDIRECT. > <i>	$: $1 < @ $2 . REDIRECT. >
R$* < @ $+ .REDIRECT. > < $- >	$#error $@ 5.1.1 $: "551 User has moved; please try " <$1@$2>




######################################################################
###  D: LookUpDomain -- search for domain in access database
###
###	Parameters:
###		<$1> -- key (domain name)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SD
R<$*> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <[$+.$-]> <$+> <$- $-> <$*>	$@ $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+::$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <[$+:$-]> <$+> <$- $-> <$*>	$: $>D <[$1]> <$3> <$4 $5> <$6>
R<?> <$+.$+> <$+> <$- $-> <$*>	$@ $>D <$2> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  A: LookUpAddress -- search for host address in access database
###
###	Parameters:
###		<$1> -- key (dot quadded host address)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed through)
######################################################################

SA
R<$+> <$+> <$- $-> <$*>		$: < $(access $4:$1 $: ? $) > <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$+> <+ $-> <$*>	$: < $(access $1 $: ? $) > <$1> <$2> <+ $3> <$4>
R<?> <$+::$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+:$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+.$-> <$+> <$- $-> <$*>		$@ $>A <$1> <$3> <$4 $5> <$6>
R<?> <$+> <$+> <$- $-> <$*>	$@ <$2> <$5>
R<$* <TMPF>> <$+> <$+> <$- $-> <$*>	$@ <<TMPF>> <$6>
R<$*> <$+> <$+> <$- $-> <$*>	$@ <$1> <$6>

######################################################################
###  CanonAddr --	Convert an address into a standard form for
###			relay checking.  Route address syntax is
###			crudely converted into a %-hack address.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed address, not in source route form
######################################################################

SCanonAddr
R$*			$: $>Parse0 $>canonify $1	make domain canonical


######################################################################
###  ParseRecipient --	Strip off hosts in $=R as well as possibly
###			$* $=m or the access database.
###			Check user portion for host separators.
###
###	Parameters:
###		$1 -- full recipient address
###
###	Returns:
###		parsed, non-local-relaying address
######################################################################

SParseRecipient
R$*				$: <?> $>CanonAddr $1
R<?> $* < @ $* . >		<?> $1 < @ $2 >			strip trailing dots
R<?> $- < @ $* >		$: <?> $(dequote $1 $) < @ $2 >	dequote local part

# if no $=O character, no host in the user portion, we are done
R<?> $* $=O $* < @ $* >		$: <NO> $1 $2 $3 < @ $4>
R<?> $*				$@ $1


R<NO> $* < @ $* $=R >		$: <RELAY> $1 < @ $2 $3 >
R<NO> $* < @ $+ >		$: $>D <$2> <NO> <+ To> <$1 < @ $2 >>
R<$+> <$+>			$: <$1> $2



R<RELAY> $* < @ $* >		$@ $>ParseRecipient $1
R<$+> $*			$@ $2


######################################################################
###  check_relay -- check hostname/address on SMTP startup
######################################################################



SLocal_check_relay
Scheck_relay
R$*			$: $1 $| $>"Local_check_relay" $1
R$* $| $* $| $#$*	$#$3
R$* $| $* $| $*		$@ $>"Basic_check_relay" $1 $| $2

SBasic_check_relay
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

R$+ $| $+		$: $>D < $1 > <?> <+ Connect> < $2 >
R   $| $+		$: $>A < $1 > <?> <+ Connect> <>	empty client_name
R<?> <$+>		$: $>A < $1 > <?> <+ Connect> <>	no: another lookup
R<?> <$*>		$: OK				found nothing
R<$={Accept}> <$*>	$@ $1				return value of lookup
R<REJECT> <$*>		$#error $@ 5.7.1 $: "550 Access denied"
R<DISCARD> <$*>		$#discard $: discard
R<QUARANTINE:$+> <$*>	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> <$*>	$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> <$*>		$#error $: $1
R<$* <TMPF>> <$*>		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> <$*>		$#error $: $1



######################################################################
###  check_mail -- check SMTP `MAIL FROM:' command argument
######################################################################

SLocal_check_mail
Scheck_mail
R$*			$: $1 $| $>"Local_check_mail" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_mail" $1

SBasic_check_mail
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2

# authenticated?
R$*			$: $1 $| $>"tls_client" $&{verify} $| MAIL
R$* $| $#$+		$#$2
R$* $| $*		$: $1

R<>			$@ <OK>			we MUST accept <> (RFC 1123)
R$+			$: <?> $1
R<?><$+>		$: <@> <$1>
R<?>$+			$: <@> <$1>
R$*			$: $&{daemon_flags} $| $1
R$* f $* $| <@> < $* @ $- >	$: < ? $&{client_name} > < $3 @ $4 >
R$* u $* $| <@> < $* >	$: <?> < $3 >
R$* $| $*		$: $2
# handle case of @localhost on address
R<@> < $* @ localhost >	$: < ? $&{client_name} > < $1 @ localhost >
R<@> < $* @ [127.0.0.1] >
			$: < ? $&{client_name} > < $1 @ [127.0.0.1] >
R<@> < $* @ localhost.$m >
			$: < ? $&{client_name} > < $1 @ localhost.$m >
R<@> < $* @ localhost.localdomain >
			$: < ? $&{client_name} > < $1 @ localhost.localdomain >
R<@> < $* @ localhost.UUCP >
			$: < ? $&{client_name} > < $1 @ localhost.UUCP >
R<@> $*			$: $1			no localhost as domain
R<? $=w> $*		$: $2			local client: ok
R<? $+> <$+>		$#error $@ 5.5.4 $: "553 Real domain name required for sender address"
R<?> $*			$: $1
R$*			$: <?> $>CanonAddr $1		canonify sender address and mark it
R<?> $* < @ $+ . >	<?> $1 < @ $2 >			strip trailing dots
# handle non-DNS hostnames (*.bitnet, *.decnet, *.uucp, etc)
R<?> $* < @ $* $=P >	$: <OKR> $1 < @ $2 $3 >
R<?> $* < @ $j >	$: <OKR> $1 < @ $j >
R<?> $* < @ $+ >	$: <OKR> $1 < @ $2 >		... unresolvable OK

# check sender address: user@address, user@, address
R<$+> $+ < @ $* >	$: @<$1> <$2 < @ $3 >> $| <F:$2@$3> <U:$2@> <D:$3>
R<$+> $+		$: @<$1> <$2> $| <U:$2@>
R@ <$+> <$*> $| <$+>	$: <@> <$1> <$2> $| $>SearchList <+ From> $| <$3> <>
R<@> <$+> <$*> $| <$*>	$: <$3> <$1> <$2>		reverse result
# retransform for further use
R<?> <$+> <$*>		$: <$1> $2	no match
R<$+> <$+> <$*>		$: <$1> $3	relevant result, keep it

# handle case of no @domain on address
R<?> $*			$: $&{daemon_flags} $| <?> $1
R$* u $* $| <?> $*	$: <OKR> $3
R$* $| $*		$: $2
R<?> $*			$: < ? $&{client_addr} > $1
R<?> $*			$@ <OKR>			...local unqualed ok
R<? $+> $*		$#error $@ 5.5.4 $: "553 Domain name required for sender address " $&f
							...remote is not
# check results
R<?> $*			$: @ $1		mark address: nothing known about it
R<$={ResOk}> $*		$@ <OKR>	domain ok: stop
R<TEMP> $*		$#error $@ 4.1.8 $: "451 Domain of sender address " $&f " does not resolve"
R<PERM> $*		$#error $@ 5.1.8 $: "553 Domain of sender address " $&f " does not exist"
R<$={Accept}> $*	$# $1		accept from access map
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<REJECT> $*		$#error $@ 5.7.1 $: "550 Access denied"
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db

######################################################################
###  check_rcpt -- check SMTP `RCPT TO:' command argument
######################################################################

SLocal_check_rcpt
Scheck_rcpt
R$*			$: $1 $| $>"Local_check_rcpt" $1
R$* $| $#$*		$#$2
R$* $| $*		$@ $>"Basic_check_rcpt" $1

SBasic_check_rcpt
# empty address?
R<>			$#error $@ nouser $: "553 User address required"
R$@			$#error $@ nouser $: "553 User address required"
# check for deferred delivery mode
R$*			$: < $&{deliveryMode} > $1
R< d > $*		$@ deferred
R< $* > $*		$: $2


######################################################################
R$*			$: $1 $| @ $>"Rcpt_ok" $1
R$* $| @ $#TEMP $+	$: $1 $| T $2
R$* $| @ $#$*		$#$2
R$* $| @ RELAY		$@ RELAY
R$* $| @ $*		$: O $| $>"Relay_ok" $1
R$* $| T $+		$: T $2 $| $>"Relay_ok" $1
R$* $| $#TEMP $+	$#error $2
R$* $| $#$*		$#$2
R$* $| RELAY		$@ RELAY
R T $+ $| $*		$#error $1
# anything else is bogus
R$*			$#error $@ 5.7.1 $: "550 Relaying denied"


######################################################################
### Rcpt_ok: is the recipient ok?
######################################################################
SRcpt_ok
R$*			$: $>ParseRecipient $1		strip relayable hosts



# blacklist local users or any host from receiving mail
R$*			$: <?> $1
R<?> $+ < @ $=w >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <U:$1@> <D:$2>
R<?> $+ < @ $* >	$: <> <$1 < @ $2 >> $| <F:$1@$2> <D:$2>
R<?> $+			$: <> <$1> $| <U:$1@>
R<> <$*> $| <$+>	$: <@> <$1> $| $>SearchList <+ To> $| <$2> <>
R<@> <$*> $| <$*>	$: <$2> <$1>		reverse result
R<?> <$*>		$: @ $1		mark address as no match
R<$={Accept}> <$*>	$: @ $2		mark address as no match

R<REJECT> $*		$#error $@ 5.2.1 $: "550 Mailbox disabled for this recipient"
R<DISCARD> $*		$#discard $: discard
R<QUARANTINE:$+> $*	$#error $@ quarantine $: $1
R<ERROR:$-.$-.$-:$+> $*		$#error $@ $1.$2.$3 $: $4
R<ERROR:$+> $*		$#error $: $1
R<<TMPF>> $*		$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$+> $*		$#error $: $1		error from access db
R@ $*			$1		remove mark

# authenticated via TLS?
R$*			$: $1 $| $>RelayTLS	client authenticated?
R$* $| $# $+		$# $2			error/ok?
R$* $| $*		$: $1			no

R$*			$: $1 $| $>"Local_Relay_Auth" $&{auth_type}
R$* $| $# $*		$# $2
R$* $| NO		$: $1
R$* $| $*		$: $1 $| $&{auth_type}
R$* $|			$: $1
R$* $| $={TrustAuthMech}	$# RELAY
R$* $| $*		$: $1
# anything terminating locally is ok
R$+ < @ $=w >		$@ RELAY
R$+ < @ $* $=R >	$@ RELAY
R$+ < @ $+ >		$: $>D <$2> <?> <+ To> <$1 < @ $2 >>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2



# check for local user (i.e. unqualified address)
R$*			$: <?> $1
R<?> $* < @ $+ >	$: <REMOTE> $1 < @ $2 >
# local user is ok
R<?> $+			$@ RELAY
R<$+> $*		$: $2

######################################################################
### Relay_ok: is the relay/sender ok?
######################################################################
SRelay_ok
# anything originating locally is ok
# check IP address
R$*			$: $&{client_addr}
R$@			$@ RELAY		originated locally
R0			$@ RELAY		originated locally
R127.0.0.1		$@ RELAY		originated locally
RIPv6:::1		$@ RELAY		originated locally
R$=R $*			$@ RELAY		relayable IP address
R$*			$: $>A <$1> <?> <+ Connect> <$1>
R<RELAY> $* 		$@ RELAY		relayable IP address

R<<TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2
R$*			$: [ $1 ]		put brackets around it...
R$=w			$@ RELAY		... and see if it is local


# check client name: first: did it resolve?
R$*			$: < $&{client_resolve} >
R<TEMP>			$#TEMP $@ 4.4.0 $: "450 Relaying temporarily denied. Cannot resolve PTR record for " $&{client_addr}
R<FORGED>		$#error $@ 5.7.1 $: "550 Relaying denied. IP name possibly forged " $&{client_name}
R<FAIL>			$#error $@ 5.7.1 $: "550 Relaying denied. IP name lookup failed " $&{client_name}
R$*			$: <@> $&{client_name}
# pass to name server to make hostname canonical
R<@> $* $=P 		$:<?>  $1 $2
R<@> $+			$:<?>  $[ $1 $]
R$* .			$1			strip trailing dots
R<?> $=w		$@ RELAY
R<?> $* $=R			$@ RELAY
R<?> $*			$: $>D <$1> <?> <+ Connect> <$1>
R<RELAY> $*		$@ RELAY
R<$* <TMPF>> $*		$#TEMP $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<$*> <$*>		$: $2


######################################################################
###  F: LookUpFull -- search for an entry in access database
###
###	lookup of full key (which should be an address) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SF
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1+*@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1+*@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+ + $* @ $+> <$*> <$- $-> <$*>
			$: <$(access $6:$1@$3 $: ? $)> <$1+$2@$3> <$4> <$5 $6> <$7>
R<?> <$+ + $* @ $+> <$*> <+ $-> <$*>
			$: <$(access $1@$3 $: ? $)> <$1+$2@$3> <$4> <+ $5> <$6>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  E: LookUpExact -- search for an entry in access database
###
###	Parameters:
###		<$1> -- key
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SE
R<$*> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  U: LookUpUser -- search for an entry in access database
###
###	lookup of key (which should be a local part) and
###	variations if +detail exists: +* and without +detail
###
###	Parameters:
###		<$1> -- key (user@)
###		<$2> -- default (what to return if not found in db)
###		<$3> -- mark (must be <(!|+) single-token>)
###			! does lookup only with tag
###			+ does lookup with and without tag
###		<$4> -- passthru (additional data passed unchanged through)
######################################################################

SU
R<$+> <$*> <$- $-> <$*>		$: <$(access $4:$1 $: ? $)> <$1> <$2> <$3 $4> <$5>
R<?> <$+> <$*> <+ $-> <$*>	$: <$(access $1 $: ? $)> <$1> <$2> <+ $3> <$4>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1+*@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1+*@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+ + $* @> <$*> <$- $-> <$*>
			$: <$(access $5:$1@ $: ? $)> <$1+$2@> <$3> <$4 $5> <$6>
R<?> <$+ + $* @> <$*> <+ $-> <$*>
			$: <$(access $1@ $: ? $)> <$1+$2@> <$3> <+ $4> <$5>
R<?> <$+> <$*> <$- $-> <$*>	$@ <$2> <$5>
R<$+ <TMPF>> <$*> <$- $-> <$*>	$@ <<TMPF>> <$5>
R<$+> <$*> <$- $-> <$*>		$@ <$1> <$5>

######################################################################
###  SearchList: search a list of items in the access map
###	Parameters:
###		<exact tag> $| <mark:address> <mark:address> ... <>
###	where "exact" is either "+" or "!":
###	<+ TAG>	lookup with and w/o tag
###	<! TAG>	lookup with tag
###	possible values for "mark" are:
###		D: recursive host lookup (LookUpDomain)
###		E: exact lookup, no modifications
###		F: full lookup, try user+ext@domain and user@domain
###		U: user lookup, try user+ext and user (input must have trailing @)
###	return: <RHS of lookup> or <?> (not found)
######################################################################

# class with valid marks for SearchList
C{Src}E F D U 
SSearchList
# just call the ruleset with the name of the tag... nice trick...
R<$+> $| <$={Src}:$*> <$*>	$: <$1> $| <$4> $| $>$2 <$3> <?> <$1> <>
R<$+> $| <> $| <?> <>		$@ <?>
R<$+> $| <$+> $| <?> <>		$@ $>SearchList <$1> $| <$2>
R<$+> $| <$*> $| <$+> <>	$@ <$3>
R<$+> $| <$+>			$@ <$2>


######################################################################
###  trust_auth: is user trusted to authenticate as someone else?
###
###	Parameters:
###		$1: AUTH= parameter from MAIL command
######################################################################

SLocal_trust_auth
Strust_auth
R$*			$: $&{auth_type} $| $1
# required by RFC 2554 section 4.
R$@ $| $*		$#error $@ 5.7.1 $: "550 not authenticated"
R$* $| $&{auth_authen}		$@ identical
R$* $| <$&{auth_authen}>	$@ identical
R$* $| $*		$: $1 $| $>"Local_trust_auth" $2
R$* $| $#$*		$#$2
R$*			$#error $@ 5.7.1 $: "550 " $&{auth_authen} " not allowed to act as " $&{auth_author}

######################################################################
###  Relay_Auth: allow relaying based on authentication?
###
###	Parameters:
###		$1: ${auth_type}
######################################################################
SLocal_Relay_Auth

######################################################################
###  srv_features: which features to offer to a client?
###	(done in server)
######################################################################
Ssrv_features
R$*		$: $>D <$&{client_name}> <?> <! "Srv_Features"> <>
R<?>$*		$: $>A <$&{client_addr}> <?> <! "Srv_Features"> <>
R<?>$*		$: <$(access "Srv_Features": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#temp
R<$+>$*		$# $1

######################################################################
###  try_tls: try to use STARTTLS?
###	(done in client)
######################################################################
Stry_tls
R$*		$: $>D <$&{server_name}> <?> <! "Try_TLS"> <>
R<?>$*		$: $>A <$&{server_addr}> <?> <! "Try_TLS"> <>
R<?>$*		$: <$(access "Try_TLS": $: ? $)>
R<?>$*		$@ OK
R<$* <TMPF>>$*	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R<NO>$*		$#error $@ 5.7.1 $: "550 do not try TLS with " $&{server_name} " ["$&{server_addr}"]"

######################################################################
###  tls_rcpt: is connection with server "good" enough?
###	(done in client, per recipient)
###
###	Parameters:
###		$1: recipient
######################################################################
Stls_rcpt
R$*			$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$+			$: <?> $>CanonAddr $1
R<?> $+ < @ $+ . >	<?> $1 <@ $2 >
R<?> $+ < @ $+ >	$: $1 <@ $2 > $| <F:$1@$2> <U:$1@> <D:$2> <E:>
R<?> $+			$: $1 $| <U:$1@> <E:>
R$* $| $+	$: $1 $| $>SearchList <! "TLS_Rcpt"> $| $2 <>
R$* $| <?>	$@ OK
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$* $| <$+>	$@ $>"TLS_connection" $&{verify} $| <$2>

######################################################################
###  tls_client: is connection with client "good" enough?
###	(done in server)
###
###	Parameters:
###		${verify} $| (MAIL|STARTTLS)
######################################################################
Stls_client
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$* $| $*	$: $1 $| $>D <$&{client_name}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{client_addr}> <?> <! "TLS_Clt"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Clt": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  tls_server: is connection with server "good" enough?
###	(done in client)
###
###	Parameter:
###		${verify}
######################################################################
Stls_server
R$*		$: $(macro {TLS_Name} $@ $&{server_name} $) $1
R$*		$: $1 $| $>D <$&{server_name}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! "TLS_Srv"> <>
R$* $| <?>$*	$: $1 $| <$(access "TLS_Srv": $: ? $)>
R$* $| <$* <TMPF>>	$#error $@ 4.3.0 $: "451 Temporary system failure. Please try again later."
R$*		$@ $>"TLS_connection" $1

######################################################################
###  TLS_connection: is TLS connection "good" enough?
###
###	Parameters:
###		${verify} $| <Requirement> [<>]
###		Requirement: RHS from access map, may be ? for none.
######################################################################
STLS_connection
R$* $| <$*>$*			$: $1 $| <$2>
# create the appropriate error codes
R$* $| <PERM + $={Tls} $*>	$: $1 $| <503:5.7.0> <$2 $3>
R$* $| <TEMP + $={Tls} $*>	$: $1 $| <403:4.7.0> <$2 $3>
R$* $| <$={Tls} $*>		$: $1 $| <403:4.7.0> <$2 $3>
# deal with TLS handshake failures: abort
RSOFTWARE $| <$-:$+> $* 	$#error $@ $2 $: $1 " TLS handshake failed."
RSOFTWARE $| $* 		$#error $@ 4.7.0 $: "403 TLS handshake failed."
# deal with TLS protocol errors: abort
RPROTOCOL $| <$-:$+> $* 	$#error $@ $2 $: $1 " STARTTLS failed."
RPROTOCOL $| $* 		$#error $@ 4.7.0 $: "403 STARTTLS failed."
R$* $| <$*> <VERIFY>		$: <$2> <VERIFY> <> $1
R$* $| <$*> <VERIFY + $+>	$: <$2> <VERIFY> <$3> $1
R$* $| <$*> <$={Tls}:$->$*	$: <$2> <$3:$4> <> $1
R$* $| <$*> <$={Tls}:$- + $+>$*	$: <$2> <$3:$4> <$5> $1
R$* $| $*			$@ OK
# authentication required: give appropriate error
# other side did authenticate (via STARTTLS)
R<$*><VERIFY> <> OK		$@ OK
R<$*><VERIFY> <$+> OK		$: <$1> <REQ:0> <$2>
R<$*><VERIFY:$-> <$*> OK	$: <$1> <REQ:$2> <$3>
R<$*><ENCR:$-> <$*> $*		$: <$1> <REQ:$2> <$3>
R<$-:$+><VERIFY $*> <$*>	$#error $@ $2 $: $1 " authentication required"
R<$-:$+><VERIFY $*> <$*> FAIL	$#error $@ $2 $: $1 " authentication failed"
R<$-:$+><VERIFY $*> <$*> NO	$#error $@ $2 $: $1 " not authenticated"
R<$-:$+><VERIFY $*> <$*> NOT	$#error $@ $2 $: $1 " no authentication requested"
R<$-:$+><VERIFY $*> <$*> NONE	$#error $@ $2 $: $1 " other side does not support STARTTLS"
R<$-:$+><VERIFY $*> <$*> $+	$#error $@ $2 $: $1 " authentication failure " $4
R<$*><REQ:$-> <$*>		$: <$1> <REQ:$2> <$3> $>max $&{cipher_bits} : $&{auth_ssf}
R<$*><REQ:$-> <$*> $-		$: <$1> <$2:$4> <$3> $(arith l $@ $4 $@ $2 $)
R<$-:$+><$-:$-> <$*> TRUE	$#error $@ $2 $: $1 " encryption too weak " $4 " less than " $3
R<$-:$+><$-:$-> <$*> $*		$: <$1:$2 ++ $5>
R<$-:$+ ++ >			$@ OK
R<$-:$+ ++ $+ >			$: <$1:$2> <$3>
R<$-:$+> < $+ ++ $+ >		<$1:$2> <$3> <$4>
R<$-:$+> $+			$@ $>"TLS_req" $3 $| <$1:$2>

######################################################################
###  TLS_req: check additional TLS requirements
###
###	Parameters: [<list> <of> <req>] $| <$-:$+>
###		$-: SMTP reply code
###		$+: Enhanced Status Code
######################################################################
STLS_req
R $| $+		$@ OK
R<CN> $* $| <$+>		$: <CN:$&{TLS_Name}> $1 $| <$2>
R<CN:$&{cn_subject}> $* $| <$+>		$@ $>"TLS_req" $1 $| <$2>
R<CN:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " CN " $&{cn_subject} " does not match " $1
R<CS:$&{cert_subject}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CS:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Subject " $&{cert_subject} " does not match " $1
R<CI:$&{cert_issuer}> $* $| <$+>	$@ $>"TLS_req" $1 $| <$2>
R<CI:$+> $* $| <$-:$+>	$#error $@ $4 $: $3 " Cert Issuer " $&{cert_issuer} " does not match " $1
ROK			$@ OK

######################################################################
###  max: return the maximum of two values separated by :
###
###	Parameters: [$-]:[$-]
######################################################################
Smax
R:		$: 0
R:$-		$: $1
R$-:		$: $1
R$-:$-		$: $(arith l $@ $1 $@ $2 $) : $1 : $2
RTRUE:$-:$-	$: $2
R$-:$-:$-	$: $2


######################################################################
###  RelayTLS: allow relaying based on TLS authentication
###
###	Parameters:
###		none
######################################################################
SRelayTLS
# authenticated?
R$*			$: <?> $&{verify}
R<?> OK			$: OK		authenticated: continue
R<?> $*			$@ NO		not authenticated
R$*			$: $&{cert_issuer}
R$+			$: $(access CERTISSUER:$1 $)
RRELAY			$# RELAY
RSUBJECT		$: <@> $&{cert_subject}
R<@> $+			$: <@> $(access CERTSUBJECT:$1 $)
R<@> RELAY		$# RELAY
R$*			$: NO

######################################################################
###  authinfo: lookup authinfo in the access map
###
###	Parameters:
###		$1: {server_name}
###		$2: {server_addr}
######################################################################
Sauthinfo
R$*		$: $1 $| $>D <$&{server_name}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| $>A <$&{server_addr}> <?> <! AuthInfo> <>
R$* $| <?>$*	$: $1 $| <$(access AuthInfo: $: ? $)> <>
R$* $| <?>$*	$@ no				no authinfo available
R$* $| <$*> <>	$# $2





#
######################################################################
######################################################################
#####
#####			MAIL FILTER DEFINITIONS
#####
######################################################################
######################################################################

#
######################################################################
######################################################################
#####
#####			MAILER DEFINITIONS
#####
######################################################################
######################################################################

#####################################
###   SMTP Mailer specification   ###
#####################################

#####  $Id: smtp.m4,v 8.64 2001/04/03 01:52:54 gshapiro Exp $  #####

#
#  common sender and masquerading recipient rewriting
#
SMasqSMTP
R$* < @ $* > $*		$@ $1 < @ $2 > $3		already fully qualified
R$+			$@ $1 < @ *LOCAL* >		add local qualification

#
#  convert pseudo-domain addresses to real domain addresses
#
SPseudoToReal

# pass <route-addr>s through
R< @ $+ > $*		$@ < @ $1 > $2			resolve <route-addr>

# output fake domains as user%fake@relay

# do UUCP heuristics; note that these are shared with UUCP mailers
R$+ < @ $+ .UUCP. >	$: < $2 ! > $1			convert to UUCP form
R$+ < @ $* > $*		$@ $1 < @ $2 > $3		not UUCP form

# leave these in .UUCP form to avoid further tampering
R< $&h ! > $- ! $+	$@ $2 < @ $1 .UUCP. >
R< $&h ! > $-.$+ ! $+	$@ $3 < @ $1.$2 >
R< $&h ! > $+		$@ $1 < @ $&h .UUCP. >
R< $+ ! > $+		$: $1 ! $2 < @ $Y >		use UUCP_RELAY
R$+ < @ $~[ $* : $+ >	$@ $1 < @ $4 >			strip mailer: part
R$+ < @ >		$: $1 < @ *LOCAL* >		if no UUCP_RELAY


#
#  envelope sender rewriting
#
SEnvFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$* :; <@>		$@				list:; special case
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqEnv $1			do masquerading


#
#  envelope recipient rewriting --
#  also header recipient if not masquerading recipients
#
SEnvToSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R$+			$: $>MasqSMTP $1		qualify unqual'ed names
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  header sender and masquerading header recipient rewriting
#
SHdrFromSMTP
R$+			$: $>PseudoToReal $1		sender/recipient common
R:; <@>			$@				list:; special case

# do special header rewriting
R$* <@> $*		$@ $1 <@> $2			pass null host through
R< @ $* > $*		$@ < @ $1 > $2			pass route-addr through
R$*			$: $>MasqSMTP $1		qualify unqual'ed names
R$+			$: $>MasqHdr $1			do masquerading


#
#  relay mailer header masquerading recipient rewriting
#
SMasqRelay
R$+			$: $>MasqSMTP $1
R$+			$: $>MasqHdr $1

Msmtp,		P=[IPC], F=mDFMuX, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mesmtp,		P=[IPC], F=mDFMuXa, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Msmtp8,		P=[IPC], F=mDFMuX8, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mdsmtp,		P=[IPC], F=mDFMuXa%, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP, E=\r\n, L=990,
		T=DNS/RFC822/SMTP,
		A=TCP $h
Mrelay,		P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h


######################*****##############
###   PROCMAIL Mailer specification   ###
##################*****##################

#####  $Id: procmail.m4,v 8.22 2001/11/12 23:11:34 ca Exp $  #####

Mprocmail,	P=/usr/bin/procmail, F=DFMSPhnu9, S=EnvFromSMTP/HdrFromSMTP, R=EnvToSMTP/HdrFromSMTP,
		T=DNS/RFC822/X-Unix,
		A=procmail -Y -m $h $f $u


##################################################
###   Local and Program Mailer specification   ###
##################################################

#####  $Id: local.m4,v 8.59 2004/11/23 00:37:25 ca Exp $  #####

#
#  Envelope sender rewriting
#
SEnvFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqEnv $1		do masquerading

#
#  Envelope recipient rewriting
#
SEnvToL
R$+ < @ $* >		$: $1			strip host part

#
#  Header sender rewriting
#
SHdrFromL
R<@>			$n			errors to mailer-daemon
R@ <@ $*>		$n			temporarily bypass Sun bogosity
R$+			$: $>AddDomain $1	add local domain if needed
R$*			$: $>MasqHdr $1		do masquerading

#
#  Header recipient rewriting
#
SHdrToL
R$+			$: $>AddDomain $1	add local domain if needed
R$* < @ *LOCAL* > $*	$: $1 < @ $j . > $2

#
#  Common code to add local domain name (only if always-add-domain)
#
SAddDomain
R$* < @ $* > $* 	$@ $1 < @ $2 > $3	already fully qualified

R$+			$@ $1 < @ *LOCAL* >	add local qualification

Mlocal,		P=/usr/bin/procmail, F=lsDFMAw5:/|@qSPfhn9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL,
		T=DNS/RFC822/X-Unix,
		A=procmail -t -Y -a $h -d $u
Mprog,		P=/usr/sbin/smrsh, F=lsDFMoqeu9, S=EnvFromL/HdrFromL, R=EnvToL/HdrToL, D=$z:/,
		T=X-Unix/X-Unix/X-Unix,
		A=smrsh -c $u

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# /etc/init.d/sednm[K[K[Kndmail  start[K[K[K[K[Krestart
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# [1P(reverse-i-search)`':[Cm': /etc/init.d/sendmail  restart[1@a[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@i[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@l[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[2Pm4 sendmail.mc  sendmail.cf[13Pvi sendmail.mccat /var/spool/mail/champu [5Pmail champu@altnix.com[3P[root@localhost mail]#[C
Subject: ppppppppppppp
pppppppppppp
.
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@altnix.com/etc/init.d/sendmail  restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[2Pm4 sendmail.mc  sendmail.cf[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[13Pvi sendmail.mc
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': /etc/init.d/sendmail  restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pp': cat /var/spool/mail/champu [1@o[C[C[C[C[C[C[C[C[C[C[C[C[2P[root@localhost mail]#[C[C[C[C[C[C[C[C[C[C
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.com/etc/init.d/sendmail  restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[2Pm4 sendmail.mc  sendmail.cf[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C/etc/init.d/sendmail  restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[2Pm4 sendmail.mc  sendmail.cf[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[13Pvi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 180L, 7311C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1Hdnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalii[6;1Has.com as well
dnl #
dnl FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl
dnl MASQUERADE_DOMAIN(mydomainalias.com)dnl
dnl MASQUERADE_DOMAIN(mydomain.lan)dnl
MAILER(smtp)dnl
MAILER(procmail)dnl
dnl MAILER(cyrusv2)dnl

define(`confCW_FILE', `/etc/mail/local-host-names')dnl
define(`confDOMAIN_NAME', `altnix.com')dnl
[?12l[?25h[?25l[1m[34m~                                                               [19;1H[?12l[?25h[18;1H
[md[?25l

:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/local-host-names" "/etc/mail/local-host-names" 1L, 64C[1;1H# local-host-names - include all aliases for your machine here.
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[1m-- INSERT --[m[21;13H[K[2;1H[K[2;1H[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25ln[?12l[?25h[?25li[?12l[?25h[?25lx[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25lm[?12l[?25h[?25l[3;1H[K[3;1H[?12l[?25h[21;1H[K[3;1H[?25l[?12l[?25h[?25l[1m[34m~                                                               [2;1H[?12l[?25h[?25l[21;1H[m:[?12l[?25hwq![?25l"local-host-names" "local-host-names" 2L, 75C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names [16Psendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 180L, 7311C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi sendmail.mc/etc/mail/local-host-names 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# vi sendmail.mc/etc/mail/local-host-names [16Psendmail.mccat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[13Pvi sendmail.mc[H[2J[root@localhost mail]# vi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 180L, 7311C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1Hdnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalii[6;1Has.com as well
dnl #
dnl FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl
dnl MASQUERADE_DOMAIN(mydomainalias.com)dnl
dnl MASQUERADE_DOMAIN(mydomain.lan)dnl
MAILER(smtp)dnl
MAILER(procmail)dnl
dnl MAILER(cyrusv2)dnl

define(`confCW_FILE', `/etc/mail/local-host-names')dnl
define(`confDOMAIN_NAME', `altnix.com')dnl
[?12l[?25h[?25l[1m[34m~                                                               [19;1H[?12l[?25h[?25l

[m:[?12l[?25hwq![?25l"sendmail.mc" "sendmail.mc" 179L, 7310C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# vi sendmail.mc/etc/mail/local-host-names 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/local-host-names" "/etc/mail/local-host-names" 2L, 75C[1;1H# local-host-names - include all aliases for your machine here.
altnix.com
[1m[34m~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h
[?25l[m[21;1H[1m-- INSERT --[m[21;13H[K[3;1H[K[3;1H[?12l[?25h[?25lm[?12l[?25h[?25la[?12l[?25h[?25li[?12l[?25h[?25ll[?12l[?25h[?25l1[?12l[?25h[?25l.[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25ln[?12l[?25h[?25li[?12l[?25h[?25lx[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25lm[?12l[?25h[21;1H[K[3;16H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"local-host-names" "local-host-names" 3L, 92C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/local-host-names" "/etc/mail/local-host-names" 3L, 92C[1;1H# local-host-names - include all aliases for your machine here.
altnix.com
mail1.altnix.com
[1m[34m~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h

[?25l[m[21;1H[K[21;1H:[?12l[?25hwq![?25l"local-host-names" "local-host-names" 3L, 92C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names [16Psendmail.mc/etc/mail/local-host-names [16Psendmail.mccat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.com/etc/init.d/sendmail  restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[2Pm4 sendmail.mc  sendmail.cf[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[13Pvi sendmail.mc
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names 
]0;root@localhost:/etc/mail[root@localhost mail]# vi /et[K[K[K[K[K[K[1P(reverse-i-search)`':[C[31@a': vi /etc/mail/local-host-names[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@l[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[7Pt': mail champu@altnix.com[1@n[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@i[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@x[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@.[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# vi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[K 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/var/named/chroot/var/named/altnix.db" "/var/named/chroot/var/named/altnix.db" 13L, 238C[1;1H$TTL    86400
@[15CIN SOA  @[7Croot ([3;41H42[14C; seriall[4;1H (d. adams)[5;41H3H[14C; refress[6;1Hh[7;41H15M[13C; retry[8;41H1W[14C; expiry[9;41H1D )[12C; minimuu[10;1Hm[12;17HIN NS[11C@[13;17HIN A[12C127.0.0.1[14;17HIN AAAA[9C::1

altnix.com.     IN    A      192.168.1.100
[1m[34m~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h
[3;8H[5;8H[7;8H[8;8H[9;8H

[12;8H[13;8H[14;8H

[?25l[m
altnix.com.     IN    A      192.168.1.100[17;43H[K[17;1H[?12l[?25h[?25lltnix.com.     IN    A      192.168.1.10[17;42H[K[17;1H[?12l[?25h[?25ltnix.com.     IN    A      192.168.1.10[17;41H[K[17;1H[?12l[?25h[?25lnix.com.     IN    A      192.168.1.10[17;40H[K[17;1H[?12l[?25h[?25lix.com.     IN    A      192.168.1.10[17;39H[K[17;1H[?12l[?25h[?25lx.com.     IN    A      192.168.1.10[17;38H[K[17;1H[?12l[?25h[?25l.com.     IN    A      192.168.1.10[17;37H[K[17;1H[?12l[?25h[?25lcom.     IN    A      192.168.1.10[17;36H[K[17;1H[?12l[?25h[?25lom.     IN    A      192.168.1.10[17;35H[K[17;1H[?12l[?25h[?25lm.     IN    A      192.168.1.10[17;34H[K[17;1H[?12l[?25h[?25l.     IN    A      192.168.1.10[17;33H[K[17;1H[?12l[?25h[?25l[21;1H[1m-- INSERT --[m[21;13H[K[17;1H[?12l[?25h[?25lm.     IN    A      192.168.1.100m[?12l[?25h[?25la.     IN    A      192.168.1.100ma[?12l[?25h[?25li.     IN    A      192.168.1.100mai[?12l[?25h[?25ll.     IN    A      192.168.1.100mail[?12l[?25h[?25l1.     IN    A      192.168.1.100mail1[?12l[?25h.[?25la     IN    A      192.168.1.100[17;8H[?12l[?25h[?25ll     IN    A      192.168.1.100[17;9H[?12l[?25h[?25lt     IN    A      192.168.1.100[17;10H[?12l[?25h[?25ln     IN    A      192.168.1.100[17;11H[?12l[?25h[?25li     IN    A      192.168.1.100[17;12H[?12l[?25h[?25lx     IN    A      192.168.1.100[17;13H[?12l[?25h[?25l.     IN    A      192.168.1.100[17;14H[?12l[?25h[?25lc     IN    A      192.168.1.100[17;15H[?12l[?25h[?25lo     IN    A      192.168.1.100[17;16H[?12l[?25h[?25lm     IN    A      192.168.1.100[17;17H[?12l[?25h[21;1H[K[17;16H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"/var/named/chroot/var/named/altnix.db" "/var/named/chroot/var/named/altnix.db" 14L, 286C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# [1P(reverse-i-search)`':[C[31@s': vi /etc/mail/local-host-names[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[15Pe': vi sendmail.mcr': service named stop[1@v[C[C[C[3P[root@localhost mail]#[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[K[K[K[Krestart
Stopping named: [60G[[0;32m  OK  [0;39m]
Starting named: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# ping  mail1.altnix.com
PING mail1.altnix.com.com (208.73.211.69) 56(84) bytes of data.

--- mail1.altnix.com.com ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, time 2999ms

]0;root@localhost:/etc/mail[root@localhost mail]# ping  mail1.altnix.com[1Pservice named restartvi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[K 
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/var/named/chroot/var/named/altnix.db" "/var/named/chroot/var/named/altnix.db" 14L, 286C[1;1H$TTL    86400
@[15CIN SOA  @[7Croot ([3;41H42[14C; seriall[4;1H (d. adams)[5;41H3H[14C; refress[6;1Hh[7;41H15M[13C; retry[8;41H1W[14C; expiry[9;41H1D )[12C; minimuu[10;1Hm[12;17HIN NS[11C@[13;17HIN A[12C127.0.0.1[14;17HIN AAAA[9C::1

altnix.com.     IN    A      192.168.1.100
mail1.altnix.com     IN    A      192.168.1.100
[1m[34m~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h
[3;8H[5;8H[7;8H[8;8H[9;8H

[12;8H[13;8H[14;8H


[mmail1.altnix.com  [?25l[21;1H[1m-- INSERT --[m[21;13H[K[17;17H[?12l[?25h[?25l.     IN    A      192.168.1.100[17;18H[?12l[?25h[21;1H[K[17;17H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"/var/named/chroot/var/named/altnix.db" "/var/named/chroot/var/named/altnix.db" 14L, 287C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[19Pping  mail1.altnix.com
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pservice named restart
Stopping named: [60G[[0;32m  OK  [0;39m]
Starting named: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# service named restartvi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[19Pping  mail1.altnix.com
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
PING mail1.altnix.com (192.168.1.100) 56(84) bytes of data.
64 bytes from altnix.com (192.168.1.100): icmp_seq=1 ttl=64 time=0.041 ms
64 bytes from altnix.com (192.168.1.100): icmp_seq=2 ttl=64 time=0.074 ms

--- mail1.altnix.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 0.041/0.057/0.074/0.018 ms
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cm': ping  mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@a[C[C[C[C[C[C[C[C[C[1@i[C[C[C[C[C[C[C[C[C[1@l[C[C[C[C[C[C[C[C[Cvi /etc/mail/local-host-names [16Psendmail.mc/etc/mail/local-host-names [16Psendmail.mccat /var/spool/mail/champu [5Pmail champu@altnix.com/etc/init.d/sendmail  restart
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@,[Kmail1.altnix.com[H[2J[root@localhost mail]# mail champu@mail1.altnix.com
Subject: rrrrrrrrrrrrrr
rrrrrrrrrrrrr
.
Cc: .
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': service named restartp': cat /var/spool/mail/champu [1@o[C[C[C[C[C[C[C[C[C[C[C[C[2P[root@localhost mail]#[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/etc/mailYou have new mail in /var/spool/mail/root
[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[6Pping  mail1.altnix.com[1Pservice named restartvi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[19Pping  mail1.altnix.com
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pservice named restartvi /var/named/chroot/var/named/altnix.db  [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[11Petc/mail/local-host-names
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/local-host-names" "/etc/mail/local-host-names" 3L, 92C[1;1H# local-host-names - include all aliases for your machine here.
altnix.com
mail1.altnix.com
[1m[34m~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h

[?25l[m[21;1H[K[21;1H:[?12l[?25hwq![?25l"local-host-names" "local-host-names" 3L, 92C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/local-host-names [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[3Pcat /var/spool/mail/champu[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pcat /var/spool/mail/champu 
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[C[31@s': vi /etc/mail/local-host-names[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[8Pe': service named restart[1@r[C[C[C[1@v[C[C[C[1@i[C[C[C[4P[root@localhost mail]#[C
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# service sendmila[K[K[Kail restart
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# ip r l
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.100 
169.254.0.0/16 dev eth0  scope link 
default via 192.168.1.1 dev eth0 
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': service sendmail restart[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@e[C[C[C[C[C[C[C[C[C[C[C[1@n[C[C[C[C[C[C[C[C[C[C[C[1@d[C[C[C[C[C[C[C[C[C[C[C[1@m[C[C[C[C[C[C[C[C[C[C[C[1@a[C[C[C[C[C[C[C[C[C[C[C[10Pvi sendmail.mc[5P[root@localhost mail]#[C[C[C[C
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 179L, 7310C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[27m[m[H[2J[1;1Hdnl #
dnl # masquerade not just the headers, but the envelope as well
dnl #
dnl FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalii[7;1Has.com as well
dnl #
dnl FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl
dnl MASQUERADE_DOMAIN(mydomainalias.com)dnl
dnl MASQUERADE_DOMAIN(mydomain.lan)dnl
MAILER(smtp)dnl
MAILER(procmail)dnl
dnl MAILER(cyrusv2)dnl

define(`confCW_FILE', `/etc/mail/local-host-names')dnl
define(`confDOMAIN_NAME', `altnix.com')dnl[?12l[?25h[19;1H[18;1H

[?25l
[1m-- INSERT --[20;1H[?12l[?25h[?25l[mddefine(`confDOMAIN_NAME', `altnix.com')dnld[?12l[?25h[?25lndefine(`confDOMAIN_NAME', `altnix.com')dnldn[?12l[?25h[?25lldefine(`confDOMAIN_NAME', `altnix.com')dnldnl[?12l[?25h[?25l define(`confDOMAIN_NAME', `altnix.com')dnldnl [?12l[?25h[?25l#define(`confDOMAIN_NAME', `altnix.com')dnldnl #[?12l[?25h[?25l define(`confDOMAIN_NAME', `altnix.com')dnl[20;7H[?12l[?25h[21;1H[K[20;6H[?25l[?12l[?25h[19;6He(`confCW_FILE', `/etc/mail/local-ho[?25l

:[?12l[?25hwq![?25l"sendmail.mc" "sendmail.mc" 179L, 7316C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': vi sendmail.mc[1@e[C[C[C[C[C[Cr': service sendmail restart[2P[root@localhost mail]#[C
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# service sendmail restart[Kservice sendmail restart[10Pvi sendmail.mc[8Pip r lservice sendmail restartvi /etc/mail/local-host-names [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[3Pcat /var/spool/mail/champu[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com
Subject: ggggggggggggggggggggggggg
gggggggggggggggggggggggg
.
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[4Pservice sendmail restart[10Pvi sendmail.mc[8Pip r lservice sendmail restartvi /etc/mail/local-host-names [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[3Pcat /var/spool/mail/champu[C
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

From root@altnix.com  Fri May  2 12:47:38 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427Hc0o004495
	for <champu@mail1.altnix.com>; Fri, 2 May 2014 12:47:38 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427HcuD004494
	for champu@mail1.altnix.com; Fri, 2 May 2014 12:47:38 +0530
Date: Fri, 2 May 2014 12:47:38 +0530
From: root <root@altnix.com>
Message-Id: <201405020717.s427HcuD004494@altnix.com>
To: champu@mail1.altnix.com
Subject: ggggggggggggggggggggggggg

gggggggggggggggggggggggg

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com[1Paltnix.com[1Paltnix.com[1Paltnix.com[1Paltnix.com[1Pltnix.com[1Paltnix.com
Subject: ttttttttttttttt
ttttttttttttttttttt
.
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# mail champu@altnix.comcat /var/spool/mail/champu 
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

From root@altnix.com  Fri May  2 12:47:38 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427Hc0o004495
	for <champu@mail1.altnix.com>; Fri, 2 May 2014 12:47:38 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427HcuD004494
	for champu@mail1.altnix.com; Fri, 2 May 2014 12:47:38 +0530
Date: Fri, 2 May 2014 12:47:38 +0530
From: root <root@altnix.com>
Message-Id: <201405020717.s427HcuD004494@altnix.com>
To: champu@mail1.altnix.com
Subject: ggggggggggggggggggggggggg

gggggggggggggggggggggggg

From root@altnix.com  Fri May  2 12:47:59 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427HwKG004502
	for <champu@altnix.com>; Fri, 2 May 2014 12:47:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427HwVT004501
	for champu@altnix.com; Fri, 2 May 2014 12:47:58 +0530
Date: Fri, 2 May 2014 12:47:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020717.s427HwVT004501@altnix.com>
To: champu@altnix.com
Subject: ttttttttttttttt

ttttttttttttttttttt

]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.comcat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[4Pservice sendmail restart[10Pvi sendmail.mc[8Pip r lvi sendmail.mc[8Pip r lservice sendmail restartip r l[Kvi sendmail.mc
]0;root@localhost:/etc/mail[root@localhost mail]# ps aux |grep -i script
root      3211  0.0  0.0   3724   556 pts/2    S+   11:43   0:00 script
root      3212  0.0  0.0   3728   312 pts/2    S+   11:43   0:00 script
root      4532  0.0  0.0   3920   680 pts/3    R+   12:59   0:00 grep -i script
]0;root@localhost:/etc/mail[root@localhost mail]# ps
  PID TTY          TIME CMD
 3213 pts/3    00:00:00 bash
 4534 pts/3    00:00:00 ps
]0;root@localhost:/etc/mail[root@localhost mail]# ps
  PID TTY          TIME CMD
 3213 pts/3    00:00:00 bash
 4537 pts/3    00:00:00 ps
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# ls
[00m[00maccess[00m            [00mmailertable[00m      [00msendmail.mc.org[00m
[00maccess.db[00m         [00mmailertable.db[00m   [00msubmit.cf[00m
[00mdomaintable[00m       [00mMakefile[00m         [00msubmit.mc[00m
[00mdomaintable.db[00m    [00msendmail.cf[00m      [00mtrusted-users[00m
[00mhelpfile[00m          [00msendmail.cf.bak[00m  [00mvirtusertable[00m
[00mlocal-host-names[00m  [00msendmail.mc[00m      [00mvirtusertable.db[00m
[m]0;root@localhost:/etc/mail[root@localhost mail]# lsps aux |grep -i scriptcat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail champu@altnix.comcat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Cmail champu@mail1.altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[4Pservice sendmail restart[10Pvi sendmail.mc[8Pip r lservice sendmail restartip r l[Kvi sendmail.mc
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"sendmail.mc" "sendmail.mc" 179L, 7316C[1;1Hdivert(-1)dnl
dnl #
dnl # This is the sendmail macro config file for m4. If you makee[4;1H changes to
dnl # /etc/mail/sendmail.mc, you will need to regenerate the
dnl # /etc/mail/sendmail.cf file by confirming that the sendmaill[7;1H-cf package is
dnl # installed and then performing a
dnl #
dnl #     make -C /etc/mail
dnl #
include(`/usr/share/sendmail-cf/m4/cf.m4')dnl
VERSIONID(`setup for linux')dnl
OSTYPE(`linux')dnl
dnl #
dnl # Do not advertize sendmail version.
dnl #
dnl define(`confSMTP_LOGIN_MSG', `$j Sendmail; $b')dnl
dnl #
dnl # default logging level is 9, you might want to set it highe[20;1H[1m[34m@                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H/[?12l[?25hvirtu[?25l/virtu[27m[m[H[2J[1;1Hdnl define(`confTO_QUEUEWARN', `4h')dnl
dnl define(`confTO_QUEUERETURN', `5d')dnl
dnl define(`confQUEUE_LA', `12')dnl
dnl define(`confREFUSE_LA', `18')dnl
define(`confTO_IDENT', `0')dnl
dnl FEATURE(delay_checks)dnl
FEATURE(`no_default_msa', `dnl')dnl
FEATURE(`smrsh', `/usr/sbin/smrsh')dnl
FEATURE(`mailertable', `hash -o /etc/mail/mailertable.db')dnl
FEATURE(`virtusertable', `hash -o /etc/mail/virtusertable.db')dnn[11;1Hl
FEATURE(redirect)dnl
FEATURE(always_add_domain)dnl
FEATURE(use_cw_file)dnl
FEATURE(use_ct_file)dnl
dnl #
dnl # The following limits the number of processes sendmail can  [18;1Hfork to accept
dnl # incoming messages or process its message queues to 20.) see[20;1Hndmail refuses[10;10H[?12l[?25hvirtusertable', `hash -o /etc/mail/virtusertable.db[?25l[21;1H/virtu[31msearch hit BOTTOM, continuing at TOPsearch hit BOTTOM, continuing at TOP[10;10H[?12l[?25h[?25l[m[21;1H/virtu[21;7H[K[21;1H[10;45H[?12l[?25h[?25l[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mails/virtu[K[K[K[H[2J[root@localhost mail]# vi /etc/mails/vi[K[K[K[K
mail/    mailcap  mail.rc  
[root@localhost mail]# vi /etc/mail
mail/    mailcap  mail.rc  
[root@localhost mail]# vi /etc/mail
mail/    mailcap  mail.rc  
[root@localhost mail]# vi /etc/mail[Kl/
access            mailertable       sendmail.mc.org
access.db         mailertable.db    submit.cf
domaintable       Makefile          submit.mc
domaintable.db    sendmail.cf       trusted-users
helpfile          sendmail.cf.bak   virtusertable
local-host-names  sendmail.mc       virtusertable.db
[root@localhost mail]# vi /etc/mail/virtusertable[H[2J[root@localhost mail]# vi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 0L, 0C[2;1H[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[1m-- INSERT --[m[21;13H[K[1;1H[?12l[?25h[?25l@[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25ln[?12l[?25h[?25li[?12l[?25h[?25lx[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25lm[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25lm[?12l[?25h[?25la[?12l[?25h[?25li[?12l[?25h[?25ll[?12l[?25h[?25l1[?12l[?25h[?25l.[?12l[?25h[?25la[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25ln[?12l[?25h[?25li[?12l[?25h[?25lx[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25lm[?12l[?25h[?25lcmail1.altnix.com[1;19H[?12l[?25h[?25lhmail1.altnix.com[1;20H[?12l[?25h[?25lamail1.altnix.com[1;21H[?12l[?25h[?25lmmail1.altnix.com[1;22H[?12l[?25h[?25lpmail1.altnix.com[1;23H[?12l[?25h[?25lumail1.altnix.com[1;24H[?12l[?25h[?25l@mail1.altnix.com[1;25H[?12l[?25h[21;1H[K[1;24H[?25l[?12l[?25h[?25l[21;1H:[?12l[?25hwq![?25l"virtusertable" "virtusertable" 1L, 41C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 1L, 41C[1;1H@altnix.com      champu@mail1.altnix.com
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hwq![?25l"virtusertable" "virtusertable" 1L, 41C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 1L, 41C[1;1H@altnix.com      champu@mail1.altnix.com
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hwq![?25l"virtusertable" "virtusertable" 1L, 41C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 1L, 41C[1;1H@altnix.com      champu@mail1.altnix.com
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hwq![?25l"virtusertable" "virtusertable" 1L, 41C written
[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': vi /etc/mail/virtusertable[1@e[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@r[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pv': service sendmail restart[3P[root@localhost mail]#[C
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# [1P(reverse-i-search)`':[Cc': service sendmail restarth': cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@a[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@m[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@p[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1@u[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[4P@': mail champu@altnix.com[6P[root@localhost mail]#[C[C[C[C[C[C[C
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# sac[K[K[Kid sachin
uid=501(sachin) gid=501(sachin) groups=501(sachin),503(market)
]0;root@localhost:/etc/mail[root@localhost mail]# id sachinservice sendmail restartvi /etc/mail/virtusertable[12Psendmail.mcls[Kps aux |grep -i scriptcat /var/spool/mail/champu 
]0;root@localhost:/etc/mail[root@localhost mail]# id sachinservice sendmail restartvi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 1L, 41C[1;1H@altnix.com      champu@mail1.altnix.com
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# vi /etc/mail/virtusertable[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[17Pid sachinservice sendmail restartvi /etc/mail/virtusertable
]0;root@localhost:/etc/mail[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# mail sachin@altnix.com[1@#
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': #mail sachin@altnix.come': vi /etc/mail/virtusertable[1@r[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1Pv': service sendmail restart[3P[root@localhost mail]#[C
Shutting down sm-client: [60G[[0;32m  OK  [0;39m]
Shutting down sendmail: [60G[[0;32m  OK  [0;39m]
Starting sendmail: [60G[[0;32m  OK  [0;39m]
Starting sm-client: [60G[[0;32m  OK  [0;39m]
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# service sendmail restart[1P#mail sachin@altnix.com[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[1P
Subject: fffffffffffffffffffff
fffffffffff
.
Cc: 
]0;root@localhost:/etc/mail[root@localhost mail]# [1P(reverse-i-search)`':[Cs': mail sachin@altnix.comp': cat /var/spool/mail/champu [1@o[C[C[C[C[C[C[C[C[C[C[C[C[2P[root@localhost mail]#[C[C[C[C[C[C[C[C[C[C
From root@localhost.localdomain  Fri Apr 11 21:45:19 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFJpb004661
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:19 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFJtw004660
	for champu; Fri, 11 Apr 2014 21:45:19 +0530
Date: Fri, 11 Apr 2014 21:45:19 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFJtw004660@localhost.localdomain>
To: champu@localhost.localdomain
Subject: test

THIS IS TEST

From root@localhost.localdomain  Fri Apr 11 21:45:57 2014
Return-Path: <root@localhost.localdomain>
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by localhost.localdomain (8.13.8/8.13.8) with ESMTP id s3BGFv8J004669
	for <champu@localhost.localdomain>; Fri, 11 Apr 2014 21:45:57 +0530
Received: (from root@localhost)
	by localhost.localdomain (8.13.8/8.13.8/Submit) id s3BGFvuO004668
	for champu; Fri, 11 Apr 2014 21:45:57 +0530
Date: Fri, 11 Apr 2014 21:45:57 +0530
From: root <root@localhost.localdomain>
Message-Id: <201404111615.s3BGFvuO004668@localhost.localdomain>
To: champu@localhost.localdomain

cdadmlkaml

From root@altnix.com  Fri May  2 12:03:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426XwEh003645
	for <champu@altnix.com>; Fri, 2 May 2014 12:03:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426XwQC003644
	for champu@altnix.com; Fri, 2 May 2014 12:03:58 +0530
Date: Fri, 2 May 2014 12:03:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020633.s426XwQC003644@altnix.com>
To: champu@altnix.com
Subject: ssssssssssssssss

ssssssssssssssssssssssssss

From root@altnix.com  Fri May  2 12:05:09 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426Z9nV003655
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:09 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Z9ia003654
	for champu; Fri, 2 May 2014 12:05:09 +0530
Date: Fri, 2 May 2014 12:05:09 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Z9ia003654@altnix.com>
To: champu@altnix.com
Subject: ddddddddd

dddddddddddd

From root@altnix.com  Fri May  2 12:05:58 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ZwmH003695
	for <champu@altnix.com>; Fri, 2 May 2014 12:05:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426Zwsu003694
	for champu@altnix.com; Fri, 2 May 2014 12:05:58 +0530
Date: Fri, 2 May 2014 12:05:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020635.s426Zwsu003694@altnix.com>
To: champu@altnix.com
Subject: gggggggggggg

ggggggggggg

From root@altnix.com  Fri May  2 12:26:42 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s426ugnp003922
	for <champu@altnix.com>; Fri, 2 May 2014 12:26:42 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s426ugOf003921
	for champu@altnix.com; Fri, 2 May 2014 12:26:42 +0530
Date: Fri, 2 May 2014 12:26:42 +0530
From: root <root@altnix.com>
Message-Id: <201405020656.s426ugOf003921@altnix.com>
To: champu@altnix.com
Subject: ppppppppppppp

pppppppppppp

From root@altnix.com  Fri May  2 12:47:38 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427Hc0o004495
	for <champu@mail1.altnix.com>; Fri, 2 May 2014 12:47:38 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427HcuD004494
	for champu@mail1.altnix.com; Fri, 2 May 2014 12:47:38 +0530
Date: Fri, 2 May 2014 12:47:38 +0530
From: root <root@altnix.com>
Message-Id: <201405020717.s427HcuD004494@altnix.com>
To: champu@mail1.altnix.com
Subject: ggggggggggggggggggggggggg

gggggggggggggggggggggggg

From root@altnix.com  Fri May  2 12:47:59 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427HwKG004502
	for <champu@altnix.com>; Fri, 2 May 2014 12:47:58 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427HwVT004501
	for champu@altnix.com; Fri, 2 May 2014 12:47:58 +0530
Date: Fri, 2 May 2014 12:47:58 +0530
From: root <root@altnix.com>
Message-Id: <201405020717.s427HwVT004501@altnix.com>
To: champu@altnix.com
Subject: ttttttttttttttt

ttttttttttttttttttt

From root@altnix.com  Fri May  2 13:05:57 2014
Return-Path: <root@altnix.com>
Received: from altnix.com (localhost.localdomain [127.0.0.1])
	by altnix.com (8.13.8/8.13.8) with ESMTP id s427ZvuE004639
	for <sachin@altnix.com>; Fri, 2 May 2014 13:05:57 +0530
Received: (from root@localhost)
	by altnix.com (8.13.8/8.13.8/Submit) id s427ZvbB004638
	for sachin@altnix.com; Fri, 2 May 2014 13:05:57 +0530
Date: Fri, 2 May 2014 13:05:57 +0530
From: root <root@altnix.com>
Message-Id: <201405020735.s427ZvbB004638@altnix.com>
To: sachin@altnix.com
Subject: fffffffffffffffffffff

fffffffffff

]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# cat /var/spool/mail/champu [C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[5Pmail sachin@altnix.comservice sendmail restart[1P#mail sachin@altnix.comvi /etc/mail/virtusertable[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[17Pid sachinservice sendmail restartvi /etc/mail/virtusertable
[?1049h[?1h=[1;21r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[21;1H"/etc/mail/virtusertable" "/etc/mail/virtusertable" 1L, 41C[1;1H@altnix.com      champu@mail1.altnix.com
[1m[34m~                                                               [3;1H~                                                               [4;1H~                                                               [5;1H~                                                               [6;1H~                                                               [7;1H~                                                               [8;1H~                                                               [9;1H~                                                               [10;1H~                                                               [11;1H~                                                               [12;1H~                                                               [13;1H~                                                               [14;1H~                                                               [15;1H~                                                               [16;1H~                                                               [17;1H~                                                               [18;1H~                                                               [19;1H~                                                               [20;1H~                                                               [1;1H[?12l[?25h[?25l[m[21;1H[K[21;1H:[?12l[?25hq![?25l[21;1H[K[21;1H[?1l>[?12l[?25h[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# mailq
/var/spool/mqueue is empty
		Total requests: 0
]0;root@localhost:/etc/mail[root@localhost mail]# mailstat
Most people don't type their own logfiles;  but, what do I care?
^[[A
]0;root@localhost:/etc/mail[root@localhost mail]# mailstats 
Statistics from Wed Apr  9 21:07:38 2014
 M   msgsfr  bytes_from   msgsto    bytes_to  msgsrej msgsdis msgsqur  Mailer
 4        3          3K        0          0K        0       0       0  esmtp
 9       36         66K       29         57K        0       0       0  local
=====================================================================
 T       39         69K       29         57K        0       0       0
 C       29                    6                    0
]0;root@localhost:/etc/mail[root@localhost mail]# praliases 
postmaster:root
daemon:root
adm:root
lp:root
shutdown:root
operator:root
ftp:root
radiusd:root
dbus:root
nscd:root
pcap:root
apache:root
dovecot:root
quagga:root
amanda:root
ident:root
gdm:root
mailnull:root
sshd:root
smmsp:root
squid:root
ntp:root
mysql:root
desktop:root
rpcuser:root
nfsnobody:root
ingres:root
toor:root
abuse:root
newsadmin:news
usenet:news
ftpadm:ftp
ftp-admin:ftp
webmaster:root
noc:root
security:root
hostmaster:root
info:postmaster
marketing:postmaster
sales:postmaster
decode:root
@:@
mailer-daemon:postmaster
bin:root
sync:root
halt:root
mail:root
news:root
uucp:root
games:root
gopher:root
nobody:root
nut:root
vcsa:root
canna:root
wnn:root
rpm:root
webalizer:root
fax:root
radvd:root
pvm:root
privoxy:root
named:root
xfs:root
postgres:root
postfix:root
netdump:root
ldap:root
rpc:root
system:root
manager:root
dumper:root
newsadm:news
ftpadmin:ftp
ftp-adm:ftp
www:webmaster
support:postmaster
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# rpm -ql sendmail
/etc/aliases.db
/etc/mail
/etc/mail/Makefile
/etc/mail/access
/etc/mail/access.db
/etc/mail/domaintable
/etc/mail/domaintable.db
/etc/mail/helpfile
/etc/mail/local-host-names
/etc/mail/mailertable
/etc/mail/mailertable.db
/etc/mail/sendmail.cf
/etc/mail/sendmail.mc
/etc/mail/submit.cf
/etc/mail/submit.mc
/etc/mail/trusted-users
/etc/mail/virtusertable
/etc/mail/virtusertable.db
/etc/pam.d/smtp.sendmail
/etc/rc.d/init.d/sendmail
/etc/smrsh
/etc/sysconfig/sendmail
/usr/bin/hoststat
/usr/bin/mailq.sendmail
/usr/bin/makemap
/usr/bin/newaliases.sendmail
/usr/bin/purgestat
/usr/bin/rmail.sendmail
/usr/lib/sasl2/Sendmail.conf
/usr/lib/sendmail.sendmail
/usr/sbin/mailstats
/usr/sbin/makemap
/usr/sbin/praliases
/usr/sbin/sendmail.sendmail
/usr/sbin/smrsh
/usr/share/man/man1/mailq.sendmail.1.gz
/usr/share/man/man1/newaliases.sendmail.1.gz
/usr/share/man/man5/aliases.sendmail.5.gz
/usr/share/man/man8/mailstats.8.gz
/usr/share/man/man8/makemap.8.gz
/usr/share/man/man8/praliases.8.gz
/usr/share/man/man8/rmail.8.gz
/usr/share/man/man8/sendmail.sendmail.8.gz
/usr/share/man/man8/smrsh.8.gz
/var/log/mail
/var/log/mail/statistics
/var/spool/clientmqueue
/var/spool/mqueue
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# rpm -ql sendmail[1P sendmailc sendmail
/etc/mail/Makefile
/etc/mail/access
/etc/mail/domaintable
/etc/mail/helpfile
/etc/mail/local-host-names
/etc/mail/mailertable
/etc/mail/sendmail.cf
/etc/mail/sendmail.mc
/etc/mail/submit.cf
/etc/mail/submit.mc
/etc/mail/trusted-users
/etc/mail/virtusertable
/etc/pam.d/smtp.sendmail
/etc/rc.d/init.d/sendmail
/etc/sysconfig/sendmail
/usr/lib/sasl2/Sendmail.conf
/var/log/mail/statistics
]0;root@localhost:/etc/mail[root@localhost mail]# rpm -qc sendmail[1P sendmailb sendmail
-qb: unknown option
]0;root@localhost:/etc/mail[root@localhost mail]# rpm -qb sendmail[1P sendmail
]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# rpm -qb sendmailc[C[C[C[C[C[C[C[C[Cl[C[C[C[C[C[C[C[C[C | grep -i /bin
/usr/bin/hoststat
/usr/bin/mailq.sendmail
/usr/bin/makemap
/usr/bin/newaliases.sendmail
/usr/bin/purgestat
/usr/bin/rmail.sendmail
]0;root@localhost:/etc/mail[root@localhost mail]# hoststat 
]0;root@localhost:/etc/mail[root@localhost mail]# hoststat [Khoststat rpm -ql sendmail | grep -i /bin[K[K[K[K[K[K[K[K[K[K[K[K[K[K| less
[?1049h[?1h=/etc/aliases.db
/etc/mail
/etc/mail/Makefile
/etc/mail/access
/etc/mail/access.db
/etc/mail/domaintable
/etc/mail/domaintable.db
/etc/mail/helpfile
/etc/mail/local-host-names
/etc/mail/mailertable
/etc/mail/mailertable.db
/etc/mail/sendmail.cf
/etc/mail/sendmail.mc
/etc/mail/submit.cf
/etc/mail/submit.mc
/etc/mail/trusted-users
/etc/mail/virtusertable
/etc/mail/virtusertable.db
/etc/pam.d/smtp.sendmail
/etc/rc.d/init.d/sendmail
:[K[K [KESCESC[KOO[KBB[K/etc/smrsh
:[K[K [KESCESC[KOO[KBB[K/etc/sysconfig/sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/bin/hoststat
:[K[K [KESCESC[KOO[KBB[K/usr/bin/mailq.sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/bin/makemap
:[K[K [KESCESC[KOO[KBB[K/usr/bin/newaliases.sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/bin/purgestat
:[K[K [KESCESC[KOO[KBB[K/usr/bin/rmail.sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/lib/sasl2/Sendmail.conf
:[K[K [KESCESC[KOO[KBB[K/usr/lib/sendmail.sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/sbin/mailstats
:[K[K [KESCESC[KOO[KBB[K/usr/sbin/makemap
:[K[K [KESCESC[KOO[KBB[K/usr/sbin/praliases
:[K[K [KESCESC[KOO[KBB[K/usr/sbin/sendmail.sendmail
:[K[K [KESCESC[KOO[KBB[K/usr/sbin/smrsh
:[K[K[?1l>[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# rpm -ql sendmail | less[14Phoststat rpm -ql sendmail | grep -i /bin'/bin[C[C[C[C|/sbin'
]0;root@localhost:/etc/mail[root@localhost mail]# rpm -ql sendmail | grep -i '/bin|/sbin'[K"[C[1P/bin|/sbin""/bin|/sbin"
]0;root@localhost:/etc/mail[root@localhost mail]# rpm -ql sendmail | grep -i "/bin|/sbin"\/sbin"
]0;root@localhost:/etc/mail[root@localhost mail]# rpm -ql sendmail | grep -i "/bin|\/sbin"[C /sbin" [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C

]0;root@localhost:/etc/mail[root@localhost mail]# rpm -ql sendmail | grep -i "/bin|\ /sbin" [A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[K
[K[A[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[K[K[K[K[K[K[K[K[K[K[K[K[K"[K/sbin
/usr/sbin/mailstats
/usr/sbin/makemap
/usr/sbin/praliases
/usr/sbin/sendmail.sendmail
/usr/sbin/smrsh
]0;root@localhost:/etc/mail[root@localhost mail]# smrsh 
Usage: smrsh -c command
]0;root@localhost:/etc/mail[root@localhost mail]# man smrsh
[?1049h[?1h=SMRSH(8)                                                               SMRSH(8)

[1mNAME[0m
       smrsh - restricted shell for sendmail

[1mSYNOPSIS[0m
       [1msmrsh[0m [1m-c[0m command

[1mDESCRIPTION[0m
       The [4msmrsh[24m program is intended as a replacement for
       [4msh[24m for use in the ‘‘prog’’ mailer  in  [4msendmail[24m(8)
       configuration  files.   It sharply limits the com-
       mands that can be run using the ‘‘|program’’  syn-
       tax  of  [4msendmail[24m in order to improve the over all
       security of your system.  Briefly, even if a ‘‘bad
       guy’’  can  get  sendmail to run a program without
       going through an alias or forward file, [4msmrsh[24m lim-
       its  the  set  of programs that he or she can exe-
       cute.
:[K[K[?1l>[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# man smrsh -c
[?1049h[?1h=SMRSH(8)                                                               SMRSH(8)

[1mNAME[0m
       smrsh - restricted shell for sendmail

[1mSYNOPSIS[0m
       [1msmrsh[0m [1m-c[0m command

[1mDESCRIPTION[0m
       The [4msmrsh[24m program is intended as a replacement for
       [4msh[24m for use in the ‘‘prog’’ mailer  in  [4msendmail[24m(8)
       configuration  files.   It sharply limits the com-
       mands that can be run using the ‘‘|program’’  syn-
       tax  of  [4msendmail[24m in order to improve the over all
       security of your system.  Briefly, even if a ‘‘bad
       guy’’  can  get  sendmail to run a program without
       going through an alias or forward file, [4msmrsh[24m lim-
       its  the  set  of programs that he or she can exe-
       cute.
:[K[K [KESCESC[KOO[KBB[K
:[K[K [KESCESC[KOO[KBB[K       Briefly, [4msmrsh[24m limits programs to be in  a  single
:[K[K [KESCESC[KOO[KBB[K       directory,  by  default  /etc/smrsh,  allowing the
:[K[K [KESCESC[KOO[KBB[K       system administrator to choose the set of  accept-
:[K[K [KESCESC[KOO[KBB[K       able  commands,  and to the shell builtin commands
:[K[K [KESCESC[KOO[KBB[K       ‘‘exec’’, ‘‘exit’’, and ‘‘echo’’.  It also rejects
:[K[K [KESCESC[KOO[KBB[K       any  commands  with  the characters ‘`’, ‘<’, ‘>’,
:[K[K [KESCESC[KOO[KBB[K       ‘;’, ‘$’, ‘(’, ‘)’,  ‘\r’  (carriage  return),  or
:[K[K [KESCESC[KOO[KBB[K       ‘\n’  (newline)  on  the  command  line to prevent
:[K[K [KESCESC[KOO[KBB[K       ‘‘end run’’ attacks.  It allows ‘‘||’’ and  ‘‘&&’’
:[K[K [KESCESC[KOO[KBB[K       to      enable     commands     like:     ‘‘"|exec
:[K[K [KESCESC[KOO[KBB[K       /usr/local/bin/filter || exit 75"’’
:[K[K [KESCESC[KOO[KBB[K
:[K[K [KESCESC[KOO[KBB[K       Initial pathnames on  programs  are  stripped,  so
:[K[K[?1l>[?1049l]0;root@localhost:/etc/mail[root@localhost mail]# [H[2J[root@localhost mail]# 
]0;root@localhost:/etc/mail[root@localhost mail]# exit

Script done on Fri 02 May 2014 01:39:35 PM IST

*****************************************************************
REF -
http://www.sbarjatiya.com/notes_wiki/index.php/Configuring_email_virtual_hosting_using_sendmail

http://beginlinux.com/server_training/mail-server/1041-postfix-mail-server-set-up
